(this["webpackJsonpmap-maker"]=this["webpackJsonpmap-maker"]||[]).push([[0],{14:function(e,t,n){e.exports=n(23)},19:function(e,t,n){},21:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t),n.d(t,"API_ROOT",(function(){return r}));var r="https://lz4.overpass-api.de/api/interpreter"},23:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(11),i=n.n(o),c=(n(19),n(3)),s=n.n(c),u=n(2),l=n(5),f=n(1);n(21);function d(e,t){var n=a.a.useState((function(){var n=localStorage.getItem(e);if(n)try{t=JSON.parse(n)}catch(r){}return t})),r=Object(f.a)(n,2),o=r[0],i=r[1];return[o,function(t){localStorage.setItem(e,JSON.stringify(t)),i(t)}]}var h=n(4),p=n(7),v=n(8),m=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(p.a)(this,e),this.type=t,this.tags=n,this.pseudoClasses=r,this.pseudoElement=a}return Object(v.a)(e,[{key:"toString",value:function(){return"".concat(this.type).concat(Object.entries(this.tags).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return"[".concat(n,"=").concat(r,"]")})).join(""))}}]),e}();function b(e,t){if(t.type!==e.type)return!1;for(var n=!0,r=0,a=Object.entries(e.tags);r<a.length;r++){var o=Object(f.a)(a[r],2),i=o[0],c=o[1];if(!t.tags||t.tags[i]!==c){n=!1;break}}return n}function g(e){for(var t,n,r=/^\s*@match\s*\(([^\s)]+)\s*(:|=|<=|>=|<|>|and|or)\s*([^\s)]+)(?:\s*(=|<=|>=|<|>)\s*([^\s)]+))?\)\s*{/,a={mediaQueries:[],index:0},o=/^\s*}/;t=r.exec(e);){var i=k(t);a.index+=t[0].length;var c=y(e=e.substring(t[0].length)),s=c.rules,u=c.index;a.index+=u,e=e.substring(u),(n=o.exec(e))?(a.mediaQueries.push({type:"query",predicate:i,rules:s}),a.index+=n[0].length):console.log("Unterminated media query")}return a}function y(e){for(var t,n=/^\s*([^{}]+)\s*{([^{}]*)}/,r={rules:[],index:0},a=function(){var n={};t[2].split(";").map((function(e){return e.trim()})).filter((function(e){return e})).forEach((function(e){var t=e.indexOf(":"),r=e.substring(0,t).trim(),a=e.substring(t+1).trim();n[r]=a}));var a=m.parseMultiple(t[1]);a.length&&r.rules.push({type:"rule",selectors:a,declarations:n}),r.index+=t[0].length,e=e.substring(t[0].length)};t=n.exec(e);)a();return r}function x(e,t){var n,r=[],a=Object(u.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if("rule"===o.type){var i,c=o.declarations,s=Object(u.a)(o.selectors);try{for(s.s();!(i=s.n()).done;){var l=i.value;r.push({selector:l,declarations:c})}}catch(f){s.e(f)}finally{s.f()}}else E(o.predicate,t)&&r.push.apply(r,Object(h.a)(x(o.rules,t)))}}catch(f){a.e(f)}finally{a.f()}return r}function k(e){return e[4]?{left:{left:e[1],operator:e[2],right:e[3]},operator:"and",right:{left:e[3],operator:e[4],right:e[5]}}:{left:e[1],operator:e[2],right:e[3]}}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="string"===typeof e.left||"number"===typeof e.left?e.left:E(e.left,t),r="string"===typeof e.right||"number"===typeof e.right?e.right:E(e.right,t);"string"===typeof n&&n in t&&(t[n]instanceof Function&&(t[n]=t[n]()),n=t[n]),"string"===typeof r&&r in t&&(t[r]instanceof Function&&(t[r]=t[r]()),r=t[r]);var a=j[e.operator];return!!a&&a(n,r)}m.parse=function(e){var t=/^\s*([a-z]+)/.exec(e);if(!t)return null;var n=t[1];"rel"===n&&(n="relation");for(var r={},a=e.substring(t[0].length).trim(),o=/^\[([^[\]=]+)=([^[\]=]+)\]/;;){var i=o.exec(a);if(!i)break;r[i[1]]=i[2],a=a.substring(i[0].length)}for(var c=[],s=/^:([a-z-]+)(?:\(([^)]+)\))?/,u=function(){var e=s.exec(a);if(!e)return"break";var t=/^\s*([^\s)]+)\s*(:|=|<=|>=|<|>|and|or)\s*([^\s)]+)(?:\s*(=|<=|>=|<|>)\s*([^\s)]+))?/,n=e[2]?e[2].split(",").map((function(e){return t.test(e)?k(t.exec(e)):e})):[];c.push({name:e[1],params:n}),a=a.substring(e[0].length)};;){if("break"===u())break}var l=null,f=/^::([a-z-]+)?/;if(f.test(a)){var d=f.exec(a);l=d[1],a=a.substring(d[0].length)}return a.length?(console.log("Invalid selector: ".concat(e," unexpected part: '").concat(a,"'")),null):new m(n,r,c,l)},m.parseMultiple=function(e){return e.split(",").map(m.parse).filter((function(e){return e}))};var j={":":function(e,t){return e==t},"=":function(e,t){return e==t},">":function(e,t){return e>t},"<":function(e,t){return e<t},">=":function(e,t){return e>=t},"<=":function(e,t){return e<=t},and:function(e,t){return e&&t},or:function(e,t){return e||t}};function O(e,t){var n=e.split(","),r=Object(f.a)(n,4),a=r[0],o=r[1],i=r[2],c=r[3],s=t.split(","),u=Object(f.a)(s,4),l=u[0],d=u[1],h=u[2],p=u[3];return l>=a&&d>=o&&h<=i&&p<=c}function w(e){var t=e.split(",");return(+t[2]-+t[0])*(+t[3]-+t[1])}function S(e,t,n){var r=Object(f.a)(e,2),a=r[0],o=r[1],i=Object(f.a)(n,2),c=i[0],s=i[1],u=Math.pow(2,t),l=180/u*(c/256),d=180/u*(s/256);return[a-l,o-d,a+l,o+d].map((function(e){return e.toFixed(3)})).join(",")}function P(e,t,n,r){return[[e,t],[e,t+r],[e+n,t+r],[e+n,t]]}function I(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n][0]*e[n+1][1]-e[n+1][0]*e[n][1];return t/2}function M(e){return Math.abs(I(e))}function T(e){return I(e)>0}function C(e){var t=e.length;if(!(t<3)){for(var n=0,r=1;r<t;r++){var a=e[r-1],o=e[r],i=e[(r+1)%t],c=Math.sign((o[0]-a[0])*(i[1]-o[1])-(o[1]-a[1])*(i[0]-o[0]));if(0===n)n=c;else if(0!==c&&n!==c)return!1}return!0}}function R(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]}function N(e){for(var t=0,n=1;n<e.length;n++){var r=e[n][0]-e[n-1][0],a=e[n][1]-e[n-1][1];t+=Math.sqrt(r*r+a*a)}return t}function F(e){var t=e.clientWidth,n=e.clientHeight,r=t*devicePixelRatio,a=n*devicePixelRatio;e.width=r,e.height=a}function L(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,i={};n.forEach((function(e){return"node"===e.type&&(i[e.id]=e)}));var c={};n.forEach((function(e){return"way"===e.type&&(c[e.id]=e)}));var s=r.getContext("2d"),l=r.clientWidth,f=r.clientHeight,d=l*devicePixelRatio,p=f*devicePixelRatio,v=A(e,t,d,p);if(s.save(),a.declarations.opacity&&(s.globalAlpha=+a.declarations.opacity),"relative"===a.declarations.position){var m=parseFloat(a.declarations.top)||0,b=parseFloat(a.declarations.left)||0;s.translate(b*devicePixelRatio,m*devicePixelRatio)}if("map"===a.selector.type){var g=P(0,0,d,p);z(s,a,g)}else if("current"===a.selector.type){if(o.current){var y=o.current.coords;W(s,a,v(y.longitude,y.latitude))}}else if("gridlines"===a.selector.type)B(s,a,e,t,d,p,v);else{var x,k=Object(u.a)(n);try{for(k.s();!(x=k.n()).done;){var j=x.value;if(j.type===a.selector.type)if("node"===j.type)W(s,a,v(j.lon,j.lat),j);else if("way"===j.type){var O=function(){if(!j.nodes)return"continue";var e=j.nodes.map((function(e){return i[e]})).map((function(e){return v(e.lon,e.lat)}));if(a.selector.pseudoClasses.some((function(e){return"is"===e.name&&"convex"===e.params[0]}))){if(!C(e))return"continue"}else if(a.selector.pseudoClasses.some((function(e){return"is"===e.name&&"concave"===e.params[0]}))&&C(e))return"continue";if(a.selector.pseudoClasses.some((function(e){return"is"===e.name&&"clockwise"===e.params[0]}))){if(T(e))return"continue"}else if(a.selector.pseudoClasses.some((function(e){return"is"===e.name&&"anti-clockwise"===e.params[0]}))&&!T(e))return"continue";var t,n=a.selector.pseudoClasses.filter((function(e){return"has"===e.name})),r=!0,o=Object(u.a)(n);try{for(o.s();!(t=o.n()).done;){var c=t.value;if("string"!==typeof c.params[0])if(!(r=E(c.params[0],{area:function(){return M(e)},length:function(){return N(e)},width:function(){return H(e)[2]},height:function(){return H(e)[3]}})))break}}catch(m){o.e(m)}finally{o.f()}if(!r)return"continue";if("centre"===a.selector.pseudoElement||"center"===a.selector.pseudoElement){var l=K(e);W(s,a,l,j)}else if("average-point"===a.selector.pseudoElement){var f=D(e);W(s,a,f,j)}else if("centre-of-mass"===a.selector.pseudoElement);else if("bounding-box"===a.selector.pseudoElement){var d=H(e),p=P.apply(void 0,Object(h.a)(d));z(s,a,p,j)}else _(s,a,e,j)}();if("continue"===O)continue}else if("area"===j.type){if(!j.nodes)continue;var w=j.nodes.map((function(e){return i[e]})),S=w.map((function(e){return v(e.lon,e.lat)}));z(s,a,S,j)}else if("relation"===j.type){if(!j.members)continue;s.fillStyle=a.declarations.fill,s.strokeStyle=a.declarations.stroke,s.lineWidth=+a.declarations["stroke-width"]*devicePixelRatio,s.beginPath();var I,R=j.members.filter((function(e){return"way"===e.type})).map((function(e){return c[e.ref]})),F=Object(u.a)(R);try{for(F.s();!(I=F.n()).done;){var L=I.value,q=L.nodes.map((function(e){return i[e]}));s.moveTo.apply(s,Object(h.a)(v(q[0].lon,q[0].lat)));for(var U=1;U<q.length;U++)s.lineTo.apply(s,Object(h.a)(v(q[U].lon,q[U].lat)))}}catch(V){F.e(V)}finally{F.f()}s.closePath(),a.declarations.fill&&s.fill(),a.declarations.stroke&&s.stroke()}}}catch(V){k.e(V)}finally{k.f()}}s.restore()}function B(e,t,n,r,a,o,i){e.fillStyle=t.declarations.fill,e.strokeStyle=t.declarations.stroke,e.lineWidth=+t.declarations["stroke-width"]*devicePixelRatio;var c=t.selector.pseudoClasses.find((function(e){return"vertical"===e.name})),s=t.selector.pseudoClasses.find((function(e){return"horizontal"===e.name}));if(c){var u=S(n,r,[a,o]).split(","),l=parseFloat(c.params[0]),f=1/l,d=Math.floor(+u[0]*f)/f,p=Math.ceil(+u[2]*f)/f,v=Math.floor(+u[1]*f)/f,m=Math.ceil(+u[3]*f)/f;e.beginPath();for(var b=d;b<=p;b+=l){e.moveTo.apply(e,Object(h.a)(i(b,v)));for(var g=v;g<=m;g+=l)e.lineTo.apply(e,Object(h.a)(i(b,g)))}t.declarations.stroke&&e.stroke()}if(s){var y=S(n,r,[a,o]).split(","),x=parseFloat(s.params[0]),k=1/x,E=Math.floor(+y[0]*k)/k,j=Math.ceil(+y[2]*k)/k,O=Math.floor(+y[1]*k)/k,w=Math.ceil(+y[3]*k)/k;e.beginPath();for(var P=O;P<=w;P+=x){e.moveTo.apply(e,Object(h.a)(i(E,P)));for(var I=E;I<=j;I+=x)e.lineTo.apply(e,Object(h.a)(i(I,P)))}t.declarations.stroke&&e.stroke()}}function W(e,t,n){var r=Object(f.a)(n,2),a=r[0],o=r[1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e.fillStyle=t.declarations.fill,e.strokeStyle=t.declarations.stroke,e.lineWidth=+t.declarations["stroke-width"]*devicePixelRatio,e.beginPath();var c=+t.declarations.size*devicePixelRatio;e.ellipse(a,o,c,c,0,0,2*Math.PI),t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke(),t.declarations.content&&q(e,t,[a,o],i)}function _(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e.fillStyle=t.declarations.fill,e.strokeStyle=t.declarations.stroke,e.lineWidth=+t.declarations["stroke-width"]*devicePixelRatio,e.beginPath(),e.moveTo.apply(e,Object(h.a)(n[0]));for(var a=1;a<n.length;a++)e.lineTo.apply(e,Object(h.a)(n[a]));if(t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke(),t.declarations.content){var o=K(n);q(e,t,o,r)}}function z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(0!==n.length){var a=R(n)?n:[].concat(Object(h.a)(n),[n[0]]);_(e,t,a,r)}}function q(e,t,n){var r=Object(f.a)(n,2),a=r[0],o=r[1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e.fillStyle=t.declarations.fill,e.strokeStyle=t.declarations.stroke,e.lineWidth=+t.declarations["stroke-width"]*devicePixelRatio;var c=t.declarations.content;if(c.match(/^".*"$/g))c=c.replace(/^"|"$/g,"");else if(c.match(/tag\(([^)]+)\)/)){var s=c.match(/tag\(([^)]+)\)/);c=i.tags[s[1]]||""}else c="?";var u="".concat(10*devicePixelRatio,"px"),l="normal",d="sans-serif";if(t.declarations["font-size"]&&(u=t.declarations["font-size"].replace(/^\d[\d.]*/,(function(e){return"".concat(+e*devicePixelRatio)}))),t.declarations["font-weight"]&&(l=t.declarations["font-weight"]),t.declarations["font-family"]&&(d=t.declarations["font-family"]),e.font=t.declarations.font||"".concat(l," ").concat(u," ").concat(d),t.declarations["text-align"]){var h=e.measureText(c).width;"center"===t.declarations["text-align"]||"centre"===t.declarations["text-align"]?a-=h/2:"right"===t.declarations["text-align"]&&(a-=h)}t.declarations["text-color"]?(e.fillStyle=t.declarations["text-color"],e.fillText(c,a,o)):(t.declarations.stroke&&e.strokeText(c,a,o),!t.declarations.fill&&t.declarations.stroke||e.fillText(c,a,o))}function A(e,t,n,r){var a=Object(f.a)(e,2),o=a[0],i=a[1],c=Math.pow(2,t),s=256/(180/c),u=256/(180/c),l=Math.PI/4,d=n/2,h=r/2,p=180*Math.log(Math.tan(l+i/180*Math.PI/2))/Math.PI;return function(e,t){var n=e,r=180*Math.log(Math.tan(l+t/180*Math.PI/2))/Math.PI;return[d+(n-o)*s,h-(r-p)*u]}}function D(e){return e.reduce((function(e,t){return[e[0]+t[0],e[1]+t[1]]}),[0,0]).map((function(t){return t/e.length}))}function K(e){var t=H(e);return[t[0]+t[2]/2,t[1]+t[3]/2]}function H(e){var t=e.reduce((function(e,t){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[2],t[0]),Math.max(e[3],t[1])]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]);return[t[0],t[1],t[2]-t[0],t[3]-t[1]]}var U=n(13),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OverpassElements";Object(p.a)(this,e);var n=indexedDB.open(t);n.addEventListener("upgradeneeded",(function(e){var t=e.target.result;t.createObjectStore("nodes",{keyPath:"id"}),t.createObjectStore("elements").createIndex("selectorIndex",["selector","area","bbox"],{unique:!1})})),this.db=new Promise((function(e,t){n.addEventListener("success",(function(t){var n=t.target;e(n.result)})),n.addEventListener("error",t)}))}return Object(v.a)(e,[{key:"saveNodes",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r,a,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:n=e.sent,r=n.transaction("nodes","readwrite").objectStore("nodes"),a=Object(u.a)(t);try{for(a.s();!(o=a.n()).done;)i=o.value,r.put(i)}catch(c){a.e(c)}finally{a.f()}case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNode",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("nodes","readonly").objectStore("nodes").get(t);a.addEventListener("success",(function(t){return e(a.result)})),a.addEventListener("error",(function(e){return r(e)}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNodes",value:function(e){var t=this;return Promise.all(e.map((function(e){return t.getNode(e)})))}},{key:"getElements",value:function(e,t){var n=Y(e,t);return this.getElementsByKey(n)}},{key:"getElementsByKey",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("elements","readonly").objectStore("elements").get(t);a.addEventListener("success",(function(t){return e(a.result)})),a.addEventListener("error",r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchElements",value:function(){var e=Object(l.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,a){var o=r.transaction("elements","readonly").objectStore("elements").index("selectorIndex"),i=IDBKeyRange.bound([n,0,"0"],[n,Number.MAX_VALUE,"999999999999999999"]),c=o.openKeyCursor(i),s=0;c.addEventListener("success",(function(r){var a=c.result;if(a){var o=a.key,i=a.primaryKey,u=o[2];if(s++,O(u,t))return console.debug("".concat(n," found after checking ").concat(s," records")),void e(i);a.continue()}else console.debug("".concat(n," not found after checking ").concat(s," records")),e(null)})),c.addEventListener("error",a)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveElements",value:function(){var e=Object(l.a)(s.a.mark((function e(t,n,r){var a,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return a=e.sent,o=Y(t,n),i=w(t),e.abrupt("return",new Promise((function(e,c){var s=a.transaction("elements","readwrite").objectStore("elements").put(Object(U.a)({selector:n,bbox:t,area:i},r),o);s.addEventListener("success",(function(){console.debug("Saved ".concat(n,"/").concat(t," to database with ").concat(r.elements.length," elements")),e()})),s.addEventListener("error",c)})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();function Y(e,t){var n=e.split(",").map((function(e){return(+e).toFixed(3)})).join(",");return"".concat(t,"/").concat(n)}var J=n(22).API_ROOT,G=/(node|way|rel(?:ation)?|area)/,Q=/(way|rel(?:ation)?|area)/,$=function(){function e(t){Object(p.a)(this,e),this.elements=new Map,this.bbox=t,this.database=new V}return Object(v.a)(e,[{key:"setBBox",value:function(e){O(this.bbox,e)||this.elements.clear(),this.bbox=e}},{key:"preLoadElements",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r,a,o,i,c,l,d,p,v,m,g,y,x,k=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.bbox,r={},t.forEach((function(e){return r[e.toString()]=e})),console.debug("Preloading Elements: ".concat(t.length," requested (").concat(Object.keys(r).length," unique)")),a=0,o=Object.entries(r);a<o.length;a++)i=Object(f.a)(o[a],2),c=i[0],l=i[1],G.test(l.type)||delete r[c];for(console.debug("Preloading Elements: ".concat(Object.keys(r).length," are Overpass Elements")),d=0,p=Object.keys(r);d<p.length;d++)v=p[d],this.elements.has(v)&&delete r[v];return console.debug("Preloading Elements: ".concat(Object.keys(r).length," not in HashMap")),e.next=10,Promise.all(Object.keys(r).map((function(e){return k.database.searchElements(n,e).then((function(t){t&&delete r[e]}))})));case 10:if(console.debug("Preloading Elements: ".concat(Object.keys(r).length," not in Database")),0!==Object.keys(r).length){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,this.query(Object.values(r));case 15:return m=e.sent,g=m.elements,console.log("Preloading Elements: Fetched ".concat(g.length," elements from Server")),y={},g.forEach((function(e){return"node"===e.type&&(y[e.id]=e)})),x={},g.forEach((function(e){return"way"===e.type&&(x[e.id]=e)})),e.abrupt("return",Promise.all(Object.values(r).map((function(e){var t=g.filter((function(t){return b(e,t)}));if("relation"===e.type){var r,a=t.slice(),o=[],i=Object(u.a)(a);try{for(i.s();!(r=i.n()).done;){var c=r.value.members.map((function(e){return e.ref}));o.push.apply(o,Object(h.a)(c.map((function(e){return x[e]}))))}}catch(E){i.e(E)}finally{i.f()}t.push.apply(t,o);for(var s=0,l=o;s<l.length;s++){var f=l[s];t.push.apply(t,Object(h.a)(f.nodes.map((function(e){return y[e]}))))}}else if("way"===e.type){var d,p=t.slice(),v=Object(u.a)(p);try{for(v.s();!(d=v.n()).done;){var m=d.value;t.push.apply(t,Object(h.a)(m.nodes.map((function(e){return y[e]}))))}}catch(E){v.e(E)}finally{v.f()}}return k.elements.set(e.toString(),Promise.resolve(t)),k.database.saveElements(n,e.toString(),{elements:t,cached:Date.now()})}))));case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e){var t=this,n=e.map((function(e){return Q.test(e.type)?"\n\t".concat(e,";\n\t>;"):e.toString()+";"})),r="[out:json][bbox];\n(".concat(n.join(""),"\n);\nout;"),a="".concat(J,"?data=").concat(r.replace(/\s/,""),"&bbox=").concat(this.bbox);return this.currentFetch&&this.currentFetch.url===a||(this.currentFetch={url:a,promise:fetch(a.toString()).then((function(e){return e.ok?e.json():function(){return t.currentFetch=null,Promise.reject(e.status)}}))}),this.currentFetch.promise}},{key:"tryElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return new Promise((function(r,a){t.query([e]).then((function(e){r(e.elements)}),(function(o){429!==o?a("Bad Response"):n>0?setTimeout((function(){t.tryElements(e,n-1).then(r,a)}),1e4):a(o)}))}))}},{key:"getElements",value:function(){var e=Object(l.a)(s.a.mark((function e(t){var n,r,a,o,i,c,u=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G.test(t.type)){e.next=2;break}return e.abrupt("return");case 2:if(n=t.toString(),!this.elements.has(n)){e.next=5;break}return e.abrupt("return",this.elements.get(n));case 5:return e.next=7,this.database.getElements(this.bbox,t.toString());case 7:if(!(r=e.sent)){e.next=12;break}return a=r.elements,this.elements.set(n,Promise.resolve(a)),e.abrupt("return",a);case 12:return e.next=14,this.database.searchElements(this.bbox,t.toString());case 14:if(!(o=e.sent)){e.next=19;break}return i=this.database.getElementsByKey(o).then((function(e){return e.elements})),this.elements.set(n,i),e.abrupt("return",i);case 19:return c=this.tryElements(t),this.elements.set(n,c),c.catch((function(){return u.elements.delete(n)})),c.then((function(e){u.database.saveElements(u.bbox,t.toString(),{elements:e,cached:Date.now()})})),e.abrupt("return",c);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function X(e,t){var n=Object(r.useState)(e),a=Object(f.a)(n,2),o=a[0],i=a[1];return Object(r.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),o}function Z(e){var t=e.value,n=e.onChange,r=e.style,o=void 0===r?{}:r;return a.a.createElement("textarea",{value:t,onChange:function(e){return n(e.target.value)},onKeyDown:function(e){var r=e.key,a=e.currentTarget;if("Tab"===r){e.preventDefault();var o=a.selectionStart,i=t.lastIndexOf("\n",o-1)+1,c=4-(o-i)%4,s=t.substring(0,o)+"    ".substring(0,c)+t.substring(o);n(s),setTimeout((function(){return a.setSelectionRange(o+c,o+c)}),10)}else if("Enter"===r){e.preventDefault();var u=a.selectionStart,l="{"===t[u-1],f=t.lastIndexOf("\n",u-1)+1,d=t.substring(f,u).match(/^ */),h=u+d[0].length+1+(l?4:0),p=t.substring(0,u)+"\n"+(l?"    ":"")+d[0]+t.substring(u);n(p),setTimeout((function(){return a.setSelectionRange(h,h)}),10)}},style:o})}var ee=n(12);var te=function(){var e=d("USER_STYLE","node[amenity=post_box] {\n\tfill: black;\n\tsize: 2;\n}"),t=Object(f.a)(e,2),n=t[0],r=t[1],o=d("USER_CENTRE","7.1,50.7"),i=Object(f.a)(o,2),c=i[0],p=i[1],v=d("USER_SCALE",14),m=Object(f.a)(v,2),b=m[0],k=m[1],E=function(){var e=a.a.useState(),t=Object(f.a)(e,2),n=t[0],r=t[1];return a.a.useEffect((function(){navigator.geolocation.getCurrentPosition(r)}),[]),a.a.useEffect((function(){var e=navigator.geolocation.watchPosition(r);return function(){return navigator.geolocation.clearWatch(e)}}),[]),n}(),j=a.a.useRef(),O=a.a.useRef(),w=a.a.useState(!1),P=Object(f.a)(w,2),I=P[0],M=P[1],T=a.a.useState(""),C=Object(f.a)(T,2),R=C[0],N=C[1],B=j.current||{clientWidth:1e3,clientHeight:1e3},W=B.clientWidth,_=B.clientHeight,z=X(c,500),q=X(b,500),A=a.a.useMemo((function(){return S(z.split(",").map((function(e){return+e})),q,[W,_])}),[z,q,W,_]);O.current||(O.current=new $(A));var D=X(n,500),K=a.a.useMemo((function(){return function(e){for(var t={rules:[]},n=e.length;n>0;){var r,a,o=y(e);(r=t.rules).push.apply(r,Object(h.a)(o.rules));var i=g(e=e.substring(o.index).trim());if((a=t.rules).push.apply(a,Object(h.a)(i.mediaQueries)),(e=e.substring(i.index).trim()).length===n){console.log("Got stuck parsing style at: "+e);break}n=e.length}return t}(D)}),[D]);function H(e,t){var n=z.split(",").map((function(e){return+e})),r=360/Math.pow(2,b),a=[n[0]+e*r,n[1]+t*r];p(a.join(","))}return a.a.useEffect((function(){return O.current.setBBox(A)}),[A]),Object(ee.a)((function(){function e(){return(e=Object(l.a)(s.a.mark((function e(){var t,n,r,a,o,i,c,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M(!0),N(""),e.prev=2,t={zoom:q,current:E},n=x(K.rules,t),e.next=7,O.current.preLoadElements(n.map((function(e){return e.selector})));case 7:if(r=n.map((function(e){return{rule:e,promise:O.current.getElements(e.selector)}})),!j.current){e.next=30;break}F(j.current),a=z.split(",").map((function(e){return+e})),o=Object(u.a)(r),e.prev=12,o.s();case 14:if((i=o.n()).done){e.next=22;break}return c=i.value,e.next=18,c.promise;case 18:l=e.sent,L(a,q,l,j.current,c.rule,t);case 20:e.next=14;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(12),o.e(e.t0);case 27:return e.prev=27,o.f(),e.finish(27);case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(2),N("Error Fetching");case 35:return e.prev=35,M(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[2,32,35,38],[12,24,27,30]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[z,q,K,E]),a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"sidebar"},a.a.createElement("div",{className:"controls"},a.a.createElement("button",{onClick:function(){return H(-1,0)}},"\u23f4"),a.a.createElement("button",{onClick:function(){return H(1,0)}},"\u23f5"),a.a.createElement("button",{onClick:function(){return H(0,1)}},"\u23f6"),a.a.createElement("button",{onClick:function(){return H(0,-1)}},"\u23f7"),a.a.createElement("button",{onClick:function(){return k(b+1)}},"\u2795"),a.a.createElement("button",{onClick:function(){return k(b-1)}},"\u2796"),E&&a.a.createElement("button",{onClick:function(){return p("".concat(E.coords.longitude,",").concat(E.coords.latitude))}},"\ud83d\udccd")),a.a.createElement("label",null,"Centre ",a.a.createElement("input",{value:c,onChange:function(e){return p(e.target.value)}})),a.a.createElement("label",null,"Zoom ",a.a.createElement("input",{type:"number",value:b,onChange:function(e){return k(+e.target.value)}})),a.a.createElement(Z,{value:n,onChange:r,style:{flex:1}}),I&&a.a.createElement("p",null,"Loading..."),R&&a.a.createElement("p",{style:{color:"red"}},R)),a.a.createElement("canvas",{ref:j}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[14,1,2]]]);
//# sourceMappingURL=main.f38be9af.chunk.js.map