{"version":3,"sources":["../webpack/bootstrap","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js","../node_modules/regenerator-runtime/runtime.js","const.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/superPropBase.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","util.js","geometry.js","Style.js","matchPseudoClasses.js","getContent.js","bbox.js","MapRenderer.js","canvas-render/setStrokeFill.js","parseStrokeFill.js","canvas-render/renderText.js","canvas-render/transform.js","canvas-render/renderPoint.js","CollisionSystem.js","canvas-render/renderAreaLine.js","canvas-render/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","database.idb.js","Overpass.js","render-worker.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","runtime","Op","hasOwn","$Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","define","obj","configurable","writable","err","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","context","Context","_invoke","state","method","arg","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","type","done","makeInvokeMethod","fn","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","previousPromise","callInvokeWithMethodAndArg","resolve","reject","invoke","result","__await","then","unwrapped","error","undefined","TypeError","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","length","constructor","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","toString","keys","reverse","pop","skipTempReset","prev","charAt","slice","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","regeneratorRuntime","accidentalStrictMode","Function","API_ROOT","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","_createClass","protoProps","staticProps","_getPrototypeOf","receiver","Reflect","base","desc","getOwnPropertyDescriptor","_setPrototypeOf","_isNativeReflectConstruct","construct","sham","Proxy","Date","e","_typeof","_possibleConstructorReturn","ReferenceError","_arrayLikeToArray","arr","len","arr2","Array","_unsupportedIterableToArray","minLen","from","test","_slicedToArray","isArray","_arr","_n","_d","_e","_s","_i","_toConsumableArray","_createForOfIteratorHelper","F","f","it","normalCompletion","didErr","step","_e2","timeout","duration","setTimeout","mercatorProjection","centre","scale","width","height","cLon","cLat","tileCount","Math","pow","hPixelsPerDeg","vPixelsPerDeg","QUARTER_PI","PI","cX","cY","cLatPrime","log","tan","lon","lat","E","N","getAveragePoint","points","reduce","sum","map","x","getCentrePoint","boundingBox","getBoundingBox","getMidPoint","floor","minMax","point","min","max","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","rectToPoints","y","getCrossProductArea","getArea","abs","isAntiClockwise","isConvex","sign","a","b","isSelfClosing","getLength","dx","dy","sqrt","StyleSelector","tags","pseudoClasses","pseudoElement","entries","k","v","op","join","matchSelector","selector","element","inequalities","exec","cmp","COMPARE","substr","res","localeCompare","makePredicate","match","left","operator","right","testPredicate","predicate","parse","text","tagText","substring","trim","re2","m2","re3","m3","re","params","split","re4","m4","console","parseMultiple","filter","matchPseudoClasses","rule","nodes","includesPseudoClass","hasPseudoClasses","pc","elementContext","area","some","getContent","content","declarations","index","out","replace","contains","areaA","areaB","Ax1","Ay1","Ax2","Ay2","Bx1","By1","Bx2","By2","bbox","parts","MapRenderer","elements","nodeMap","id","wayMap","zoom","projection","globalSetup","renderPseudoElement","renderArea","current","coords","renderPoint","longitude","latitude","renderGridlines","el","renderLine","renderAreaLine","getPoint","centrePoint","midPoint","avgPoint","bounding","boundingPoints","bottom","top","NaN","baseline","line","size","measureText","ascending","descending","padding","parseFloat","boundPoints","decimatedPoints","vertical","find","horizontal","dLon","dLat","toFixed","makeBBox","round","sigFigs","ceil","log10","xmin","xmax","ymin","ymax","j","setStrokeFill","ctx","lineWidth","fillStyle","strokeStyle","mutedStyle","ss","repeat","sm","parseStrokeFill","renderText","setFont","textWidth","strokeText","fillText","actualBoundingBoxAscent","actualBoundingBoxDescent","fontSize","fontWeight","fontFamily","font","applyTransform","trans","unit","transform","rotate","translate","valueY","save","beginPath","ellipse","fill","stroke","drawPath","urlRe","url","img","Image","src","w","h","addEventListener","drawImage","restore","pathSpec","first","segs","x2","y2","x3","y3","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","CollisionSystem","sets","set","box","intersects","singleton","boxA","boxB","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","scaleFactor","collisionSystem","getCollisionSystem","add","policy","offsetX","offsetY","cp","CanvasRender","subClass","superClass","Derived","Super","NewTarget","arguments","apply","canvas","getContext","globalAlpha","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","args","_defineProperty","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","_objectSpread2","source","getOwnPropertyDescriptors","defineProperties","IDBElementDatabase","request","indexedDB","open","ev","db","createObjectStore","keyPath","createIndex","unique","store","transaction","objectStore","put","ids","all","getNode","makeKey","getElementsByKey","range","IDBKeyRange","bound","MAX_VALUE","openKeyCursor","count","bboxOversizeArea","cursor","primaryKey","keyBBox","keyArea","debug","continue","req","clear","onsuccess","onerror","bkey","renderer","require","overpassRe","recurRe","mapSelectorForQuery","recur","mapSelector","clamp","overpass","Map","database","fetchMap","currentJob","selectors","jobs","has","searchElements","els","tryQuery","ways","refs","members","ref","way","saveElements","cached","now","sMap","query","clampBBox","fetch","ok","json","status","finally","tries","catch","getElements","dbResult","dbSearchResult","delete","chain","onmessage","msg","data","setBBox","pElements","renderRule"],"mappings":"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","file":"static/js/render-worker.bc6cf0f4.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/map-maker/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"regenerator-runtime\");\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar runtime = (function (exports) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n    return obj[key];\n  }\n  try {\n    // IE 8 has a broken Object.defineProperty that only works on DOM objects.\n    define({}, \"\");\n  } catch (err) {\n    define = function(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  exports.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunction.displayName = define(\n    GeneratorFunctionPrototype,\n    toStringTagSymbol,\n    \"GeneratorFunction\"\n  );\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      define(prototype, method, function(arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  exports.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  exports.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      define(genFun, toStringTagSymbol, \"GeneratorFunction\");\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  exports.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return PromiseImpl.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return PromiseImpl.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration.\n          result.value = unwrapped;\n          resolve(result);\n        }, function(error) {\n          // If a rejected Promise was yielded, throw the rejection back\n          // into the async generator function so it can be handled there.\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  exports.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  exports.async = function(innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    if (PromiseImpl === void 0) PromiseImpl = Promise;\n\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList),\n      PromiseImpl\n    );\n\n    return exports.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        // Note: [\"return\"] must be used for ES3 parsing compatibility.\n        if (delegate.iterator[\"return\"]) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  define(Gp, toStringTagSymbol, \"Generator\");\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  exports.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  exports.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n\n  // Regardless of whether this script is executing as a CommonJS module\n  // or not, return the runtime object so that we can declare the variable\n  // regeneratorRuntime in the outer scope, which allows this module to be\n  // injected easily by `bin/regenerator --include-runtime script.js`.\n  return exports;\n\n}(\n  // If this script is executing as a CommonJS module, use module.exports\n  // as the regeneratorRuntime namespace. Otherwise create a new empty\n  // object. Either way, the resulting object will be used to initialize\n  // the regeneratorRuntime variable at the top of this file.\n  typeof module === \"object\" ? module.exports : {}\n));\n\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  // This module should not be running in strict mode, so the above\n  // assignment should always work unless something is misconfigured. Just\n  // in case runtime.js accidentally runs in strict mode, we can escape\n  // strict mode using a global Function call. This could conceivably fail\n  // if a Content Security Policy forbids using Function, but in that case\n  // the proper solution is to fix the accidental strict mode problem. If\n  // you've misconfigured your bundler to force strict mode and applied a\n  // CSP to forbid Function, and you're not willing to fix either of those\n  // problems, please detail your unique predicament in a GitHub issue.\n  Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n}\n","\r\nexport const API_ROOT = \"https://overpass-api.de/api/interpreter\";","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","import superPropBase from \"./superPropBase\";\nexport default function _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}","import getPrototypeOf from \"./getPrototypeOf\";\nexport default function _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","import _typeof from \"../../helpers/esm/typeof\";\nimport assertThisInitialized from \"./assertThisInitialized\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nexport default function _createForOfIteratorHelper(o) {\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (o = unsupportedIterableToArray(o))) {\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var it,\n      normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","/**\r\n * Promise based timeout\r\n * @param {number} duration\r\n */\r\nexport function timeout (duration) {\r\n    return new Promise(resolve => setTimeout(resolve, duration));\r\n}\r\n\r\n/**\r\n * @returns {(lon: number, lat: number) => [number, number]}\r\n * @param {number} minLon\r\n * @param {number} minLat\r\n * @param {number} maxLon\r\n * @param {number} maxLat\r\n * @param {number} width\r\n * @param {number} height\r\n */\r\nexport function flatProjection(minLon, minLat, maxLon, maxLat, width, height) {\r\n    const xScale = width / (maxLon - minLon);\r\n    const yScale = height / (maxLat - minLat);\r\n    const scale = Math.max(xScale, yScale);\r\n    return ((lon, lat) => [(lon - minLon) * scale, height - (lat - minLat) * scale]);\r\n}\r\n/**\r\n * @param {[number, number]} centre\r\n * @param {number} scale\r\n * @param {number} width\r\n * @param {number} height\r\n * @returns {(lon: number, lat: number) => [number, number]}\r\n */\r\nexport function mercatorProjection(centre, scale, width, height) {\r\n    const baseTileSize = 256;\r\n\r\n    const [cLon, cLat] = centre;\r\n\r\n    const tileCount = Math.pow(2, scale);\r\n    const degPerTileH = 180 / tileCount;\r\n    const degPerTileV = 180 / tileCount;\r\n\r\n    const hPixelsPerDeg = baseTileSize / degPerTileH;\r\n    const vPixelsPerDeg = baseTileSize / degPerTileV;\r\n\r\n    const QUARTER_PI = Math.PI / 4;\r\n\r\n    const cX = width / 2;\r\n    const cY = height / 2;\r\n\r\n    const cLatPrime = Math.log(Math.tan(QUARTER_PI + (cLat / 180 * Math.PI) / 2)) * 180 / Math.PI;\r\n\r\n    return (lon, lat) => {\r\n        const E = lon;\r\n        const N = Math.log(Math.tan(QUARTER_PI + (lat / 180 * Math.PI) / 2)) * 180 / Math.PI;\r\n\r\n        const dLon = E - cLon;\r\n        const dLat = N - cLatPrime;\r\n\r\n        const dX = dLon * hPixelsPerDeg;\r\n        const dY = dLat * vPixelsPerDeg;\r\n\r\n        return [cX + dX, cY - dY];\r\n    };\r\n}\r\n/**\r\n *\r\n * @param {[number, number][]} points\r\n */\r\n\r\nexport function getAveragePoint(points) {\r\n    const sum = points.reduce((sum, p) => [sum[0] + p[0], sum[1] + p[1]], [0, 0]);\r\n    /** @type {[number, number]} */\r\n    const avg = (sum.map(x => x / points.length));\r\n    return avg;\r\n}\r\n/**\r\n *\r\n * @param {[number, number][]} points\r\n * @returns {[number, number]}\r\n */\r\n\r\nexport function getCentrePoint(points) {\r\n    const boundingBox = getBoundingBox(points);\r\n\r\n    return [\r\n        boundingBox[0] + boundingBox[2] / 2,\r\n        boundingBox[1] + boundingBox[3] / 2,\r\n    ];\r\n}\r\n/**\r\n *\r\n * @param {[number, number][]} points\r\n * @returns {[number, number]}\r\n */\r\n\r\nexport function getMidPoint(points) {\r\n    return points[Math.floor((points.length - 1) / 2)];\r\n}\r\n/**\r\n * @param {[number, number][]} points\r\n * @returns {[number, number, number, number]} (x, y, width, height)\r\n */\r\n\r\nexport function getBoundingBox(points) {\r\n    const minMax = points.reduce((minMax, point) => {\r\n        return [\r\n            Math.min(minMax[0], point[0]),\r\n            Math.min(minMax[1], point[1]),\r\n            Math.max(minMax[2], point[0]),\r\n            Math.max(minMax[3], point[1]),\r\n        ];\r\n    }, [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY]);\r\n\r\n    return [\r\n        minMax[0],\r\n        minMax[1],\r\n        minMax[2] - minMax[0],\r\n        minMax[3] - minMax[1],\r\n    ];\r\n}\r\n","\r\n/**\r\n * \r\n * @param {number} x \r\n * @param {number} y \r\n * @param {number} width \r\n * @param {number} height \r\n * @returns {[number, number][]}\r\n */\r\nexport function rectToPoints(x, y, width, height) {\r\n    /** @type {[number, number][]} */\r\n    return [\r\n        [x, y],\r\n        [x, y + height],\r\n        [x + width, y + height],\r\n        [x + width, y],\r\n    ];\r\n}\r\n\r\n\r\n/**\r\n * @see http://paulbourke.net/geometry/polygonmesh/#clockwise\r\n * @param {[number, number][]} points \r\n */\r\nexport function getCrossProductArea (points) {\r\n    let sum = 0;\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        sum += points[i][0] * points[i+1][1] - points[i+1][0] * points[i][1];\r\n    }\r\n    return sum / 2;\r\n}\r\n\r\n/**\r\n * @param {[number, number][]} points\r\n */\r\nexport function getArea (points) {\r\n    return Math.abs(getCrossProductArea(points));\r\n}\r\n\r\n/**\r\n * @param {[number, number][]} points\r\n */\r\nexport function isAntiClockwise (points) {\r\n    return getCrossProductArea(points) > 0;\r\n}\r\n\r\n/**\r\n * @see http://paulbourke.net/geometry/polygonmesh/#clockwise\r\n * @param {[number, number][]} points\r\n */\r\nexport function isConvex (points) {\r\n    const l = points.length;\r\n    if (l < 3) return;\r\n\r\n    let sign = 0;\r\n    for (let i = 1; i < l; i++) {\r\n        const a = points[i-1];\r\n        const b = points[i];\r\n        const c = points[(i+1) % l];\r\n        \r\n        const next = Math.sign((b[0] - a[0]) * (c[1] - b[1]) - (b[1] - a[1]) * (c[0] - b[0]));\r\n\r\n        if (sign === 0) sign = next;\r\n        else if (next !== 0 && sign !== next) return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**\r\n * @param {[number, number][]} points\r\n */\r\nexport function isSelfClosing (points) {\r\n    const f = points[0];\r\n    const l = points[points.length - 1]; \r\n    return f[0] === l[0] && f[1] === l[1];\r\n}\r\n\r\n/**\r\n * @param {[number, number][]} points\r\n */\r\nexport function getLength (points) {\r\n    let sum = 0;\r\n\r\n    for (let i = 1; i < points.length; i++) {\r\n        const dx = points[i][0] - points[i-1][0];\r\n        const dy = points[i][1] - points[i-1][1];\r\n        sum += Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    return sum;\r\n}","/**\r\n * @typedef StyleRule\r\n * @property {\"rule\"} type\r\n * @property {StyleSelector} [selector]\r\n * @property {StyleSelector[]} [selectors]\r\n * @property {{ [key: string]: string }} declarations\r\n */\r\n\r\n/**\r\n * @typedef MediaQuery\r\n * @property {\"query\"} type\r\n * @property {Predicate} predicate\r\n * @property {StyleRule[]} rules\r\n */\r\n\r\n/**\r\n * @typedef Predicate\r\n * @property {string|number|Predicate} left\r\n * @property {string} operator\r\n * @property {string|number|Predicate} right\r\n */\r\n\r\nexport class StyleSelector {\r\n    /**\r\n     * @param {string} type\r\n     * @param {{ [key: string]: string }} tags\r\n     * @param {{ name: string, params: (string|Predicate)[] }[]} pseudoClasses\r\n     * @param {string} [pseudoElement]\r\n     */\r\n    constructor (type, tags, pseudoClasses=[], pseudoElement=null) {\r\n      this.type = type;\r\n      this.tags = tags;\r\n      this.pseudoClasses = pseudoClasses;\r\n      this.pseudoElement = pseudoElement;\r\n    }\r\n\r\n    toString () {\r\n      return `${this.type}${Object.entries(this.tags).map(([k,v]) => {\r\n        const op = /^[<=>]/.test(v) ? \"\" : \"=\";\r\n        return `[${k}${op}${v}]`;\r\n      }).join(\"\")}`;\r\n    }\r\n}\r\n\r\nStyleSelector.parse = /**\r\n * @param {string} text\r\n */\r\nfunction (text) {\r\n    const re = /^\\s*([a-z]+)/;\r\n    const m = re.exec(text);\r\n\r\n    if (!m) return null;\r\n\r\n    let type = m[1];\r\n\r\n    if (type === \"rel\") {\r\n      type = \"relation\";\r\n    }\r\n\r\n    /** @type {{ [key: string]: string }} */\r\n    const tags = {};\r\n\r\n    let tagText = text.substring(m[0].length).trim();\r\n\r\n    const re2 = /^\\[([a-z0-9_-]+)(?:(=|<=|>=|<|>)([^[\\]]+))?\\]/i;\r\n\r\n    while (true) {\r\n      const m2 = re2.exec(tagText);\r\n\r\n      if (!m2) break;\r\n\r\n      const op = m2[2] === \"=\" ? \"\" : m2[2];\r\n\r\n      tags[m2[1]] = m2[3] ? op + m2[3] : \"*\";\r\n\r\n      tagText = tagText.substring(m2[0].length);\r\n    }\r\n\r\n    /** @type {{ name: string, params: (string|Predicate)[] }[]} */\r\n    const pseudoClasses = [];\r\n\r\n    const re3 = /^:([a-z-]+)(?:\\(([^)]+)\\))?/;\r\n\r\n    while (true) {\r\n      const m3 = re3.exec(tagText);\r\n\r\n      if (!m3) break;\r\n\r\n      const re = /^\\s*([^\\s)]+)\\s*(:|=|<=|>=|<|>|and|or)\\s*([^\\s)]+)(?:\\s*(=|<=|>=|<|>)\\s*([^\\s)]+))?/;\r\n      const params = m3[2] ? m3[2].split(\",\").map(s => re.test(s) ? makePredicate(re.exec(s)) : s) : [];\r\n      pseudoClasses.push({ name: m3[1], params });\r\n\r\n      tagText = tagText.substring(m3[0].length);\r\n    }\r\n\r\n    let pseudoElement = null;\r\n\r\n    const re4 = /^::([a-z-]+)?/;\r\n\r\n    if (re4.test(tagText)) {\r\n      const m4 = re4.exec(tagText);\r\n\r\n      pseudoElement = m4[1];\r\n\r\n      tagText = tagText.substring(m4[0].length);\r\n    }\r\n\r\n    if (tagText.length) {\r\n      console.log(`Invalid selector: ${text} unexpected part: '${tagText}'`);\r\n      return null;\r\n    }\r\n\r\n    return new StyleSelector(type, tags, pseudoClasses, pseudoElement);\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} text\r\n */\r\nStyleSelector.parseMultiple = function (text) {\r\n    return text.split(\",\").map(StyleSelector.parse).filter(x => x);\r\n}\r\n\r\n/**\r\n *\r\n * @param {{ rules: StyleRule[] }} style\r\n * @param {import(\"./Overpass\").OverpassElement} element\r\n * @returns {StyleRule}\r\n */\r\nexport function matchRule (style, element) {\r\n    for (const rule of style.rules) {\r\n      for (const selector of rule.selectors) {\r\n        if (matchSelector(selector, element))  return rule;\r\n      }\r\n    }\r\n}\r\n\r\n/**\r\n * @param {StyleSelector} selector\r\n * @param {import(\"./Overpass\").OverpassElement} element\r\n */\r\nexport function matchSelector (selector, element, inequalities=true) {\r\n  if (element.type !== selector.type && !(selector.type === \"area\" && element.type === \"way\")) return false;\r\n\r\n  const entries = Object.entries(selector.tags);\r\n  if (entries.length && typeof element.tags === \"undefined\") return false;\r\n\r\n  for (const [key, value] of entries) {\r\n    if (typeof element.tags[key] === \"undefined\") return false;\r\n\r\n    const m = /^[<=>]+/.exec(value);\r\n    if (m) {\r\n      // Only test if inequalities are enabled\r\n      if (inequalities) {\r\n        const op = m[0];\r\n        const cmp = COMPARE[op];\r\n        // Skip if invalid operator\r\n        if (!cmp) continue;\r\n        const v = value.substr(m[0].length);\r\n        // String compare or numeric compare\r\n        const res = isNaN(+v) ? cmp(element.tags[key].localeCompare(v), 0) : cmp(+element.tags[key], +v);\r\n\r\n        if (!res) return false;\r\n      }\r\n      // If inequalities are disabled then this tag gets a pass\r\n    }\r\n    else if (value !== \"*\" && element.tags[key] !== value) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * @param {string} styleText\r\n */\r\nexport function parseStyle (styleText) {\r\n  /** @type {{ rules: (StyleRule|MediaQuery)[] }} */\r\n  const out = { rules: [] };\r\n\r\n  let length = styleText.length;\r\n\r\n  while (length > 0) {\r\n\r\n    // Try parsing rule list\r\n    const rulesResult = parseRules(styleText);\r\n    out.rules.push(...rulesResult.rules);\r\n    styleText = styleText.substring(rulesResult.index).trim();\r\n\r\n    // Try parsing media query\r\n    const mediaResult = parseMedia(styleText);\r\n    out.rules.push(...mediaResult.mediaQueries);\r\n    styleText = styleText.substring(mediaResult.index).trim();\r\n\r\n    if (styleText.length === length) {\r\n      console.log(\"Got stuck parsing style at: \" + styleText);\r\n      break;\r\n    }\r\n\r\n    length = styleText.length;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * @param {string} mediaText\r\n */\r\nfunction parseMedia (mediaText) {\r\n  const re = /^\\s*@match\\s*\\(([^\\s)]+)\\s*(:|=|<=|>=|<|>|and|or)\\s*([^\\s)]+)(?:\\s*(=|<=|>=|<|>)\\s*([^\\s)]+))?\\)\\s*{/;\r\n  /** @type {{ mediaQueries: MediaQuery[], index: number }} */\r\n  const out = { mediaQueries: [], index: 0 };\r\n  let match;\r\n\r\n  const re2 = /^\\s*}/;\r\n  let match2;\r\n\r\n  while (match = re.exec(mediaText)) {\r\n    const predicate = makePredicate(match);\r\n\r\n    out.index += match[0].length;\r\n\r\n    mediaText = mediaText.substring(match[0].length);\r\n\r\n    const { rules, index } = parseRules(mediaText);\r\n\r\n    out.index += index;\r\n\r\n    mediaText = mediaText.substring(index);\r\n\r\n    match2 = re2.exec(mediaText);\r\n\r\n    if (match2) {\r\n      out.mediaQueries.push({\r\n        type: \"query\",\r\n        predicate,\r\n        rules,\r\n      });\r\n\r\n      out.index += match2[0].length;\r\n\r\n    } else {\r\n      console.log(\"Unterminated media query\");\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction parseRules (ruleText) {\r\n  const re = /^\\s*([^{}]+)\\s*{([^{}]*)}/;\r\n  let match;\r\n  /** @type {{ rules: StyleRule[], index: number }} */\r\n  const out = { rules: [], index: 0 };\r\n\r\n  while(match = re.exec(ruleText)) {\r\n    /** @type {{ [key: string]: string }} */\r\n    const declarations = {};\r\n\r\n    match[2].split(\";\").map(s => s.trim()).filter(s => s).forEach(s => {\r\n      // s.split(\":\", 2) is not the same as PHP\r\n      const i = s.indexOf(\":\");\r\n      const property = s.substring(0,i).trim();\r\n      const value = s.substring(i+1).trim();\r\n      declarations[property] = value;\r\n    });\r\n\r\n    const selectors = StyleSelector.parseMultiple(match[1]);\r\n\r\n    if (selectors.length) {\r\n      out.rules.push({\r\n        type: \"rule\",\r\n        selectors,\r\n        declarations,\r\n      });\r\n    }\r\n\r\n    out.index += match[0].length;\r\n\r\n    ruleText = ruleText.substring(match[0].length);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n *\r\n * @param {(StyleRule|MediaQuery)[]} rules\r\n * @param {object} context\r\n * @returns {StyleRule[]}\r\n */\r\nexport function expandRules (rules, context) {\r\n  /** @type {StyleRule[]} */\r\n  const out = [];\r\n  for (const rule of rules) {\r\n    if (rule.type === \"rule\") {\r\n      const { declarations } = rule;\r\n      for (const selector of rule.selectors) {\r\n        out.push({ type: \"rule\", selector, declarations });\r\n      }\r\n    } else {\r\n      if (testPredicate(rule.predicate, context)) {\r\n        out.push(...expandRules(rule.rules, context));\r\n      }\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction makePredicate(match) {\r\n  let predicate;\r\n\r\n  if (match[4]) {\r\n    // MediaQueries4 syntax:\r\n    //  @match (10 < zoom <= 14)\r\n    predicate = {\r\n      left: { left: match[1], operator: match[2], right: match[3] },\r\n      operator: \"and\",\r\n      right: { left: match[3], operator: match[4], right: match[5] },\r\n    };\r\n  }\r\n  else {\r\n    // MediaQueries4 syntax:\r\n    //  @match (zoom <= 14)\r\n    // MediaQueries3 syntax:\r\n    //  @match (max-zoom: 14) [TODO - it's parsed just not handled correctly]\r\n    predicate = {\r\n      left: match[1],\r\n      operator: match[2],\r\n      right: match[3],\r\n    };\r\n  }\r\n  return predicate;\r\n}\r\n\r\n/**\r\n *\r\n * @param {Predicate} predicate\r\n * @param {object} [context]\r\n * @returns {boolean}\r\n */\r\nexport function testPredicate (predicate, context={}) {\r\n  let left = typeof predicate.left === \"string\" || typeof predicate.left === \"number\" ?\r\n    predicate.left : testPredicate(predicate.left, context);\r\n  let right = typeof predicate.right === \"string\" || typeof predicate.right === \"number\"  ?\r\n    predicate.right : testPredicate(predicate.right, context);\r\n\r\n  if (typeof left === \"string\" && left in context) {\r\n    // Lazily evaluate and replace context value\r\n    if (context[left] instanceof Function)\r\n      context[left] = context[left]();\r\n\r\n    left = context[left];\r\n  }\r\n\r\n  if (typeof right === \"string\" && right in context) {\r\n    // Lazily evaluate and replace context value\r\n    if (context[right] instanceof Function)\r\n      context[right] = context[right]();\r\n\r\n    right = context[right];\r\n  }\r\n\r\n  const op = COMPARE[predicate.operator];\r\n\r\n  if (!op) return false;\r\n\r\n  return op(left, right);\r\n}\r\n\r\nconst COMPARE = {\r\n  \":\": (a,b) => a == b,\r\n  \"=\": (a,b) => a == b,\r\n  \">\": (a,b) => a > b,\r\n  \"<\": (a,b) => a < b,\r\n  \">=\": (a,b) => a >= b,\r\n  \"<=\": (a,b) => a <= b,\r\n  \"and\": (a,b) => a && b,\r\n  \"or\": (a,b) => a || b,\r\n}","import { getArea, isConvex, isAntiClockwise, getLength } from \"./geometry\";\r\nimport { testPredicate } from \"./Style\";\r\nimport { getBoundingBox } from \"./util\";\r\n\r\n/** @typedef {import(\"./Style\").StyleRule} StyleRule */\r\n/** @typedef {import(\"./Overpass\").OverpassElement} OverpassElement */\r\n\r\n\r\n/**\r\n * @param {StyleRule} rule\r\n * @param {[number, number][]} points\r\n * @param {import(\"./Overpass\").OverpassElement} element\r\n * @param {import(\"./Overpass\").OverpassElement[]} nodes\r\n */\r\nexport function matchPseudoClasses(rule, points, element=null, nodes = null) {\r\n    const { selector } = rule;\r\n\r\n    if (includesPseudoClass(selector, \"is\", \"convex\")) {\r\n        if (!isConvex(points))\r\n            return false;\r\n    }\r\n\r\n    if (includesPseudoClass(selector, \"is\", \"concave\")) {\r\n        if (isConvex(points))\r\n            return false;\r\n    }\r\n\r\n    if (includesPseudoClass(selector, \"is\", \"clockwise\")) {\r\n        if (isAntiClockwise(points))\r\n            return false;\r\n    }\r\n\r\n    if (includesPseudoClass(selector, \"is\", \"anti-clockwise\")) {\r\n        if (!isAntiClockwise(points))\r\n            return false;\r\n    }\r\n\r\n    if (includesPseudoClass(selector, \"is\", \"self-closing\")) {\r\n        if (nodes[0] !== nodes[points.length - 1])\r\n            return false;\r\n    }\r\n\r\n    const hasPseudoClasses = selector.pseudoClasses.filter(c => c.name === \"has\");\r\n\r\n    for (const pc of hasPseudoClasses) {\r\n        if (typeof pc.params[0] === \"string\")\r\n            return false;\r\n\r\n        const predicate = pc.params[0];\r\n\r\n        // Functions for lazy evaluation\r\n        const elementContext = {\r\n            area: () => getArea(points),\r\n            length: () => getLength(points),\r\n            width: () => getBoundingBox(points)[2],\r\n            height: () => getBoundingBox(points)[3],\r\n        };\r\n\r\n        const match = testPredicate(predicate, elementContext);\r\n\r\n        if (!match) return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * @todo Add support for more than one paramater\r\n * @param {import(\"./Overpass\").StyleSelector} selector\r\n * @param {string} name\r\n * @param  {...string} params\r\n */\r\nfunction includesPseudoClass (selector, name, ...params) {\r\n    return selector.pseudoClasses.some(c => c.name === name && c.params[0] === params[0]);\r\n}","/**\r\n * @param {import(\"./Style\").StyleRule} rule\r\n * @param {import(\"./Overpass\").OverpassElement} element\r\n * @param {import(\"./MapRenderer\").MapContext} context\r\n */\r\n\r\nexport function getContent(rule, element, context) {\r\n    let content = rule.declarations[\"content\"];\r\n\r\n    if (!content)\r\n        return \"\";\r\n\r\n    let index = 0;\r\n    /** @type {string[]} */\r\n    const out = [];\r\n\r\n    while (index < content.length) {\r\n        const c = content.substr(index);\r\n\r\n        let m = /^\\s+/.exec(c);\r\n        if (m) {\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        m = /^\"(.*?[^\\\\])\"/.exec(c);\r\n        if (m) {\r\n            out.push(m[1].replace(/\\\\\"/g, `\"`).replace(/\\\\n/g, `\\n`));\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        m = /^tag\\(([^)]+)\\)/.exec(c);\r\n        if (m) {\r\n            out.push(element.tags[m[1]] || \"\");\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        m = /^debug\\(([^)]+)\\)/.exec(c);\r\n        if (m) {\r\n            if (m[1] === \"type\") out.push(element.type);\r\n            else if (m[1] === \"tags\") out.push(Object.entries(element.tags).map(([key, value]) => `[${key}=${value}]`).join(\"\\n\"));\r\n            else if (m[1] === \"location\" && element.type === \"node\") out.push(`(${element.lon},${element.lat})`);\r\n            else if (m[1] === \"node_count\" && (element.type === \"way\" || element.type === \"area\")) out.push(element.nodes.length.toString());\r\n            // else if (m[1] === \"length\" && (element.type === \"way\" || element.type === \"area\")) out.push(getLength(element.).toString())\r\n            // else if (m[1] === \"area\" && (element.type === \"way\" || element.type === \"area\")) out.push(getArea(element.).toString())\r\n            else if (m[1] === \"scale\") out.push(context.scale.toString());\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        // Shouldn't get here\r\n        return \"?\";\r\n    }\r\n\r\n    return out.join(\"\");\r\n}\r\n","\r\n/**\r\n * Can the string be considered a valid bbox?\r\n * - Are there four parts?\r\n * - Are they all numberic?\r\n * - Are they in the correct order?\r\n * @param {string} bbox\r\n */\r\nexport function isValid (bbox) {\r\n    const parts = bbox.split(\",\");\r\n\r\n    if (parts.length !== 4) return false;\r\n\r\n    if (parts.some(p => isNaN(+p))) return false;\r\n\r\n    return +parts[0] < +parts[2] && +parts[1] < +parts[3];\r\n}\r\n\r\n/**\r\n * Determines whether or not areaB is entirely contained\r\n * within areaA\r\n * @param {string} areaA\r\n * @param {string} areaB\r\n * @returns {boolean}\r\n */\r\nexport function contains (areaA, areaB) {\r\n    const [Ax1,Ay1,Ax2,Ay2] = areaA.split(\",\");\r\n    const [Bx1,By1,Bx2,By2] = areaB.split(\",\");\r\n\r\n    return (Bx1 >= Ax1 && By1 >= Ay1 && Bx2 <= Ax2 && By2 <= Ay2);\r\n}\r\n\r\n/**\r\n * Compute simple area\r\n * @param {string} bbox\r\n */\r\nexport function getArea (bbox) {\r\n    const parts = bbox.split(\",\");\r\n    return (+parts[2] - +parts[0]) * (+parts[3] - +parts[1]);\r\n}\r\n\r\n/**\r\n *\r\n * @param {[number, number]} centre\r\n * @param {number} zoom\r\n * @param {[number, number]} size\r\n */\r\nexport function makeBBox (centre, zoom, size) {\r\n    const baseTileSize = 256;\r\n\r\n    const [ lon, lat ] = centre;\r\n    const [ width, height ] = size;\r\n\r\n    const tileCount = Math.pow(2, zoom)\r\n    const xSpan = 180 / tileCount;\r\n    const ySpan = 180 / tileCount;\r\n\r\n    const hTileCount = width / baseTileSize;\r\n    const vTileCount = height / baseTileSize;\r\n\r\n    const dLon = xSpan * hTileCount;\r\n    const dLat = ySpan * vTileCount;\r\n\r\n    return [ lon - dLon, lat - dLat, lon + dLon, lat + dLat ].map(p => p.toFixed(3)).join(\",\");\r\n}","import { mercatorProjection, getCentrePoint, getMidPoint, getAveragePoint, getBoundingBox } from \"./util\";\r\nimport { rectToPoints, isSelfClosing } from \"./geometry\";\r\nimport { matchPseudoClasses } from \"./matchPseudoClasses\";\r\nimport { getContent } from \"./getContent\";\r\nimport { makeBBox } from \"./bbox\";\r\nimport { matchSelector } from \"./Style\";\r\n\r\n/** @typedef {{ centre: [number, number], zoom: number, bbox: string, current?: { longitude: number, latitude: number }, width: number, height: number, scale: number }} MapContext */\r\n\r\nexport default class MapRenderer {\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {import(\"./Style\").StyleRule} rule\r\n     * @param {import(\"./Overpass\").OverpassElement[]} elements\r\n     */\r\n    renderRule (context, rule, elements=[]) {\r\n        // Prepare node map\r\n        /** @type {{ [id: number]: import(\"./Overpass\").OverpassNodeElement }} */\r\n        const nodeMap = {};\r\n        elements.forEach(n => n.type === \"node\" && (nodeMap[n.id] = n));\r\n        // Prepare way map\r\n        /** @type {{ [id: number]: import(\"./Overpass\").OverpassWayElement }} */\r\n        const wayMap = {};\r\n        elements.forEach(n => n.type === \"way\" && (wayMap[n.id] = n));\r\n\r\n        const { centre, zoom, width, height } = context;\r\n\r\n        /** @type {(lon: number, lat: number) => [number, number]} */\r\n        const projection = mercatorProjection(centre, zoom, width, height);\r\n\r\n        // Set up global context options\r\n        this.globalSetup(context, rule);\r\n\r\n        const { type } = rule.selector;\r\n\r\n        // Non-Overpass Types first\r\n        switch (type) {\r\n            case \"map\": {\r\n                const points = rectToPoints(0, 0, width, height);\r\n                if (rule.selector.pseudoElement)\r\n                    this.renderPseudoElement(context, rule, points, null, null);\r\n                else\r\n                    this.renderArea(context, rule, points, null);\r\n                break;\r\n            }\r\n            case \"current\": {\r\n                if (context.current) {\r\n                    const coords = context.current;\r\n                    this.renderPoint(context, rule, projection(coords.longitude, coords.latitude));\r\n                }\r\n                break;\r\n            }\r\n            case \"gridlines\": {\r\n                this.renderGridlines(context, rule, projection);\r\n                break;\r\n            }\r\n            case \"dummy\": {\r\n                this.renderPoint(context, rule, [0, 0]);\r\n                break;\r\n            }\r\n            default:\r\n                // Then iterate all elements\r\n                for (const el of elements) {\r\n                    if (!matchSelector(rule.selector, el)) continue;\r\n\r\n                    switch (type) {\r\n                        case \"node\": {\r\n                            if (el.type !== \"node\") continue;\r\n\r\n                            const point = projection(el.lon, el.lat);\r\n\r\n                            if (rule.selector.pseudoElement) {\r\n                                this.renderPseudoElement(context, rule, [point], el, [el]);\r\n                            }\r\n                            else {\r\n                                this.renderPoint(context, rule, point, el);\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"way\":\r\n                        case \"area\": {\r\n                            if (el.type !== \"way\") continue;\r\n\r\n                            /** @type {import(\"./Overpass\").OverpassNodeElement[]} */\r\n                            const nodes = el.nodes.map(id => nodeMap[id]);\r\n                            const points = nodes.map(n => projection(n.lon, n.lat));\r\n\r\n                            if (!matchPseudoClasses(rule, points, el, nodes)) continue;\r\n\r\n                            if (rule.selector.pseudoElement) {\r\n                                this.renderPseudoElement(context, rule, points, el, nodes);\r\n                            }\r\n                            else {\r\n                                // Render actual way/area\r\n                                if (type === \"area\") {\r\n                                    this.renderArea(context, rule, points, el);\r\n                                } else {\r\n                                    this.renderLine(context, rule, points, el);\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"relation\": {\r\n                            if (el.type !== \"relation\") continue;\r\n\r\n                            // this.renderRelation(rule, el, wayMap, nodeMap, projection, context);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n    renderPoint (context, rule, point, element=null) {}\r\n\r\n    renderLine (context, rule, points, element=null) {\r\n        this.renderAreaLine(context, rule, points, getMidPoint, element);\r\n    }\r\n\r\n    renderArea (context, rule, points, element=null) {\r\n        if (points.length === 0)\r\n            return;\r\n\r\n        if (!isSelfClosing(points)) {\r\n            points = [ ...points, points[0] ];\r\n        }\r\n\r\n        this.renderAreaLine(context, rule, points, getCentrePoint, element);\r\n    }\r\n\r\n    renderAreaLine (context, rule, points, getPoint, element=null) {}\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {import(\"./Style\").StyleRule} rule\r\n     * @param {[number, number][]} points\r\n     * @param {import(\"./Overpass\").OverpassElement} [element]\r\n     * @param {import(\"./Overpass\").OverpassNodeElement[]} [nodes]\r\n     */\r\n    renderPseudoElement(context, rule, points, element=null, nodes=null) {\r\n        switch (rule.selector.pseudoElement) {\r\n            case \"centre\":\r\n            case \"center\": {\r\n                // Centre of bounding box\r\n                const centrePoint = getCentrePoint(points);\r\n                this.renderPoint(context, rule, centrePoint, element);\r\n                break;\r\n            }\r\n            case \"mid-point\": {\r\n                // N/2th point (median point)\r\n                const midPoint = getMidPoint(points);\r\n                this.renderPoint(context, rule, midPoint, element);\r\n                break;\r\n            }\r\n            case \"average-point\": {\r\n                // Average of all points\r\n                const avgPoint = getAveragePoint(points);\r\n                this.renderPoint(rule, avgPoint, element, context);\r\n                break;\r\n            }\r\n            case \"start\": {\r\n                // First point\r\n                this.renderPoint(context, rule, points[0], element);\r\n                break;\r\n            }\r\n            case \"end\": {\r\n                // Last point\r\n                this.renderPoint(context, rule, points[points.length - 1], element);\r\n                break;\r\n            }\r\n            case \"centre-of-mass\": {\r\n                // TODO: calculate centre-of-mass\r\n                // const avgPoint = getCOMPoint(points);\r\n                // renderPoint(ctx, rule, avgPoint, element);\r\n                break;\r\n            }\r\n            case \"bounding-box\": {\r\n                const bounding = getBoundingBox(points);\r\n\r\n                const boundingPoints = rectToPoints(...bounding);\r\n\r\n                this.renderArea(context, rule, boundingPoints, element);\r\n                break;\r\n            }\r\n            case \"content-box\": {\r\n                const { scale } = context;\r\n                let [ x, y ] = points[0];\r\n\r\n                const content = getContent(rule, element, context);\r\n\r\n                if (!content) return;\r\n\r\n                let width = Number.NEGATIVE_INFINITY;;\r\n                let top = Number.NaN;\r\n                let bottom;\r\n                let baseline = y;\r\n                for (const line of content.split(\"\\n\")) {\r\n                    const size = this.measureText(context, rule, line);\r\n\r\n                    width = Math.max(width, size.width);\r\n\r\n                    if (isNaN(top)) top = y - size.ascending;\r\n\r\n                    bottom = baseline + size.descending;\r\n\r\n                    baseline += size.height;\r\n                }\r\n\r\n                const padding = rule.declarations[\"padding\"] ? parseFloat(rule.declarations[\"padding\"]) * scale : 0;\r\n\r\n                if (rule.declarations[\"text-align\"] === \"center\" || rule.declarations[\"text-align\"] === \"centre\") {\r\n                    x -= width / 2;\r\n                }\r\n                else if (rule.declarations[\"text-align\"] === \"right\") {\r\n                    x -= width;\r\n                }\r\n\r\n                /** @type {[number, number][]} */\r\n                const boundPoints = [\r\n                    [ x - padding,           top - padding ],     // Top Left\r\n                    [ x - padding,           bottom + padding ],    // Bottom left\r\n                    [ x + width + padding,   bottom + padding ],    // Bottom right\r\n                    [ x + width + padding,   top - padding ],     // Top Right\r\n                ];\r\n\r\n                // Close self\r\n                boundPoints.push(boundPoints[0]);\r\n\r\n                this.renderAreaLine(context, rule, boundPoints, () => points[0], element);\r\n                break;\r\n            }\r\n            case \"decimate\": {\r\n                if (rule.selector.type === \"way\") {\r\n                    const l = points.length - 1;\r\n                    const decimatedPoints = points.filter((p, i) => i % 10 === 0 || i === l);\r\n                    this.renderLine(context, rule, decimatedPoints, element);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    renderGridlines (context, rule, projection) {\r\n        const vertical = rule.selector.pseudoClasses.find(p => p.name === \"vertical\");\r\n        const horizontal = rule.selector.pseudoClasses.find(p => p.name === \"horizontal\");\r\n\r\n        const { width, height, centre, zoom } = context;\r\n\r\n        const bbox = makeBBox(centre, zoom, [width, height]);\r\n        const parts = bbox.split(\",\");\r\n\r\n        if (vertical) {\r\n            const step = parseFloat(vertical.params[0]);\r\n\r\n            const round = 1 / step;\r\n\r\n            const sigFigs = Math.ceil(Math.log10(round));\r\n\r\n            const xmin = Math.floor(+parts[0] * round) / round;\r\n            const xmax = Math.ceil(+parts[2] * round) / round;\r\n            const ymin = Math.floor(+parts[1] * round) / round;\r\n            const ymax = Math.ceil(+parts[3] * round) / round;\r\n\r\n            for (let i = xmin; i <= xmax; i += step) {\r\n                const points = [ projection(i, ymin),  projection(i, (ymin + ymax) / 2), projection(i, ymax) ];\r\n                this.renderLine(context, rule, points, { type: \"way\", id: 0, nodes: [], tags: { name: i.toFixed(sigFigs) }});\r\n            }\r\n        }\r\n\r\n        if (horizontal) {\r\n            const step = parseFloat(horizontal.params[0]);\r\n\r\n            const round = 1 / step;\r\n\r\n            const sigFigs = Math.ceil(Math.log10(round));\r\n\r\n            const xmin = Math.floor(+parts[0] * round) / round;\r\n            const xmax = Math.ceil(+parts[2] * round) / round;\r\n            const ymin = Math.floor(+parts[1] * round) / round;\r\n            const ymax = Math.ceil(+parts[3] * round) / round;\r\n\r\n            for (let j = ymin; j <= ymax; j += step) {\r\n                const points = [ projection(xmin, j), projection((xmin + xmax) / 2, j), projection(xmax, j) ];\r\n                this.renderLine(context, rule, points, { type: \"way\", id: 0, nodes: [], tags: { name: j.toFixed(sigFigs) }});\r\n            }\r\n        }\r\n    }\r\n\r\n    clear (context) {}\r\n\r\n    globalSetup (context, rule) { }\r\n\r\n    /**\r\n     *\r\n     * @param {MapContext} context\r\n     * @param {import(\"./Style\").StyleRule} rule\r\n     * @param {string} text\r\n     * @return {{ width: number, ascending: number, descending: number, height: number }}\r\n     */\r\n    measureText (context, rule, text) {\r\n        return { width: 0, ascending: 0, descending: 0, height: 0 };\r\n    }\r\n}","import { parseStrokeFill } from '../parseStrokeFill';\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {import(\"../Style\").StyleRule} rule\r\n */\r\nexport function setStrokeFill (ctx, rule, scale) {\r\n    const { fillStyle, strokeStyle, lineWidth } = parseStrokeFill(rule, scale);\r\n\r\n    ctx.fillStyle = fillStyle;\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n}","export function parseStrokeFill(rule, scale) {\r\n    const fillStyle = rule.declarations[\"fill\"];\r\n    let strokeStyle = rule.declarations[\"stroke\"];\r\n    let lineWidth;\r\n\r\n    if (strokeStyle) {\r\n        // Numbers in e.g. rgba(128,64,0,0.2) confuse it\r\n        let mutedStyle = strokeStyle.replace(/\\([^)]*\\)/g, ss => \" \".repeat(ss.length));\r\n\r\n        // So would hex colour strings\r\n        mutedStyle = mutedStyle.replace(/#[0-9a-f]{3}/i, \"    \");\r\n        mutedStyle = mutedStyle.replace(/#[0-9a-f]{6}/i, \"       \");\r\n\r\n        /**\r\n         * @todo A better parser would probably be nice\r\n         */\r\n        const swRe = /(\\d+(?:\\.\\d+)?)\\s*(?:px)?/;\r\n        const sm = swRe.exec(mutedStyle);\r\n        if (sm) {\r\n            lineWidth = +sm[1] * scale;\r\n            strokeStyle = strokeStyle.replace(sm[0], \"\");\r\n        }\r\n    }\r\n\r\n    if (rule.declarations[\"stroke-width\"]) {\r\n        lineWidth = +rule.declarations[\"stroke-width\"] * scale;\r\n    }\r\n\r\n    return {\r\n        fillStyle,\r\n        strokeStyle,\r\n        lineWidth,\r\n    };\r\n}","/** @typedef {import(\"../Style\").StyleRule} StyleRule */\r\n/** @typedef {import(\"../Overpass\").OverpassElement} OverpassElement */\r\n\r\nimport { setStrokeFill } from \"./setStrokeFill\";\r\nimport { getContent } from \"../getContent\";\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {[number, number]} param2\r\n * @param {OverpassElement} [element]\r\n */\r\nexport function renderText(ctx, rule, [x, y], element = null, context) {\r\n    setStrokeFill(ctx, rule, context.scale);\r\n\r\n    let content = getContent(rule, element, context);\r\n\r\n    setFont(ctx, rule, context.scale);\r\n\r\n    for (const line of content.split(\"\\n\")) {\r\n        y += renderLine(ctx, rule, line, x, y);\r\n    }\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {string} content\r\n * @param {number} x\r\n * @param {number} y\r\n */\r\nfunction renderLine(ctx, rule, content, x, y) {\r\n    const size = ctx.measureText(content);\r\n\r\n    if (rule.declarations[\"text-align\"]) {\r\n        const textWidth = size.width;\r\n\r\n        if (rule.declarations[\"text-align\"] === \"center\" || rule.declarations[\"text-align\"] === \"centre\") {\r\n            x -= textWidth / 2;\r\n        }\r\n        else if (rule.declarations[\"text-align\"] === \"right\") {\r\n            x -= textWidth;\r\n        }\r\n    }\r\n\r\n    if (rule.declarations[\"text-stroke\"]) {\r\n        ctx.strokeStyle = rule.declarations[\"text-stroke\"];\r\n        ctx.strokeText(content, x, y);\r\n    }\r\n\r\n    if (rule.declarations[\"text-color\"] || !rule.declarations[\"text-stroke\"]) {\r\n        ctx.fillStyle = rule.declarations[\"text-color\"];\r\n        ctx.fillText(content, x, y);\r\n    }\r\n\r\n    const height = size.actualBoundingBoxAscent + size.actualBoundingBoxDescent;\r\n    return height;\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {number} scale\r\n */\r\nexport function setFont(ctx, rule, scale) {\r\n    let fontSize = `${10 * scale}px`;\r\n    let fontWeight = \"normal\";\r\n    let fontFamily = \"sans-serif\";\r\n\r\n    if (rule.declarations[\"font\"]) {\r\n        // It would be nice for the specific properties to override the\r\n        // shorthand, but it would complicate things a bit.\r\n        ctx.font = rule.declarations[\"font\"].replace(/\\d+(?:\\.\\d+)?/, s => `${+s * scale}`);\r\n    }\r\n    else {\r\n        if (rule.declarations[\"font-size\"]) {\r\n            fontSize = rule.declarations[\"font-size\"].replace(/^\\d[\\d.]*/, m => `${+m * scale}`);\r\n        }\r\n\r\n        if (rule.declarations[\"font-weight\"]) {\r\n            fontWeight = rule.declarations[\"font-weight\"];\r\n        }\r\n\r\n        if (rule.declarations[\"font-family\"]) {\r\n            fontFamily = rule.declarations[\"font-family\"];\r\n        }\r\n\r\n        ctx.font = `${fontWeight} ${fontSize} ${fontFamily}`;\r\n    }\r\n}\r\n","/** @typedef {import(\"../Style\").StyleRule} StyleRule */\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n */\r\nexport function applyTransform(ctx, rule, scale) {\r\n\r\n    if (rule.declarations[\"transform\"]) {\r\n        const r = /\\s*([a-z]+)\\(([^)]*)\\)\\s*/g;\r\n        const t = rule.declarations[\"transform\"];\r\n        let m;\r\n        while (m = r.exec(t)) {\r\n            const trans = m[1];\r\n            const params = m[2].split(\",\").map(s => ({ value: parseFloat(s) * scale, unit: s.replace(/[-\\d.\\s]/g, \"\") }));\r\n            switch (trans) {\r\n                case \"matrix\":\r\n                    // @ts-ignore\r\n                    ctx.transform(...params.map(p => p.value));\r\n                    break;\r\n                case \"rotate\": {\r\n                    let { value, unit } = params[0];\r\n\r\n                    if (unit === \"deg\") {\r\n                        value *= Math.PI / 180;\r\n                    } else if (unit === \"turn\") {\r\n                        value *= Math.PI * 2;\r\n                    }\r\n\r\n                    ctx.rotate(value);\r\n                    break;\r\n                }\r\n                case \"scale\":\r\n                    const x = params[0].value;\r\n                    const y = params[1] ? params[1].value : x;\r\n                    ctx.scale(x, y);\r\n                    break;\r\n                case \"translate\":\r\n                    // @ts-ignore\r\n                    ctx.translate(...params.map(p => p.value));\r\n                    break;\r\n                case \"skew\":\r\n                    let { value, unit } = params[0];\r\n\r\n                    if (unit === \"rad\")\r\n                        value = Math.tan(value);\r\n                    else if (unit === \"deg\")\r\n                        value = Math.tan(value * Math.PI / 180);\r\n\r\n                    let valueY = 0;\r\n\r\n                    if (params[1]) {\r\n                        let { value, unit } = params[1];\r\n\r\n                        if (unit === \"rad\")\r\n                            value = Math.tan(value);\r\n                        else if (unit === \"deg\")\r\n                            value = Math.tan(value * Math.PI / 180);\r\n\r\n                        valueY = value;\r\n                    }\r\n\r\n                    ctx.transform(1, valueY, value, 1, 0, 0);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { renderText } from \"./renderText\";\r\nimport { setStrokeFill } from \"./setStrokeFill\";\r\nimport { applyTransform } from \"./transform\";\r\n\r\n/** @typedef {import(\"../Style\").StyleRule} StyleRule */\r\n/** @typedef {import(\"../Overpass\").OverpassElement} OverpassElement */\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {[number, number]} position\r\n * @param {OverpassElement} element\r\n */\r\nexport function renderPoint(ctx, rule, [x, y], element = null, context = {}) {\r\n    ctx.save();\r\n\r\n    const { scale } = context;\r\n\r\n    setStrokeFill(ctx, rule, scale);\r\n\r\n    if (rule.declarations[\"position\"] === \"absolute\") {\r\n        x = (parseFloat(rule.declarations[\"left\"]) || 0) * scale;\r\n        y = (parseFloat(rule.declarations[\"top\"]) || 0) * scale;\r\n    }\r\n    ctx.translate(x, y);\r\n\r\n    applyTransform(ctx, rule, scale);\r\n\r\n    if (rule.declarations[\"size\"]) {\r\n        ctx.beginPath();\r\n\r\n        const r = +rule.declarations[\"size\"] * scale;\r\n\r\n        ctx.ellipse(0, 0, r, r, 0, 0, Math.PI * 2);\r\n\r\n        rule.declarations[\"fill\"] && ctx.fill();\r\n        rule.declarations[\"stroke\"] && ctx.stroke();\r\n    }\r\n\r\n    if (rule.declarations[\"path\"]) {\r\n        ctx.beginPath();\r\n\r\n        drawPath(ctx, rule.declarations[\"path\"], scale);\r\n\r\n        rule.declarations[\"fill\"] && ctx.fill();\r\n        rule.declarations[\"stroke\"] && ctx.stroke();\r\n    }\r\n\r\n    // Syntax:\r\n    //  url(<URL>) [<width> [<height>]]\r\n    //  url(https://ijmacd.github.io/map-maker/logo192.png) 90px 120px;\r\n    const urlRe = /url\\(([^)]+)\\)(?:\\s+([^\\s]+)(?:\\s+([^\\s]+))?)?/;\r\n    if (urlRe.test(rule.declarations[\"icon\"])) {\r\n        const m = urlRe.exec(rule.declarations[\"icon\"]);\r\n        const url = m[1];\r\n        const img = new Image();\r\n        img.src = url;\r\n        const w = parseFloat(m[2]);\r\n        const h = parseFloat(m[3]);\r\n\r\n\r\n        img.addEventListener(\"load\", () => {\r\n            // The image is drawn in a callback so the render context state is lost\r\n            ctx.save();\r\n            // globalSetup(ctx, rule);\r\n\r\n            ctx.translate(x, y);\r\n\r\n            // applyTransform(ctx, rule);\r\n\r\n            if (w) {\r\n                const height = !isNaN(h) ? h : img.height * (w / img.width);\r\n                ctx.drawImage(img, 0, 0, w * scale, height * scale);\r\n            }\r\n            else {\r\n                ctx.drawImage(img, 0, 0);\r\n            }\r\n\r\n            ctx.restore();\r\n        });\r\n    }\r\n\r\n    if (rule.declarations[\"content\"]) {\r\n        renderText(ctx, rule, [0, 0], element, context);\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {string} pathSpec\r\n */\r\nfunction drawPath (ctx, pathSpec, scale) {\r\n    const segs = /([MLQCVHZ])\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?/ig;\r\n    let match;\r\n    /** @type {[number, number]} */\r\n    let first;\r\n    /** @type {[number, number]} */\r\n    let prev;\r\n\r\n    while (match = segs.exec(pathSpec)) {\r\n        const x = parseFloat(match[2]) * scale;\r\n        const y = parseFloat(match[3]) * scale;\r\n        const x2 = parseFloat(match[4]) * scale;\r\n        const y2 = parseFloat(match[5]) * scale;\r\n        const x3 = parseFloat(match[6]) * scale;\r\n        const y3 = parseFloat(match[7]) * scale;\r\n\r\n        if (!first) first = [x,y];\r\n\r\n        if (match[1] === \"M\") {\r\n            prev = [x,y];\r\n            ctx.moveTo(x, y);\r\n        }\r\n        else if (match[1] === \"L\") {\r\n            prev = [x,y];\r\n            ctx.lineTo(x, y);\r\n        }\r\n        else if (match[1] === \"Q\") {\r\n            prev = [x2,y2];\r\n            ctx.quadraticCurveTo(x, y, x2, y2);\r\n        }\r\n        else if (match[1] === \"C\") {\r\n            prev = [x3,y3];\r\n            ctx.bezierCurveTo(x, y, x2, y2, x3, y3);\r\n        }\r\n        else if (match[1] === \"Z\") {\r\n            prev = first;\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"V\") {\r\n            prev = [prev[0], x];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"H\") {\r\n            prev = [x, prev[1]];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"m\") {\r\n            prev = [prev[0] + x, prev[1] + y];\r\n            ctx.moveTo(...prev);\r\n        }\r\n        else if (match[1] === \"l\") {\r\n            prev = [prev[0] + x, prev[1] + y];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"q\") {\r\n            ctx.quadraticCurveTo(prev[0] + x, prev[1] + y, prev[0] + x2, prev[1] + y2);\r\n            prev = [prev[0] + x2, prev[1] + y2];\r\n        }\r\n        else if (match[1] === \"c\") {\r\n            prev = [x3,y3];\r\n            ctx.bezierCurveTo(prev[0] + x, prev[1] + y, prev[0] + x2, prev[1] + y2, prev[0] + x3, prev[1] + y3);\r\n            prev = [prev[0] + x3, prev[1] + y3];\r\n        }\r\n        else if (match[1] === \"z\") {\r\n            prev = first;\r\n            ctx.lineTo(...first);\r\n        }\r\n        else if (match[1] === \"v\") {\r\n            prev = [prev[0], prev[1] + x];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"h\") {\r\n            prev = [prev[0] + x, prev[1]];\r\n            ctx.lineTo(...prev);\r\n        }\r\n    }\r\n}","export default class CollisionSystem {\r\n    /** @type {CollisionSystem} */\r\n    static singleton;\r\n\r\n    constructor () {\r\n        /** @type {{ [name: string]: [number, number, number, number][] }} */\r\n        this.sets = {}\r\n    }\r\n\r\n    clear () {\r\n        this.sets = {};\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} set\r\n     * @param {[number, number, number, number]} box\r\n     */\r\n    add (set, box) {\r\n        if (!this.sets[set]) this.sets[set] = [];\r\n\r\n        for (const other of this.sets[set]) {\r\n            if (intersects(box, other)) return false;\r\n        }\r\n\r\n        this.sets[set].push(box);\r\n\r\n        return true;\r\n    }\r\n\r\n    static getCollisionSystem () {\r\n        if (!this.singleton) {\r\n            this.singleton = new CollisionSystem();\r\n        }\r\n\r\n        return this.singleton;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * [x , y, width, height]\r\n * @param {[number, number, number, number]} boxA\r\n * @param {[number, number, number, number]} boxB\r\n */\r\nfunction intersects (boxA, boxB) {\r\n    const ax1 = boxA[0];\r\n    const ay1 = boxA[1];\r\n    const ax2 = boxA[0] + boxA[2];\r\n    const ay2 = boxA[1] + boxA[3];\r\n    const bx1 = boxB[0];\r\n    const by1 = boxB[1];\r\n    const bx2 = boxB[0] + boxB[2];\r\n    const by2 = boxB[1] + boxB[3];\r\n    return ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;\r\n}","import { renderPoint } from \"./renderPoint\";\r\nimport { applyTransform } from \"./transform\";\r\nimport { setStrokeFill } from \"./setStrokeFill\";\r\nimport { getBoundingBox } from \"../util\";\r\nimport CollisionSystem from \"../CollisionSystem\";\r\n\r\n/** @typedef {import(\"../Style\").StyleRule} StyleRule */\r\n/** @typedef {import(\"../Overpass\").OverpassElement} OverpassElement */\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {[number, number][]} points\r\n * @param {(points: [number, number][]) => [number, number]} getPoint\r\n * @param {OverpassElement} element\r\n */\r\nexport function renderAreaLine(ctx, rule, points, getPoint, element = null, context = {}) {\r\n    if (points.length === 0)\r\n        return;\r\n\r\n\r\n    if (rule.declarations[\"collision-set\"]) {\r\n        const box = getBoundingBox(points);\r\n\r\n        if (rule.declarations[\"collision-size\"]) {\r\n            const s = /(\\d+\\.?\\d*)%/.exec(rule.declarations[\"collision-size\"]);\r\n\r\n            const scaleFactor = +s[1] / 100;\r\n            const w = box[2];\r\n            const h = box[3];\r\n\r\n            box[0] += (1 - scaleFactor) * w / 2;\r\n            box[1] += (1 - scaleFactor) * h / 2;\r\n            box[2] = w * scaleFactor;\r\n            box[3] = h * scaleFactor;\r\n        }\r\n\r\n        const collisionSystem = CollisionSystem.getCollisionSystem();\r\n\r\n        if (!collisionSystem.add(rule.declarations[\"collision-set\"], box)) {\r\n            const policy = rule.declarations[\"collision-policy\"] || \"hide\";\r\n\r\n            if (policy === \"hide\") {\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    ctx.save();\r\n\r\n    setStrokeFill(ctx, rule, context.scale);\r\n\r\n    let offsetX = 0;\r\n    let offsetY = 0;\r\n\r\n    if (rule.declarations[\"transform\"]) {\r\n        // Extra work required if we're transforming\r\n\r\n        // First get transform origin;\r\n        const cp = getPoint(points);\r\n\r\n        // Set offset to adjust all points later\r\n        offsetX = cp[0];\r\n        offsetY = cp[1];\r\n\r\n        // Translate the canvas\r\n        ctx.translate(offsetX, offsetY);\r\n\r\n        // Apply the transformation\r\n        applyTransform(ctx, rule, context.scale);\r\n    }\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(points[0][0] - offsetX, points[0][1] - offsetY);\r\n    for (let i = 1; i < points.length; i++) {\r\n        ctx.lineTo(points[i][0] - offsetX, points[i][1] - offsetY);\r\n    }\r\n\r\n    rule.declarations[\"fill\"] && ctx.fill();\r\n    rule.declarations[\"stroke\"] && ctx.stroke();\r\n\r\n    ctx.restore();\r\n\r\n    // Text Handling, Icons etc.\r\n    if (rule.declarations[\"content\"] || rule.declarations[\"size\"] || rule.declarations[\"path\"] || rule.declarations[\"icon\"]) {\r\n        ctx.save();\r\n        renderPoint(ctx, rule, getPoint(points), element, context);\r\n        ctx.restore();\r\n    }\r\n}\r\n\r\n\r\n","import MapRenderer from \"../MapRenderer\";\r\nimport { renderPoint } from \"./renderPoint\";\r\nimport { setFont } from \"./renderText\";\r\nimport { renderAreaLine } from \"./renderAreaLine\";\r\n\r\n/** @typedef {import(\"../Style\").StyleRule} StyleRule */\r\n/** @typedef {import(\"../Overpass\").OverpassElement} OverpassElement */\r\n\r\n\r\nexport default class CanvasRender extends MapRenderer {\r\n\r\n    /**\r\n     * @param {HTMLCanvasElement|OffscreenCanvas} canvas\r\n     */\r\n    constructor (canvas) {\r\n        super();\r\n        this.canvas = canvas;\r\n    }\r\n\r\n    clear (context) {\r\n        const { width, height } = context;\r\n\r\n        this.canvas.width = width;\r\n        this.canvas.height = height;\r\n    }\r\n\r\n    renderRule (context, rule, elements=[]) {\r\n        const ctx = this.canvas.getContext(\"2d\");\r\n        ctx.save();\r\n        super.renderRule(context, rule, elements);\r\n        ctx.restore();\r\n    }\r\n\r\n    globalSetup({ scale }, rule) {\r\n        const ctx = this.canvas.getContext(\"2d\");\r\n\r\n        if (rule.declarations[\"opacity\"])\r\n            ctx.globalAlpha = +rule.declarations[\"opacity\"];\r\n\r\n        if (rule.declarations[\"position\"] === \"relative\") {\r\n            const top = (parseFloat(rule.declarations[\"top\"]) || 0) * scale;\r\n            const left = (parseFloat(rule.declarations[\"left\"]) || 0) * scale;\r\n\r\n            ctx.translate(left, top);\r\n        }\r\n    }\r\n\r\n    renderPoint (context, rule, point, element=null) {\r\n        const ctx = this.canvas.getContext(\"2d\");\r\n        renderPoint(ctx, rule, point, element, context);\r\n    }\r\n\r\n    renderAreaLine (context, rule, points, getPoint, element=null) {\r\n        const ctx = this.canvas.getContext(\"2d\");\r\n        renderAreaLine(ctx, rule, points, getPoint, element, context);\r\n    }\r\n\r\n    measureText (context, rule, text) {\r\n        const ctx = this.canvas.getContext(\"2d\");\r\n        const { scale } = context;\r\n        setFont(ctx, rule, scale);\r\n        const size = ctx.measureText(text);\r\n        const { width, actualBoundingBoxDescent: descending, actualBoundingBoxAscent: ascending } = size;\r\n\r\n        return {\r\n            width,\r\n            ascending,\r\n            descending,\r\n            height: ascending + descending,\r\n        };\r\n    }\r\n}\r\n\r\n","import setPrototypeOf from \"./setPrototypeOf\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import getPrototypeOf from \"./getPrototypeOf\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn\";\nexport default function _createSuper(Derived) {\n  return function () {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (isNativeReflectConstruct()) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","import { contains, getArea } from \"./bbox\";\r\n\r\nexport default class IDBElementDatabase {\r\n    constructor (name=\"OverpassElements\") {\r\n        const request = indexedDB.open(name);\r\n\r\n        request.addEventListener(\"upgradeneeded\", ev => {\r\n            /** @type {IDBOpenDBRequest} */\r\n            const request = (ev.target);\r\n            const db = request.result;\r\n            db.createObjectStore(\"nodes\", { keyPath: \"id\" });\r\n\r\n            const store = db.createObjectStore(\"elements\");\r\n            store.createIndex(\"selectorIndex\", [\"selector\", \"area\", \"bbox\"], { unique: false });\r\n        });\r\n\r\n        /** @type {Promise<IDBDatabase>} */\r\n        this.db = new Promise((resolve, reject) => {\r\n            request.addEventListener(\"success\", ev => {\r\n                /** @type {IDBOpenDBRequest} */\r\n                const request = (ev.target);\r\n                resolve(request.result);\r\n            });\r\n\r\n            request.addEventListener(\"error\", reject);\r\n        })\r\n\r\n    }\r\n\r\n    async saveNodes (nodes) {\r\n        const db = await this.db;\r\n        const store = db.transaction(\"nodes\", \"readwrite\").objectStore(\"nodes\");\r\n        for (const n of nodes) {\r\n            store.put(n);\r\n        }\r\n    }\r\n\r\n    async getNode (id) {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const store = db.transaction(\"nodes\", \"readonly\").objectStore(\"nodes\");\r\n            const request = store.get(id);\r\n            request.addEventListener(\"success\", e => resolve(request.result));\r\n            request.addEventListener(\"error\", e => reject(e));\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number[]} ids\r\n     */\r\n    getNodes (ids) {\r\n        return Promise.all(ids.map(id => this.getNode(id)));\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @returns {Promise<{ elements: import(\"./Overpass\").OverpassElement[] }>}\r\n     */\r\n    getElements (bbox, selector) {\r\n        const key = makeKey(bbox, selector);\r\n        return this.getElementsByKey(key);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} key\r\n     * @returns {Promise<{ elements: import(\"./Overpass\").OverpassElement[] }>}\r\n     */\r\n    async getElementsByKey (key) {\r\n        const db = await this.db;\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readonly\").objectStore(\"elements\");\r\n            const request = objectStore.get(key);\r\n            request.addEventListener(\"success\", e => resolve(request.result));\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @returns {Promise<string>}\r\n     */\r\n    async searchElements (bbox, selector) {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readonly\").objectStore(\"elements\");\r\n            const index = objectStore.index(\"selectorIndex\");\r\n            const range = IDBKeyRange.bound([selector,0,\"0\"], [selector,Number.MAX_VALUE,\"999999999999999999\"]);\r\n            const request = index.openKeyCursor(range);\r\n            let count = 0;\r\n            const bboxOversizeArea = getArea(bbox) * 9;\r\n            request.addEventListener(\"success\", e => {\r\n                const cursor = request.result;\r\n\r\n                if (cursor) {\r\n                    const { key, primaryKey } = cursor;\r\n                    const keyBBox = key[2];\r\n                    const keyArea = key[1];\r\n                    count++;\r\n                    console.debug(`Checking index #${count} for ${selector}`);\r\n                    if (contains(keyBBox, bbox) && keyArea < bboxOversizeArea) {\r\n                        console.debug(`${selector} found after checking ${count} records`);\r\n                        resolve(primaryKey.toString());\r\n                        return;\r\n                    }\r\n                    cursor.continue();\r\n                }\r\n                else {\r\n                    console.debug(`${selector} not found after checking ${count} records`);\r\n                    resolve(null);\r\n                }\r\n            });\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @param {{ elements: import(\"./Overpass\").OverpassElement[], cached: number }} record\r\n     */\r\n    async saveElements (bbox, selector, record) {\r\n        const db = await this.db;\r\n        const key = makeKey(bbox, selector);\r\n        const area = getArea(bbox);\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readwrite\").objectStore(\"elements\");\r\n            const request = objectStore.put({ selector, bbox, area, ...record }, key);\r\n            request.addEventListener(\"success\", () => {\r\n                console.debug(`Saved ${selector}/${bbox} to database with ${record.elements.length} elements`);\r\n                resolve();\r\n            });\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    // Delete all saved nodes\r\n    async clear () {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const req = db.transaction(\"elements\", \"readwrite\").objectStore(\"elements\").clear();\r\n            req.onsuccess = resolve;\r\n            req.onerror = reject;\r\n        });\r\n    }\r\n}\r\n\r\nfunction makeKey (bbox, selector) {\r\n    const bkey = bbox.split(\",\").map(p => (+p).toFixed(3)).join(\",\");\r\n    return `${selector}/${bkey}`;\r\n}\r\n","import IDBElementDatabase from \"./database.idb\";\r\nimport { contains } from \"./bbox\";\r\nimport { matchSelector } from \"./Style\";\r\nimport { timeout } from './util';\r\n\r\n/** @typedef {import(\"./Style\").StyleSelector} StyleSelector */\r\n\r\nconst API_ROOT = require(\"./const\").API_ROOT;\r\n\r\nconst overpassRe = /^(node|way|rel(?:ation)?|area)/;\r\nconst recurRe = /^(way|rel(?:ation)?|area)/;\r\n\r\nexport class Overpass {\r\n    /** @param {string} bbox */\r\n    constructor (bbox=null) {\r\n        /** @type {Map<string, Promise<OverpassElement[]>>} */\r\n        this.elements = new Map();\r\n        this.bbox = bbox;\r\n        this.database = new IDBElementDatabase();\r\n        /** @type {{ [url: string]: Promise<OverpassElement[]> }} */\r\n        this.fetchMap = {};\r\n        /** @type {Promise<any>} */\r\n        this.currentJob = Promise.resolve();\r\n    }\r\n\r\n    setBBox (bbox) {\r\n        // If the new bbox is completely contained within the\r\n        // old one then we don't need to clear our cache\r\n        if (this.bbox && !contains(this.bbox, bbox)) {\r\n            this.elements.clear();\r\n        }\r\n        this.bbox = bbox;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     */\r\n    async preLoadElements (selectors) {\r\n        return this.jobs(async () => {\r\n            const { bbox } = this;\r\n\r\n            if (!this.bbox) {\r\n                throw Error(\"No bounding box specified\");\r\n            }\r\n\r\n            // Create set of selectors\r\n            /** @type {{ [key: string]: StyleSelector }} */\r\n            const set = {};\r\n            selectors.forEach(s => set[mapSelector(s)] = s);\r\n\r\n            console.debug(`Preloading Elements: ${selectors.length} requested (${Object.keys(set).length} unique)`);\r\n\r\n            // Remove non-overpass selectors\r\n            for (const [key, selector] of Object.entries(set)) {\r\n                if (!overpassRe.test(selector.type)) delete set[key];\r\n            }\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} are Overpass Elements`);\r\n\r\n            // Remove selectors found in local hash map cache\r\n            for (const key of Object.keys(set)) {\r\n                if (this.elements.has(key)) delete set[key];\r\n            }\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} not in HashMap`);\r\n\r\n            // Remove selectors which were found in database\r\n            await Promise.all(Object.keys(set).map(s => {\r\n                return this.database.searchElements(bbox, s)\r\n                    .then(els => {\r\n                        if (els) delete set[s];\r\n                    });\r\n            }));\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} not in Database`);\r\n\r\n            if (Object.keys(set).length === 0) return 0;\r\n\r\n            const elements = await this.tryQuery(Object.values(set));\r\n\r\n            console.log(`Preloading Elements: Fetched ${elements.length} elements from Server`);\r\n\r\n            // Prepare node map\r\n            /** @type {{ [id: number]: import(\"./Overpass\").OverpassNodeElement }} */\r\n            const nodeMap = {};\r\n            elements.forEach(n => n.type === \"node\" && (nodeMap[n.id] = n));\r\n            // Prepare way map\r\n            /** @type {{ [id: number]: import(\"./Overpass\").OverpassWayElement }} */\r\n            const wayMap = {};\r\n            elements.forEach(n => n.type === \"way\" && (wayMap[n.id] = n));\r\n\r\n            await Promise.all(Object.values(set).map(selector => {\r\n                const out = elements.filter(el => matchSelector(selector, el, false));\r\n\r\n                if (selector.type === \"relation\") {\r\n                    /** @type {OverpassRelElement[]} */\r\n                    const rels = (out.slice());\r\n\r\n                    /** @type {OverpassWayElement[]} */\r\n                    const ways = [];\r\n\r\n                    for (const rel of rels) {\r\n                        const refs = rel.members.map(m => m.ref);\r\n                        ways.push(...refs.map(id => wayMap[id]));\r\n                    }\r\n\r\n                    out.push(...ways);\r\n\r\n                    for (const way of ways) {\r\n                        out.push(...way.nodes.map(id => nodeMap[id]));\r\n                    }\r\n\r\n                } else if (selector.type === \"way\" || selector.type === \"area\") {\r\n                    /** @type {OverpassWayElement[]} */\r\n                    const ways = (out.slice());\r\n\r\n                    for (const way of ways) {\r\n                        out.push(...way.nodes.map(id => nodeMap[id]));\r\n                    }\r\n                }\r\n\r\n                this.elements.set(mapSelector(selector), Promise.resolve(out));\r\n                return this.database.saveElements(bbox, mapSelector(selector), { elements: out, cached: Date.now() });\r\n            }));\r\n\r\n            return elements.length;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    query (selectors) {\r\n        if (this.bbox.split(\",\").map(p => +p).some(isNaN)) throw Error(\"Invalid BBox\");\r\n\r\n        const sMap = selectors.map(mapSelectorForQuery);\r\n        const query = `[out:json][bbox];\\n(${sMap.join(\"\")}\\n);\\nout;`\r\n        const url = `${API_ROOT}?data=${query.replace(/\\s/,\"\")}&bbox=${clampBBox(this.bbox)}`;\r\n\r\n        if (!this.fetchMap[url]) {;\r\n            this.fetchMap[url] = fetch(url.toString()).then(r => r.ok ? r.json() : Promise.reject(r.status)).then(r => r.elements);\r\n\r\n            this.fetchMap[url].finally(() => delete this.fetchMap[url]);\r\n        }\r\n\r\n        return this.fetchMap[url];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     * @param {number} tries\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    tryQuery (selectors, tries=10) {\r\n        return this.query(selectors).catch(e => {\r\n            if (e !== 429) throw Error(\"Bad Response\");\r\n\r\n            if (tries > 0) {\r\n                return timeout(10000).then(() => this.tryQuery(selectors, tries - 1))\r\n            }\r\n\r\n            throw Error(\"Too many retries fetching data\");\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @param {import(\"./Style\").StyleSelector} selector\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    async getElements (selector) {\r\n        if (!overpassRe.test(selector.type)) return;\r\n\r\n        if (!this.bbox) return;\r\n\r\n        const s = mapSelector(selector);\r\n        if (this.elements.has(s)) return this.elements.get(s);\r\n\r\n        const dbResult = await this.database.getElements(this.bbox, s);\r\n\r\n        if (dbResult) {\r\n            const { elements } = dbResult;\r\n            this.elements.set(s, Promise.resolve(elements));\r\n            return elements;\r\n        }\r\n\r\n        const dbSearchResult = await this.database.searchElements(this.bbox, s);\r\n\r\n        if (dbSearchResult) {\r\n            const elements = this.database.getElementsByKey(dbSearchResult).then(r => r.elements);\r\n            this.elements.set(s, elements);\r\n            return elements;\r\n        }\r\n\r\n        const p = this.tryQuery([selector]);\r\n\r\n        this.elements.set(s, p);\r\n\r\n        p.catch(() => this.elements.delete(s));\r\n\r\n        p.then(elements => {\r\n            this.database.saveElements(this.bbox, s, { elements, cached: Date.now() });\r\n        });\r\n\r\n        return p;\r\n    }\r\n\r\n    jobs (fn) {\r\n        this.currentJob = this.currentJob.then(() => fn());\r\n\r\n        return this.currentJob;\r\n    }\r\n\r\n    // Delete everything from cache\r\n    clearCache (database = false) {\r\n        this.elements.clear();\r\n        if (database)\r\n            return this.database.clear();\r\n    }\r\n}\r\n\r\n/** @param {StyleSelector} selector */\r\nfunction mapSelectorForQuery (selector) {\r\n    const recur = recurRe.test(selector.type) ? \">;\" : \"\";\r\n    return `${mapSelector(selector)};${recur}`;\r\n}\r\n\r\n/** @param {StyleSelector} selector */\r\nfunction mapSelector (selector) {\r\n    const type = selector.type === \"area\" ? \"way\" : selector.type;\r\n    const tags = Object.entries(selector.tags).map(([k,v]) => {\r\n        return (/^[<=>]+/.test(v) || v === \"*\") ? `[${k}]` : `[${k}=${v}]`;\r\n    });\r\n    return `${type}${tags.join(\"\")}`;\r\n}\r\n\r\n/** @typedef {import('./Style.js').StyleRule} StyleRule */\r\n\r\n/**\r\n * @typedef {OverpassNodeElement|OverpassWayElement|OverpassAreaElement|OverpassRelElement} OverpassElement\r\n */\r\n\r\n/**\r\n * @typedef OverpassNodeElement\r\n * @property {number} id\r\n * @property {\"node\"} type\r\n * @property {number} lon\r\n * @property {number} lat\r\n * @property {{ [key: string]: string }} [tags]\r\n */\r\n\r\n/**\r\n * @typedef OverpassWayElement\r\n * @property {number} id\r\n * @property {\"way\"} type\r\n * @property {number[]} nodes\r\n * @property {{ [key: string]: string }} [tags]\r\n */\r\n\r\n/**\r\n * @typedef OverpassAreaElement\r\n * @property {number} id\r\n * @property {\"area\"} type\r\n * @property {number[]} nodes\r\n * @property {{ [key: string]: string }} [tags]\r\n */\r\n\r\n/**\r\n * @typedef OverpassRelElement\r\n * @property {number} id\r\n * @property {\"relation\"} type\r\n * @property {{ ref: number, role: \"inner\"|\"outer\", type: \"node\"|\"way\"|\"relation\" }[]} members\r\n * @property {{ [key: string]: string }} [tags]\r\n */\r\n\r\nfunction clampBBox (bbox) {\r\n    const p = bbox.split(\",\").map(p => +p);\r\n    return `${clamp(p[0], -180, 180)},${clamp(p[1], -90, 90)},${clamp(p[2], -180, 180)},${clamp(p[3], -90, 90)}`;\r\n}\r\n\r\nfunction clamp (v, min, max) {\r\n    return Math.max(min, Math.min(v, max));\r\n}","import CanvasRender from './canvas-render';\r\nimport { Overpass } from './Overpass';\r\n\r\n/** @type {OffscreenCanvas} */\r\nlet canvas;\r\n/** @type {import('./MapRenderer').default} */\r\nlet renderer;\r\n/** @type {Overpass} */\r\nlet overpass = new Overpass();\r\n\r\nlet chain = Promise.resolve();\r\n\r\nonmessage = (msg) => {\r\n    if (msg.data.canvas) {\r\n        canvas = msg.data.canvas;\r\n        renderer = new CanvasRender(canvas);\r\n    }\r\n\r\n    if (msg.data.method === \"clear\") {\r\n        const { context: { width, height, bbox } } = msg.data;\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        overpass.setBBox(bbox);\r\n\r\n        chain = Promise.resolve();\r\n    }\r\n\r\n    if (msg.data.method === \"renderRule\") {\r\n        /** @type {{ context: import('./MapRenderer').MapContext, rule: import('./Style').StyleRule }} */\r\n        const { context, rule } = msg.data;\r\n\r\n        overpass.setBBox(context.bbox);\r\n        const pElements = overpass.getElements(rule.selector);\r\n\r\n        chain = chain.then(() => pElements.then(elements => renderer.renderRule(context, rule, elements)));\r\n    }\r\n};"],"sourceRoot":""}