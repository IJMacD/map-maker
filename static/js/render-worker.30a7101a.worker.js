!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/map-maker/",n(n.s=3)}([function(e,t,n){e.exports=n(1)},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(O){c=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var a=t&&t.prototype instanceof f?t:f,o=Object.create(a.prototype),i=new E(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return j()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=w(i,n);if(c){if(c===l)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,i),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(O){return{type:"throw",arg:O}}}e.wrap=s;var l={};function f(){}function h(){}function d(){}var p={};p[a]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(P([])));y&&y!==t&&n.call(y,a)&&(p=y);var g=d.prototype=f.prototype=Object.create(p);function m(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(a,o){function i(){return new t((function(r,i){!function r(a,o,i,c){var s=u(e[a],e,o);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"===typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}(a,o,r,i)}))}return r=r?r.then(i,i):i()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:j}}function j(){return{value:void 0,done:!0}}return h.prototype=g.constructor=d,d.constructor=h,h.displayName=c(d,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(b.prototype),b.prototype[o]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new b(s(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},m(g),c(g,i,"Generator"),g[a]=function(){return this},g.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;k(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=r}catch(a){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";n.r(t),n.d(t,"API_ROOT",(function(){return r}));var r="https://overpass-api.de/api/interpreter"},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t,n){return(c="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e){return(l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){return!t||"object"!==l(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(s){a=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=d(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}function g(e){return new Promise((function(t){return setTimeout(t,e)}))}function m(e,t,n,r){var a=p(e,2),o=a[0],i=a[1],c=Math.pow(2,t),s=256/(180/c),u=256/(180/c),l=Math.PI/4,f=n/2,h=r/2,d=180*Math.log(Math.tan(l+i/180*Math.PI/2))/Math.PI;return function(e,t){var n=e,r=180*Math.log(Math.tan(l+t/180*Math.PI/2))/Math.PI;return[f+(n-o)*s,h-(r-d)*u]}}function b(e){return e.reduce((function(e,t){return[e[0]+t[0],e[1]+t[1]]}),[0,0]).map((function(t){return t/e.length}))}function w(e){var t=k(e);return[t[0]+t[2]/2,t[1]+t[3]/2]}function x(e){return e[Math.floor((e.length-1)/2)]}function k(e){var t=e.reduce((function(e,t){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[2],t[0]),Math.max(e[3],t[1])]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]);return[t[0],t[1],t[2]-t[0],t[3]-t[1]]}function E(e,t,n,r){return[[e,t],[e,t+r],[e+n,t+r],[e+n,t]]}function P(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n][0]*e[n+1][1]-e[n+1][0]*e[n][1];return t/2}function j(e){return Math.abs(P(e))}function O(e){return P(e)>0}function S(e){var t=e.length;if(!(t<3)){for(var n=0,r=1;r<t;r++){var a=e[r-1],o=e[r],i=e[(r+1)%t],c=Math.sign((o[0]-a[0])*(i[1]-o[1])-(o[1]-a[1])*(i[0]-o[0]));if(0===n)n=c;else if(0!==c&&n!==c)return!1}return!0}}function M(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]}function L(e){for(var t=0,n=1;n<e.length;n++){var r=e[n][0]-e[n-1][0],a=e[n][1]-e[n-1][1];t+=Math.sqrt(r*r+a*a)}return t}n.r(t);var I=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r(this,e),this.type=t,this.tags=n,this.pseudoClasses=a,this.pseudoElement=o}return o(e,[{key:"toString",value:function(){return"".concat(this.type).concat(Object.entries(this.tags).map((function(e){var t=p(e,2),n=t[0],r=t[1],a=/^[<=>]/.test(r)?"":"=";return"[".concat(n).concat(a).concat(r,"]")})).join(""))}}]),e}();function T(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.type!==e.type&&("area"!==e.type||"way"!==t.type))return!1;var r=Object.entries(e.tags);if(r.length&&"undefined"===typeof t.tags)return!1;for(var a=0,o=r;a<o.length;a++){var i=p(o[a],2),c=i[0],s=i[1];if("undefined"===typeof t.tags[c])return!1;var u=/^[<=>]+/.exec(s);if(u){if(n){var l=u[0],f=F[l];if(!f)continue;var h=s.substr(u[0].length),d=isNaN(+h)?f(t.tags[c].localeCompare(h),0):f(+t.tags[c],+h);if(!d)return!1}}else if("*"!==s&&t.tags[c]!==s)return!1}return!0}function N(e){return e[4]?{left:{left:e[1],operator:e[2],right:e[3]},operator:"and",right:{left:e[3],operator:e[4],right:e[5]}}:{left:e[1],operator:e[2],right:e[3]}}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="string"===typeof e.left||"number"===typeof e.left?e.left:_(e.left,t),r="string"===typeof e.right||"number"===typeof e.right?e.right:_(e.right,t);"string"===typeof n&&n in t&&(t[n]instanceof Function&&(t[n]=t[n]()),n=t[n]),"string"===typeof r&&r in t&&(t[r]instanceof Function&&(t[r]=t[r]()),r=t[r]);var a=F[e.operator];return!!a&&a(n,r)}I.parse=function(e){var t=/^\s*([a-z]+)/.exec(e);if(!t)return null;var n=t[1];"rel"===n&&(n="relation");for(var r={},a=e.substring(t[0].length).trim(),o=/^\[([a-z0-9_-]+)(?:(=|<=|>=|<|>)([^[\]]+))?\]/i;;){var i=o.exec(a);if(!i)break;var c="="===i[2]?"":i[2];r[i[1]]=i[3]?c+i[3]:"*",a=a.substring(i[0].length)}for(var s=[],u=/^:([a-z-]+)(?:\(([^)]+)\))?/,l=function(){var e=u.exec(a);if(!e)return"break";var t=/^\s*([^\s)]+)\s*(:|=|<=|>=|<|>|and|or)\s*([^\s)]+)(?:\s*(=|<=|>=|<|>)\s*([^\s)]+))?/,n=e[2]?e[2].split(",").map((function(e){return t.test(e)?N(t.exec(e)):e})):[];s.push({name:e[1],params:n}),a=a.substring(e[0].length)};;){if("break"===l())break}var f=null,h=/^::([a-z-]+)?/;if(h.test(a)){var d=h.exec(a);f=d[1],a=a.substring(d[0].length)}return a.length?(console.log("Invalid selector: ".concat(e," unexpected part: '").concat(a,"'")),null):new I(n,r,s,f)},I.parseMultiple=function(e){return e.split(",").map(I.parse).filter((function(e){return e}))};var F={":":function(e,t){return e==t},"=":function(e,t){return e==t},">":function(e,t){return e>t},"<":function(e,t){return e<t},">=":function(e,t){return e>=t},"<=":function(e,t){return e<=t},and:function(e,t){return e&&t},or:function(e,t){return e||t}};function A(e,t){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=e.selector;if(C(r,"is","convex")&&!S(t))return!1;if(C(r,"is","concave")&&S(t))return!1;if(C(r,"is","clockwise")&&O(t))return!1;if(C(r,"is","anti-clockwise")&&!O(t))return!1;if(C(r,"is","self-closing")&&n[0]!==n[t.length-1])return!1;var a,o=r.pseudoClasses.filter((function(e){return"has"===e.name})),i=y(o);try{for(i.s();!(a=i.n()).done;){var c=a.value;if("string"===typeof c.params[0])return!1;var s=c.params[0],u={area:function(){return j(t)},length:function(){return L(t)},width:function(){return k(t)[2]},height:function(){return k(t)[3]}},l=_(s,u);if(!l)return!1}}catch(f){i.e(f)}finally{i.f()}return!0}function C(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.pseudoClasses.some((function(e){return e.name===t&&e.params[0]===r[0]}))}function B(e,t,n){var r=e.declarations.content;if(!r)return"";for(var a=0,o=[];a<r.length;){var i=r.substr(a),c=/^\s+/.exec(i);if(c)a+=c[0].length;else if(c=/^"(.*?[^\\])"/.exec(i))o.push(c[1].replace(/\\"/g,'"').replace(/\\n/g,"\n")),a+=c[0].length;else if(c=/^tag\(([^)]+)\)/.exec(i))o.push(t.tags[c[1]]||""),a+=c[0].length;else{if(!(c=/^debug\(([^)]+)\)/.exec(i)))return"?";"type"===c[1]?o.push(t.type):"tags"===c[1]?o.push(Object.entries(t.tags).map((function(e){var t=p(e,2),n=t[0],r=t[1];return"[".concat(n,"=").concat(r,"]")})).join("\n")):"location"===c[1]&&"node"===t.type?o.push("(".concat(t.lon,",").concat(t.lat,")")):"node_count"!==c[1]||"way"!==t.type&&"area"!==t.type?"scale"===c[1]&&o.push(n.scale.toString()):o.push(t.nodes.length.toString()),a+=c[0].length}}return o.join("")}function R(e,t){var n=p(e.split(","),4),r=n[0],a=n[1],o=n[2],i=n[3],c=p(t.split(","),4),s=c[0],u=c[1],l=c[2],f=c[3];return s>=r&&u>=a&&l<=o&&f<=i}function z(e){var t=e.split(",");return(+t[2]-+t[0])*(+t[3]-+t[1])}var D=function(){function e(){r(this,e)}return o(e,[{key:"renderRule",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={};n.forEach((function(e){return"node"===e.type&&(r[e.id]=e)}));var a={};n.forEach((function(e){return"way"===e.type&&(a[e.id]=e)}));var o=e.centre,i=e.zoom,c=e.width,s=e.height,u=m(o,i,c,s);this.globalSetup(e,t);var l=t.selector.type;switch(l){case"map":var f=E(0,0,c,s);t.selector.pseudoElement?this.renderPseudoElement(e,t,f,null,null):this.renderArea(e,t,f,null);break;case"current":if(e.current){var h=e.current;this.renderPoint(e,t,u(h.longitude,h.latitude))}break;case"gridlines":this.renderGridlines(e,t,u);break;case"dummy":this.renderPoint(e,t,[0,0]);break;default:var d,p=y(n);try{for(p.s();!(d=p.n()).done;){var v=d.value;if(T(t.selector,v))switch(l){case"node":if("node"!==v.type)continue;var g=u(v.lon,v.lat);t.selector.pseudoElement?this.renderPseudoElement(e,t,[g],v,[v]):this.renderPoint(e,t,g,v);break;case"way":case"area":if("way"!==v.type)continue;var b=v.nodes.map((function(e){return r[e]})),w=b.map((function(e){return u(e.lon,e.lat)}));if(!A(t,w,v,b))continue;t.selector.pseudoElement?this.renderPseudoElement(e,t,w,v,b):"area"===l?this.renderArea(e,t,w,v):this.renderLine(e,t,w,v);break;case"relation":if("relation"!==v.type)continue}}}catch(x){p.e(x)}finally{p.f()}}}},{key:"renderPoint",value:function(e,t,n){}},{key:"renderLine",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.renderAreaLine(e,t,n,x,r)}},{key:"renderArea",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;0!==n.length&&(M(n)||(n=[].concat(v(n),[n[0]])),this.renderAreaLine(e,t,n,w,r))}},{key:"renderAreaLine",value:function(e,t,n,r){}},{key:"renderPseudoElement",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;switch(t.selector.pseudoElement){case"centre":case"center":var a=w(n);this.renderPoint(e,t,a,r);break;case"mid-point":var o=x(n);this.renderPoint(e,t,o,r);break;case"average-point":var i=b(n);this.renderPoint(t,i,r,e);break;case"start":this.renderPoint(e,t,n[0],r);break;case"end":this.renderPoint(e,t,n[n.length-1],r);break;case"centre-of-mass":break;case"bounding-box":var c=k(n),s=E.apply(void 0,v(c));this.renderArea(e,t,s,r);break;case"content-box":var u=e.scale,l=n[0];"way"===t.selector.type?l=x(n):"area"===t.selector.type&&(l=w(n));var f=l,h=p(f,2),d=h[0],g=h[1],m=B(t,r,e);if(!m)return;var P,j,O=Number.NEGATIVE_INFINITY,S=Number.NaN,M=g,L=y(m.split("\n"));try{for(L.s();!(j=L.n()).done;){var I=j.value,T=this.measureText(e,t,I);O=Math.max(O,T.width),isNaN(S)&&(S=g-T.ascending),P=M+T.descending,M+=T.height}}catch(C){L.e(C)}finally{L.f()}var N=t.declarations.padding?parseFloat(t.declarations.padding)*u:0;"center"===t.declarations["text-align"]||"centre"===t.declarations["text-align"]?d-=O/2:"right"===t.declarations["text-align"]&&(d-=O);var _=[[d-N,S-N],[d-N,P+N],[d+O+N,P+N],[d+O+N,S-N]];_.push(_[0]),this.renderAreaLine(e,t,_,(function(){return l}),r);break;case"decimate":if("way"===t.selector.type){var F=n.length-1,A=n.filter((function(e,t){return t%10===0||t===F}));this.renderLine(e,t,A,r)}}}},{key:"renderGridlines",value:function(e,t,n){var r=t.selector.pseudoClasses.find((function(e){return"vertical"===e.name})),a=t.selector.pseudoClasses.find((function(e){return"horizontal"===e.name})),o=e.width,i=e.height,c=function(e,t,n){var r=p(e,2),a=r[0],o=r[1],i=p(n,2),c=i[0],s=i[1],u=Math.pow(2,t),l=180/u*(c/256),f=180/u*(s/256);return[a-l,o-f,a+l,o+f].map((function(e){return e.toFixed(3)})).join(",")}(e.centre,e.zoom,[o,i]).split(",");if(r)for(var s=parseFloat(r.params[0]),u=1/s,l=Math.ceil(Math.log10(u)),f=Math.floor(+c[0]*u)/u,h=Math.ceil(+c[2]*u)/u,d=Math.floor(+c[1]*u)/u,v=Math.ceil(+c[3]*u)/u,y=f;y<=h;y+=s){var g=[n(y,d),n(y,(d+v)/2),n(y,v)];this.renderLine(e,t,g,{type:"way",id:0,nodes:[],tags:{name:y.toFixed(l)}})}if(a)for(var m=parseFloat(a.params[0]),b=1/m,w=Math.ceil(Math.log10(b)),x=Math.floor(+c[0]*b)/b,k=Math.ceil(+c[2]*b)/b,E=Math.floor(+c[1]*b)/b,P=Math.ceil(+c[3]*b)/b,j=E;j<=P;j+=m){var O=[n(x,j),n((x+k)/2,j),n(k,j)];this.renderLine(e,t,O,{type:"way",id:0,nodes:[],tags:{name:j.toFixed(w)}})}}},{key:"clear",value:function(e){}},{key:"globalSetup",value:function(e,t){}},{key:"measureText",value:function(e,t,n){return{width:0,ascending:0,descending:0,height:0}}}]),e}();function G(e,t,n){var r=function(e,t){var n,r,a=e.declarations.fill,o=e.declarations.stroke;if(o){var i=o.replace(/\([^)]*\)/g,(function(e){return" ".repeat(e.length)}));i=(i=i.replace(/#[0-9a-f]{3}/i,"    ")).replace(/#[0-9a-f]{6}/i,"       ");var c=/(\d+(?:\.\d+)?)\s*(?:px)?/.exec(i);c&&(n=+c[1]*t,o=o.replace(c[0],""))}return e.declarations["stroke-width"]&&(n=+e.declarations["stroke-width"]*t),e.declarations["stroke-dash"]&&(r=e.declarations["stroke-dash"].split(" ").map((function(e){return+e*t}))),{fillStyle:a,strokeStyle:o,lineWidth:n,lineDash:r}}(t,n),a=r.fillStyle,o=r.strokeStyle,i=r.lineWidth,c=r.lineDash;e.fillStyle=a,e.strokeStyle=o,e.lineWidth=i,c&&e.setLineDash(c)}function q(e,t,n){var r=p(n,2),a=r[0],o=r[1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;G(e,t,c.scale);var s=B(t,i,c);Y(e,t,c.scale);var u,l=y(s.split("\n"));try{for(l.s();!(u=l.n()).done;){var f=u.value;o+=V(e,t,f,a,o,c)}}catch(h){l.e(h)}finally{l.f()}}function V(e,t,n,r,a,o){var i=e.measureText(n);if(t.declarations["text-align"]){var c=i.width;"center"===t.declarations["text-align"]||"centre"===t.declarations["text-align"]?r-=c/2:"right"===t.declarations["text-align"]&&(r-=c)}return t.declarations["stroke-width"]&&(e.lineWidth=parseFloat(t.declarations["stroke-width"])*o.scale),t.declarations["text-stroke"]&&(e.strokeStyle=t.declarations["text-stroke"],e.strokeText(n,r,a)),!t.declarations["text-color"]&&t.declarations["text-stroke"]||(e.fillStyle=t.declarations["text-color"],e.fillText(n,r,a)),i.actualBoundingBoxAscent+i.actualBoundingBoxDescent}function Y(e,t,n){var r="".concat(10*n,"px"),a="normal",o="sans-serif";t.declarations.font?e.font=t.declarations.font.replace(/\d+(?:\.\d+)?/,(function(e){return"".concat(+e*n)})):(t.declarations["font-size"]&&(r=t.declarations["font-size"].replace(/^\d[\d.]*/,(function(e){return"".concat(+e*n)}))),t.declarations["font-weight"]&&(a=t.declarations["font-weight"]),t.declarations["font-family"]&&(o=t.declarations["font-family"]),e.font="".concat(a," ").concat(r," ").concat(o))}function K(e,t,n){if(t.declarations.transform)for(var r,a=/\s*([a-z]+)\(([^)]*)\)\s*/g,o=t.declarations.transform;r=a.exec(o);){var i=r[1],c=r[2].split(",").map((function(e){return{value:parseFloat(e)*n,unit:e.replace(/[-\d.\s]/g,"")}}));switch(i){case"matrix":e.transform.apply(e,v(c.map((function(e){return e.value}))));break;case"rotate":var s=c[0],u=s.value,l=s.unit;"deg"===l?u*=Math.PI/180:"turn"===l&&(u*=2*Math.PI),e.rotate(u);break;case"scale":var f=c[0].value,h=c[1]?c[1].value:f;e.scale(f,h);break;case"translate":e.translate.apply(e,v(c.map((function(e){return e.value}))));break;case"skew":var d=c[0],p=d.value,y=d.unit;"rad"===y?p=Math.tan(p):"deg"===y&&(p=Math.tan(p*Math.PI/180));var g=0;if(c[1]){var m=c[1],b=m.value,w=m.unit;"rad"===w?b=Math.tan(b):"deg"===w&&(b=Math.tan(b*Math.PI/180)),g=b}e.transform(1,g,p,1,0,0)}}}function Q(e,t,n){var r=p(n,2),a=r[0],o=r[1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};e.save();var s=c.scale;if(G(e,t,s),"absolute"===t.declarations.position&&(a=(parseFloat(t.declarations.left)||0)*s,o=(parseFloat(t.declarations.top)||0)*s),e.translate(a,o),K(e,t,s),t.declarations.size){e.beginPath();var u=+t.declarations.size*s;e.ellipse(0,0,u,u,0,0,2*Math.PI),t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke()}t.declarations.path&&(e.beginPath(),J(e,t.declarations.path,s),t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke());var l=/url\(([^)]+)\)(?:\s+([^\s]+)(?:\s+([^\s]+))?)?/;if(l.test(t.declarations.icon)){var f=l.exec(t.declarations.icon),h=f[1],d=new Image;d.src=h;var v=parseFloat(f[2]),y=parseFloat(f[3]);d.addEventListener("load",(function(){if(e.save(),e.translate(a,o),v){var t=isNaN(y)?d.height*(v/d.width):y;e.drawImage(d,0,0,v*s,t*s)}else e.drawImage(d,0,0);e.restore()}))}t.declarations.content&&q(e,t,[0,0],i,c),e.restore()}function J(e,t,n){for(var r,a,o,i=/([MLQCVHZ])\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?/gi;r=i.exec(t);){var c=parseFloat(r[2])*n,s=parseFloat(r[3])*n,u=parseFloat(r[4])*n,l=parseFloat(r[5])*n,f=parseFloat(r[6])*n,h=parseFloat(r[7])*n;a||(a=[c,s]),"M"===r[1]?(o=[c,s],e.moveTo(c,s)):"L"===r[1]?(o=[c,s],e.lineTo(c,s)):"Q"===r[1]?(o=[u,l],e.quadraticCurveTo(c,s,u,l)):"C"===r[1]?(o=[f,h],e.bezierCurveTo(c,s,u,l,f,h)):"Z"===r[1]?(o=a,e.lineTo.apply(e,v(o))):"V"===r[1]?(o=[o[0],c],e.lineTo.apply(e,v(o))):"H"===r[1]?(o=[c,o[1]],e.lineTo.apply(e,v(o))):"m"===r[1]?(o=[o[0]+c,o[1]+s],e.moveTo.apply(e,v(o))):"l"===r[1]?(o=[o[0]+c,o[1]+s],e.lineTo.apply(e,v(o))):"q"===r[1]?(e.quadraticCurveTo(o[0]+c,o[1]+s,o[0]+u,o[1]+l),o=[o[0]+u,o[1]+l]):"c"===r[1]?(o=[f,h],e.bezierCurveTo(o[0]+c,o[1]+s,o[0]+u,o[1]+l,o[0]+f,o[1]+h),o=[o[0]+f,o[1]+h]):"z"===r[1]?(o=a,e.lineTo.apply(e,v(a))):"v"===r[1]?(o=[o[0],o[1]+c],e.lineTo.apply(e,v(o))):"h"===r[1]&&(o=[o[0]+c,o[1]],e.lineTo.apply(e,v(o)))}}var W=function(){function e(){r(this,e),this.sets={}}return o(e,[{key:"clear",value:function(){this.sets={}}},{key:"add",value:function(e,t){this.sets[e]||(this.sets[e]=[]);var n,r=y(this.sets[e]);try{for(r.s();!(n=r.n()).done;){if(H(t,n.value))return!1}}catch(a){r.e(a)}finally{r.f()}return this.sets[e].push(t),!0}}],[{key:"getCollisionSystem",value:function(){return this.singleton||(this.singleton=new e),this.singleton}}]),e}();function H(e,t){var n=e[0],r=e[1],a=e[0]+e[2],o=e[1]+e[3],i=t[0],c=t[1],s=t[0]+t[2],u=t[1]+t[3];return n<s&&a>i&&r<u&&o>c}function U(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(0!==n.length){if(t.declarations["collision-set"]){var i=k(n);if(t.declarations["collision-size"]){var c=/(\d+\.?\d*)%/.exec(t.declarations["collision-size"]),s=+c[1]/100,u=i[2],l=i[3];i[0]+=(1-s)*u/2,i[1]+=(1-s)*l/2,i[2]=u*s,i[3]=l*s}var f=W.getCollisionSystem();if(!f.add(t.declarations["collision-set"],i)){var h=t.declarations["collision-policy"]||"hide";if("hide"===h)return}}e.save(),G(e,t,o.scale);var d=0,p=0;if(t.declarations.transform){var v=r(n);d=v[0],p=v[1],e.translate(d,p),K(e,t,o.scale)}e.beginPath(),e.moveTo(n[0][0]-d,n[0][1]-p);for(var y=1;y<n.length;y++)e.lineTo(n[y][0]-d,n[y][1]-p);t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke(),e.restore(),(t.declarations.content||t.declarations.size||t.declarations.path||t.declarations.icon)&&(e.save(),Q(e,t,r(n),a,o),e.restore())}}var Z=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(a,e);var t,n=(t=a,function(){var e,n=i(t);if(u()){var r=i(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return f(this,e)});function a(e){var t;return r(this,a),(t=n.call(this)).canvas=e,t}return o(a,[{key:"clear",value:function(e){var t=e.width,n=e.height;this.canvas.width=t,this.canvas.height=n}},{key:"renderRule",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.canvas.getContext("2d");r.save(),c(i(a.prototype),"renderRule",this).call(this,e,t,n),r.restore()}},{key:"globalSetup",value:function(e,t){var n=e.scale,r=this.canvas.getContext("2d");if(t.declarations.opacity&&(r.globalAlpha=+t.declarations.opacity),"relative"===t.declarations.position){var a=(parseFloat(t.declarations.top)||0)*n,o=(parseFloat(t.declarations.left)||0)*n;r.translate(o,a)}}},{key:"renderPoint",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this.canvas.getContext("2d");Q(a,t,n,r,e)}},{key:"renderAreaLine",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=this.canvas.getContext("2d");U(o,t,n,r,a,e)}},{key:"measureText",value:function(e,t,n){var r=this.canvas.getContext("2d");Y(r,t,e.scale);var a=r.measureText(n),o=a.width,i=a.actualBoundingBoxDescent,c=a.actualBoundingBoxAscent;return{width:o,ascending:c,descending:i,height:c+i}}}]),a}(D),X=n(0),$=n.n(X);function ee(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,a)}function te(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){ee(o,r,a,i,c,"next",e)}function c(e){ee(o,r,a,i,c,"throw",e)}i(void 0)}))}}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OverpassElements";r(this,e);var n=indexedDB.open(t);n.addEventListener("upgradeneeded",(function(e){var t=e.target.result;t.createObjectStore("nodes",{keyPath:"id"}),t.createObjectStore("elements").createIndex("selectorIndex",["selector","area","bbox"],{unique:!1})})),this.db=new Promise((function(e,t){n.addEventListener("success",(function(t){var n=t.target;e(n.result)})),n.addEventListener("error",t)}))}return o(e,[{key:"saveNodes",value:function(){var e=te($.a.mark((function e(t){var n,r,a,o,i;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:n=e.sent,r=n.transaction("nodes","readwrite").objectStore("nodes"),a=y(t);try{for(a.s();!(o=a.n()).done;)i=o.value,r.put(i)}catch(c){a.e(c)}finally{a.f()}case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNode",value:function(){var e=te($.a.mark((function e(t){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("nodes","readonly").objectStore("nodes").get(t);a.addEventListener("success",(function(t){return e(a.result)})),a.addEventListener("error",(function(e){return r(e)}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNodes",value:function(e){var t=this;return Promise.all(e.map((function(e){return t.getNode(e)})))}},{key:"getElements",value:function(e,t){var n=ie(e,t);return this.getElementsByKey(n)}},{key:"getElementsByKey",value:function(){var e=te($.a.mark((function e(t){var n;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("elements","readonly").objectStore("elements").get(t);a.addEventListener("success",(function(t){return e(a.result)})),a.addEventListener("error",r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchElements",value:function(){var e=te($.a.mark((function e(t,n){var r;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,a){var o=r.transaction("elements","readonly").objectStore("elements").index("selectorIndex"),i=IDBKeyRange.bound([n,0,"0"],[n,Number.MAX_VALUE,"999999999999999999"]),c=o.openKeyCursor(i),s=0,u=9*z(t);c.addEventListener("success",(function(r){var a=c.result;if(a){var o=a.key,i=a.primaryKey,l=o[2],f=o[1];if(s++,console.debug("Checking index #".concat(s," for ").concat(n)),R(l,t)&&f<u)return console.debug("".concat(n," found after checking ").concat(s," records")),void e(i.toString());a.continue()}else console.debug("".concat(n," not found after checking ").concat(s," records")),e(null)})),c.addEventListener("error",a)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveElements",value:function(){var e=te($.a.mark((function e(t,n,r){var a,o,i;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return a=e.sent,o=ie(t,n),i=z(t),e.abrupt("return",new Promise((function(e,c){var s=a.transaction("elements","readwrite").objectStore("elements").put(ae({selector:n,bbox:t,area:i},r),o);s.addEventListener("success",(function(){console.debug("Saved ".concat(n,"/").concat(t," to database with ").concat(r.elements.length," elements")),e()})),s.addEventListener("error",c)})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=te($.a.mark((function e(){var t;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return t=e.sent,e.abrupt("return",new Promise((function(e,n){var r=t.transaction("elements","readwrite").objectStore("elements").clear();r.onsuccess=e,r.onerror=n})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ie(e,t){var n=e.split(",").map((function(e){return(+e).toFixed(3)})).join(",");return"".concat(t,"/").concat(n)}var ce,se,ue=n(2).API_ROOT,le=/^(node|way|rel(?:ation)?|area)/,fe=/^(way|rel(?:ation)?|area)/;function he(e){var t=fe.test(e.type)?">;":"";return"".concat(de(e),";").concat(t)}function de(e){var t="area"===e.type?"way":e.type,n=Object.entries(e.tags).map((function(e){var t=p(e,2),n=t[0],r=t[1];return/^[<=>]+/.test(r)||"*"===r?"[".concat(n,"]"):"[".concat(n,"=").concat(r,"]")}));return"".concat(t).concat(n.join(""))}function pe(e,t,n){return Math.max(t,Math.min(e,n))}var ve=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;r(this,e),this.elements=new Map,this.bbox=t,this.database=new oe,this.fetchMap={},this.currentJob=Promise.resolve()}return o(e,[{key:"setBBox",value:function(e){this.bbox&&!R(this.bbox,e)&&this.elements.clear(),this.bbox=e}},{key:"preLoadElements",value:function(){var e=te($.a.mark((function e(t){var n=this;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.jobs(te($.a.mark((function e(){var r,a,o,i,c,s,u,l,f,h,d,g,m;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.bbox,n.bbox){e.next=3;break}throw Error("No bounding box specified");case 3:for(a={},t.forEach((function(e){return a[de(e)]=e})),console.debug("Preloading Elements: ".concat(t.length," requested (").concat(Object.keys(a).length," unique)")),o=0,i=Object.entries(a);o<i.length;o++)c=p(i[o],2),s=c[0],u=c[1],le.test(u.type)||delete a[s];for(console.debug("Preloading Elements: ".concat(Object.keys(a).length," are Overpass Elements")),l=0,f=Object.keys(a);l<f.length;l++)h=f[l],n.elements.has(h)&&delete a[h];return console.debug("Preloading Elements: ".concat(Object.keys(a).length," not in HashMap")),e.next=12,Promise.all(Object.keys(a).map((function(e){return n.database.searchElements(r,e).then((function(t){t&&delete a[e]}))})));case 12:if(console.debug("Preloading Elements: ".concat(Object.keys(a).length," not in Database")),0!==Object.keys(a).length){e.next=15;break}return e.abrupt("return",0);case 15:return e.next=17,n.tryQuery(Object.values(a));case 17:return d=e.sent,console.log("Preloading Elements: Fetched ".concat(d.length," elements from Server")),g={},d.forEach((function(e){return"node"===e.type&&(g[e.id]=e)})),m={},d.forEach((function(e){return"way"===e.type&&(m[e.id]=e)})),e.next=25,Promise.all(Object.values(a).map((function(e){var t=d.filter((function(t){return T(e,t,!1)}));if("relation"===e.type){var a,o=[],i=y(t.slice());try{for(i.s();!(a=i.n()).done;){var c=a.value.members.map((function(e){return e.ref}));o.push.apply(o,v(c.map((function(e){return m[e]}))))}}catch(b){i.e(b)}finally{i.f()}t.push.apply(t,o);for(var s=0,u=o;s<u.length;s++){var l=u[s];t.push.apply(t,v(l.nodes.map((function(e){return g[e]}))))}}else if("way"===e.type||"area"===e.type){var f,h=y(t.slice());try{for(h.s();!(f=h.n()).done;){var p=f.value;t.push.apply(t,v(p.nodes.map((function(e){return g[e]}))))}}catch(b){h.e(b)}finally{h.f()}}return n.elements.set(de(e),Promise.resolve(t)),n.database.saveElements(r,de(e),{elements:t,cached:Date.now()})})));case 25:return e.abrupt("return",d.length);case 26:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"query",value:function(e){var t=this;if(this.bbox.split(",").map((function(e){return+e})).some(isNaN))throw Error("Invalid BBox");var n=e.map(he),r="[out:json][bbox];\n(".concat(n.join(""),"\n);\nout;"),a="".concat(ue,"?data=").concat(r.replace(/\s/,""),"&bbox=").concat(function(e){var t=e.split(",").map((function(e){return+e}));return"".concat(pe(t[0],-180,180),",").concat(pe(t[1],-90,90),",").concat(pe(t[2],-180,180),",").concat(pe(t[3],-90,90))}(this.bbox));return this.fetchMap[a]||(this.fetchMap[a]=fetch(a.toString()).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return e.elements})),this.fetchMap[a].finally((function(){return delete t.fetchMap[a]}))),this.fetchMap[a]}},{key:"tryQuery",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.query(e).catch((function(r){if(429!==r)throw Error("Bad Response");if(n>0)return g(1e4).then((function(){return t.tryQuery(e,n-1)}));throw Error("Too many retries fetching data")}))}},{key:"getElements",value:function(){var e=te($.a.mark((function e(t){var n,r,a,o,i,c,s=this;return $.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le.test(t.type)){e.next=2;break}return e.abrupt("return");case 2:if(this.bbox){e.next=4;break}return e.abrupt("return");case 4:if(n=de(t),!this.elements.has(n)){e.next=7;break}return e.abrupt("return",this.elements.get(n));case 7:return e.next=9,this.database.getElements(this.bbox,n);case 9:if(!(r=e.sent)){e.next=14;break}return a=r.elements,this.elements.set(n,Promise.resolve(a)),e.abrupt("return",a);case 14:return e.next=16,this.database.searchElements(this.bbox,n);case 16:if(!(o=e.sent)){e.next=21;break}return i=this.database.getElementsByKey(o).then((function(e){return e.elements})),this.elements.set(n,i),e.abrupt("return",i);case 21:return c=this.tryQuery([t]),this.elements.set(n,c),c.catch((function(){return s.elements.delete(n)})),c.then((function(e){s.database.saveElements(s.bbox,n,{elements:e,cached:Date.now()})})),e.abrupt("return",c);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"jobs",value:function(e){return this.currentJob=this.currentJob.then((function(){return e()})),this.currentJob}},{key:"clearCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.elements.clear(),e)return this.database.clear()}}]),e}()),ye=Promise.resolve();onmessage=function(e){if(e.data.canvas&&(ce=e.data.canvas,se=new Z(ce)),"clear"===e.data.method){var t=e.data.context,n=t.width,r=t.height,a=t.bbox;ce.width=n,ce.height=r,ve.setBBox(a),ye=Promise.resolve()}if("renderRule"===e.data.method){var o=e.data,i=o.context,c=o.rule;ve.setBBox(i.bbox);var s=ve.getElements(c.selector);ye=ye.then((function(){return s.then((function(e){return se.renderRule(i,c,e)}))}))}}}]);
//# sourceMappingURL=render-worker.30a7101a.worker.js.map