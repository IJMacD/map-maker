/*! For license information please see render-worker.9b56c034.worker.js.LICENSE.txt */
!function(){"use strict";var e={227:function(e,t,n){n.d(t,{O:function(){return r}});var r="https://overpass-api.de/api/interpreter"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function o(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=o(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},i.apply(this,arguments)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e,t){if(t&&("object"===s(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=a(e);if(t){var o=a(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return u(this,n)}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){if(e){if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(s){c=!0,a=s}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw o}}}}function y(e){return new Promise((function(t){return setTimeout(t,e)}))}function g(e,t,n,r){var a=d(e,2),o=a[0],i=a[1],c=Math.pow(2,t),s=256/(180/c),u=256/(180/c),l=Math.PI/4,f=n/2,h=r/2,p=180*Math.log(Math.tan(l+i/180*Math.PI/2))/Math.PI;return function(e,t){var n=e,r=180*Math.log(Math.tan(l+t/180*Math.PI/2))/Math.PI;return[f+(n-o)*s,h-(r-p)*u]}}function m(e){return e.reduce((function(e,t){return[e[0]+t[0],e[1]+t[1]]}),[0,0]).map((function(t){return t/e.length}))}function b(e){var t=x(e);return[t[0]+t[2]/2,t[1]+t[3]/2]}function w(e){return e[Math.floor((e.length-1)/2)]}function x(e){var t=e.reduce((function(e,t){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[2],t[0]),Math.max(e[3],t[1])]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]);return[t[0],t[1],t[2]-t[0],t[3]-t[1]]}function k(e,t,n,r){return[[e,t],[e,t+r],[e+n,t+r],[e+n,t]]}function E(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n][0]*e[n+1][1]-e[n+1][0]*e[n][1];return t/2}function P(e){return Math.abs(E(e))}function j(e){return E(e)>0}function O(e){var t=e.length;if(!(t<3)){for(var n=0,r=1;r<t;r++){var a=e[r-1],o=e[r],i=e[(r+1)%t],c=Math.sign((o[0]-a[0])*(i[1]-o[1])-(o[1]-a[1])*(i[0]-o[0]));if(0===n)n=c;else if(0!==c&&n!==c)return!1}return!0}}function M(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]}function S(e){for(var t=0,n=1;n<e.length;n++){var r=e[n][0]-e[n-1][0],a=e[n][1]-e[n-1][1];t+=Math.sqrt(r*r+a*a)}return t}var L=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;e(this,t),this.type=n,this.tags=r,this.pseudoClasses=a,this.pseudoElement=o}return r(t,[{key:"toString",value:function(){return"".concat(this.type).concat(Object.entries(this.tags).map((function(e){var t=d(e,2),n=t[0],r=t[1],a=/^[<=>]/.test(r)?"":"=";return"[".concat(n).concat(a).concat(r,"]")})).join(""))}}]),t}();function I(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.type!==e.type&&("area"!==e.type||"way"!==t.type))return!1;var r=Object.entries(e.tags);if(r.length&&"undefined"===typeof t.tags)return!1;for(var a=0,o=r;a<o.length;a++){var i=d(o[a],2),c=i[0],s=i[1];if("undefined"===typeof t.tags[c])return!1;var u=/^[<=>]+/.exec(s);if(u){if(n){var l=u[0],f=F[l];if(!f)continue;var h=s.substr(u[0].length),p=isNaN(+h)?f(t.tags[c].localeCompare(h),0):f(+t.tags[c],+h);if(!p)return!1}}else if("*"!==s&&t.tags[c]!==s)return!1}return!0}function T(e){return e[4]?{left:{left:e[1],operator:e[2],right:e[3]},operator:"and",right:{left:e[3],operator:e[4],right:e[5]}}:{left:e[1],operator:e[2],right:e[3]}}function N(e,t){var n="string"===typeof e.left||"number"===typeof e.left?e.left:N(e.left,t),r="string"===typeof e.right||"number"===typeof e.right?e.right:N(e.right,t);t&&"string"===typeof n&&n in t&&(t[n]instanceof Function&&(t[n]=t[n]()),n=t[n]),t&&"string"===typeof r&&r in t&&(t[r]instanceof Function&&(t[r]=t[r]()),r=t[r]);var a=F[e.operator];return!!a&&a(n,r)}L.parse=function(e){var t=/^\s*([a-z]+)/.exec(e);if(!t)return null;var n=t[1];"rel"===n&&(n="relation");for(var r={},a=e.substring(t[0].length).trim(),o=/^\["?([a-z0-9:_-]+)"?(?:(=|<=|>=|<|>)([^[\]]+))?\]/i;;){var i=o.exec(a);if(!i)break;var c="="===i[2]?"":i[2];r[i[1]]=i[3]?c+i[3]:"*",a=a.substring(i[0].length)}for(var s,u=[],l=/^:([a-z-]+)(?:\(([^)]+)\))?/,f=function(){var e=l.exec(a);if(!e)return"break";var t=/^\s*([^\s)]+)\s*(:|=|<=|>=|<|>|and|or)\s*([^\s)]+)(?:\s*(=|<=|>=|<|>)\s*([^\s)]+))?/,n=e[2]?e[2].split(",").map((function(e){return t.test(e)?T(t.exec(e)):e})):[];u.push({name:e[1],params:n}),a=a.substring(e[0].length)};;){if("break"===f())break}var h=/^::([a-z-]+)?/.exec(a);return h&&(s=h[1],a=a.substring(h[0].length)),a.length?(console.log("Invalid selector: ".concat(e," unexpected part: '").concat(a,"'")),null):new L(n,r,u,s)},L.parseMultiple=function(e){return e.split(",").map(L.parse).filter((function(e){return e}))},L.clone=function(e){return new L(e.type,e.tags,e.pseudoClasses,e.pseudoElement)};var F={":":function(e,t){return e==t},"=":function(e,t){return e==t},">":function(e,t){return e>t},"<":function(e,t){return e<t},">=":function(e,t){return e>=t},"<=":function(e,t){return e<=t},and:function(e,t){return e&&t},or:function(e,t){return e||t}};function A(e,t,n,r){var a=e.selector;if(_(a,"is","convex")&&!O(t))return!1;if(_(a,"is","concave")&&O(t))return!1;if(_(a,"is","clockwise")&&j(t))return!1;if(_(a,"is","anti-clockwise")&&!j(t))return!1;if(_(a,"is","self-closing")&&r&&r[0]!==r[t.length-1])return!1;var o,i=v(a.pseudoClasses.filter((function(e){return"has"===e.name})));try{for(i.s();!(o=i.n()).done;){var c=o.value;if("string"===typeof c.params[0])return!1;if(!N(c.params[0],{area:function(){return P(t)},length:function(){return S(t)},width:function(){return x(t)[2]},height:function(){return x(t)[3]}}))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}function _(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return e.pseudoClasses.some((function(e){return e.name===t&&e.params[0]===r[0]}))}function C(e,t,n){if(!e)return"";for(var r=0,a=[];r<e.length;){var o=e.substring(r),i=/^\s+/.exec(o);if(i)r+=i[0].length;else if(i=/^"(.*?[^\\])"/.exec(o))a.push(i[1].replace(/\\"/g,'"').replace(/\\n/g,"\n")),r+=i[0].length;else{if(!t)return o;if(i=/^tag\(([^),]+)(?:,\s*([^),]+))?\s*\)/.exec(o)){var c;a.push(t.tags[i[1]]||(null===(c=i[2])||void 0===c?void 0:c.replace(/^"|"$/g,""))||""),r+=i[0].length}else{if(!(i=/^debug\(([^)]+)\)/.exec(o)))return o;"type"===i[1]?a.push(t.type):"tags"===i[1]?a.push(Object.entries(t.tags).map((function(e){var t=d(e,2),n=t[0],r=t[1];return"[".concat(n,"=").concat(r,"]")})).join("\n")):"location"===i[1]&&"node"===t.type?a.push("(".concat(t.lon,",").concat(t.lat,")")):"node_count"!==i[1]||"way"!==t.type&&"area"!==t.type?"scale"===i[1]&&a.push(n.scale.toString()):a.push(t.nodes.length.toString()),r+=i[0].length}}}return a.join("")}function B(e,t,n){var r=e.declarations.content;return r?C(r,t,n):""}function z(e,t){var n=d(e.split(","),4),r=n[0],a=n[1],o=n[2],i=n[3],c=d(t.split(","),4),s=c[0],u=c[1],l=c[2],f=c[3];return s>=r&&u>=a&&l<=o&&f<=i}function D(e){var t=e.split(",");return(+t[2]-+t[0])*(+t[3]-+t[1])}var R=function(){function t(){e(this,t)}return r(t,[{key:"renderRule",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={};n.forEach((function(e){return"node"===e.type&&(r[e.id]=e)}));var a={};n.forEach((function(e){return"way"===e.type&&(a[e.id]=e)}));var o=e.centre,i=e.zoom,c=e.width,s=e.height,u=g(o,i,c,s);this.globalSetup(e,t);var l=t.selector.type;switch(l){case"map":var f=k(0,0,c,s);t.selector.pseudoElement?this.renderPseudoElement(e,t,f,null):this.renderArea(e,t,f,null);break;case"centre":var h={id:-1,type:"node",lon:e.centre[0],lat:e.centre[1],tags:{}};this.renderPoint(e,t,u(h.lon,h.lat),h);break;case"current":if(e.current){var d=e.current;this.renderPoint(e,t,u(d.longitude,d.latitude))}break;case"gridlines":this.renderGridlines(e,t,u);break;case"dummy":this.renderPoint(e,t,[0,0]);break;default:var p,y=v(n);try{for(y.s();!(p=y.n()).done;){var m=p.value;if(I(t.selector,m))switch(l){case"node":if("node"!==m.type)continue;var b=u(m.lon,m.lat);t.selector.pseudoElement?this.renderPseudoElement(e,t,[b],m,[m]):this.renderPoint(e,t,b,m);break;case"way":case"area":if("way"!==m.type)continue;var w=m.nodes.map((function(e){return r[e]})),x=w.map((function(e){return u(e.lon,e.lat)}));if(!A(t,x,0,w))continue;t.selector.pseudoElement?this.renderPseudoElement(e,t,x,m,w):"area"===l?this.renderArea(e,t,x,m):this.renderLine(e,t,x,m);break;case"relation":if("relation"!==m.type)continue}}}catch(E){y.e(E)}finally{y.f()}}}},{key:"renderPoint",value:function(e,t,n){}},{key:"renderLine",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.renderAreaLine(e,t,n,w,r)}},{key:"renderArea",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;0!==n.length&&(M(n)||(n=[].concat(p(n),[n[0]])),this.renderAreaLine(e,t,n,b,r))}},{key:"renderAreaLine",value:function(e,t,n,r){}},{key:"renderPseudoElement",value:function(e,t,n,r){switch(t.selector.pseudoElement){case"centre":case"center":var a=b(n);this.renderPoint(e,t,a,r);break;case"mid-point":var o=w(n);this.renderPoint(e,t,o,r);break;case"average-point":var i=m(n);this.renderPoint(e,t,i,r);break;case"start":this.renderPoint(e,t,n[0],r);break;case"end":this.renderPoint(e,t,n[n.length-1],r);break;case"centre-of-mass":break;case"bounding-box":var c=x(n),s=k.apply(void 0,p(c));this.renderArea(e,t,s,r);break;case"content-box":var u=e.scale,l=n[0];if("way"===t.selector.type?l=w(n):"area"===t.selector.type&&(l=b(n)),!r)return;var f=B(t,r,e);if(!f)return;var h,y=l,g=d(y,2),E=g[0],P=g[1],j=Number.NEGATIVE_INFINITY,O=Number.NaN,M=0,S=P,L=v(f.split("\n"));try{for(L.s();!(h=L.n()).done;){var I=h.value,T=this.measureText(e,t,I);j=Math.max(j,T.width),isNaN(O)&&(O=P-T.ascending),M=S+T.descending,S+=T.height}}catch(C){L.e(C)}finally{L.f()}var N=t.declarations.padding?parseFloat(t.declarations.padding)*u:0;"center"===t.declarations["text-align"]||"centre"===t.declarations["text-align"]?E-=j/2:"right"===t.declarations["text-align"]&&(E-=j);var F=[[E-N,O-N],[E-N,M+N],[E+j+N,M+N],[E+j+N,O-N]];F.push(F[0]),this.renderAreaLine(e,t,F,(function(){return l}),r);break;case"decimate":if("way"===t.selector.type){var A=n.length-1,_=n.filter((function(e,t){return t%10===0||t===A}));this.renderLine(e,t,_,r)}}}},{key:"renderGridlines",value:function(e,t,n){var r=t.selector.pseudoClasses.find((function(e){return"vertical"===e.name})),a=t.selector.pseudoClasses.find((function(e){return"horizontal"===e.name})),o=e.width,i=e.height,c=function(e,t,n){var r=d(e,2),a=r[0],o=r[1],i=d(n,2),c=i[0],s=i[1],u=Math.pow(2,t),l=180/u*(c/256),f=180/u*(s/256);return[a-l,o-f,a+l,o+f].map((function(e){return e.toFixed(3)})).join(",")}(e.centre,e.zoom,[o,i]),s=c.split(",");if(r)for(var u=parseFloat(r.params[0]),l=1/u,f=Math.ceil(Math.log10(l)),h=Math.floor(+s[0]*l)/l,p=Math.ceil(+s[2]*l)/l,v=Math.floor(+s[1]*l)/l,y=Math.ceil(+s[3]*l)/l,g=h;g<=p;g+=u){var m=[n(g,v),n(g,(v+y)/2),n(g,y)];this.renderLine(e,t,m,{type:"way",id:0,nodes:[],tags:{name:g.toFixed(f)}})}if(a)for(var b=parseFloat(a.params[0]),w=1/b,x=Math.ceil(Math.log10(w)),k=Math.floor(+s[0]*w)/w,E=Math.ceil(+s[2]*w)/w,P=Math.floor(+s[1]*w)/w,j=Math.ceil(+s[3]*w)/w,O=P;O<=j;O+=b){var M=[n(k,O),n((k+E)/2,O),n(E,O)];this.renderLine(e,t,M,{type:"way",id:0,nodes:[],tags:{name:O.toFixed(x)}})}}},{key:"clear",value:function(e){}},{key:"globalSetup",value:function(e,t){}},{key:"measureText",value:function(e,t,n){return{width:0,ascending:0,descending:0,height:0}}}]),t}();function G(e,t,n,r){var a=function(e,t,n){var r=C(e.declarations.fill,t,n),a=C(e.declarations.stroke,t,n),o=n.scale;if(a){var i=a.replace(/\([^)]*\)/g,(function(e){return" ".repeat(e.length)}));i=(i=i.replace(/#[0-9a-f]{3}/i,"    ")).replace(/#[0-9a-f]{6}/i,"       ");var c=/(\d+(?:\.\d+)?)\s*(?:px)?/.exec(i);c&&(c[1],a=a.replace(c[0],""))}return{fillStyle:r,strokeStyle:a,lineWidth:e.declarations["stroke-width"]?+e.declarations["stroke-width"]*o:o,lineDash:e.declarations["stroke-dash"]?e.declarations["stroke-dash"].split(" ").map((function(e){return+e*o})):[]}}(t,n,r),o=a.fillStyle,i=a.strokeStyle,c=a.lineWidth,s=a.lineDash;e.fillStyle=o,e.strokeStyle=i,e.lineWidth=c,s&&e.setLineDash(s)}function q(e,t,n,r,a,o){var i=e.measureText(n);if(t.declarations["text-align"]){var c=i.width;"center"===t.declarations["text-align"]||"centre"===t.declarations["text-align"]?r-=c/2:"right"===t.declarations["text-align"]&&(r-=c)}return t.declarations["stroke-width"]&&(e.lineWidth=parseFloat(t.declarations["stroke-width"])*o.scale),t.declarations["text-stroke"]&&(e.strokeStyle=t.declarations["text-stroke"],e.strokeText(n,r,a)),!t.declarations["text-color"]&&t.declarations["text-stroke"]||(e.fillStyle=t.declarations["text-color"],e.fillText(n,r,a)),i.actualBoundingBoxAscent+i.actualBoundingBoxDescent}function V(e,t,n){var r="".concat(10*n,"px"),a="normal",o="sans-serif";t.declarations.font?e.font=t.declarations.font.replace(/\d+(?:\.\d+)?/,(function(e){return"".concat(+e*n)})):(t.declarations["font-size"]&&(r=t.declarations["font-size"].replace(/^\d[\d.]*/,(function(e){return"".concat(+e*n)}))),t.declarations["font-weight"]&&(a=t.declarations["font-weight"]),t.declarations["font-family"]&&(o=t.declarations["font-family"]),e.font="".concat(a," ").concat(r," ").concat(o))}function Y(e,t,n){if(t.declarations.transform)for(var r,a=/\s*([a-z]+)\(([^)]*)\)\s*/g,o=t.declarations.transform;r=a.exec(o);){var i=r[1],c=r[2].split(",").map((function(e){return{value:parseFloat(e),unit:e.replace(/[-\d.\s]/g,"")}}));switch(i){case"matrix":e.transform.apply(e,p(c.map((function(e){return e.value}))));break;case"rotate":var s=c[0],u=s.value,l=s.unit;"deg"===l?u*=Math.PI/180:"turn"===l&&(u*=2*Math.PI),e.rotate(u);break;case"scale":var f=c[0].value,h=c[1]?c[1].value:f;e.scale(f,h);break;case"translate":e.translate.apply(e,p(c.map((function(e){return e.value*n}))));break;case"skew":var d=c[0],v=d.value,y=d.unit;"rad"===y?v=Math.tan(v):"deg"===y?v=Math.tan(v*Math.PI/180):v*=n;var g=0;if(c[1]){var m=c[1],b=m.value,w=m.unit;"rad"===w?b=Math.tan(b):"deg"===w&&(b=Math.tan(b*Math.PI/180)),g=b}e.transform(1,g,v,1,0,0)}}}function K(e,t,n,r,a){var o=d(n,2),i=o[0],c=o[1];e.save();var s=a.scale;if(G(e,t,r,a),"absolute"===t.declarations.position&&(i=parseFloat(t.declarations.left)||0,c=parseFloat(t.declarations.top)||0),e.translate(i*s,c*s),Y(e,t,s),t.declarations.size){var u,l=null!==(u=t.declarations.shape)&&void 0!==u?u:"circle";e.beginPath();var f=+C(t.declarations.size,r,a)*s;if("square"===l)e.moveTo(-f,-f),e.lineTo(f,-f),e.lineTo(f,f),e.lineTo(-f,f),e.closePath();else if("triangle"===l){var h=Math.cos(30/180*Math.PI);e.moveTo(-f,f*h*.5),e.lineTo(0,-f/h),e.lineTo(f,f*h*.5),e.closePath()}else"ellipse"===l?e.ellipse(0,0,2*f,f,0,0,2*Math.PI):e.ellipse(0,0,f,f,0,0,2*Math.PI);t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke()}t.declarations.path&&(e.beginPath(),function(e,t,n){var r,a,o,i=/([MLQCVHZ])\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?\s*(-?\d+(?:\.\d+)?)?/gi;for(;r=i.exec(t);){var c=parseFloat(r[2])*n,s=parseFloat(r[3])*n,u=parseFloat(r[4])*n,l=parseFloat(r[5])*n,f=parseFloat(r[6])*n,h=parseFloat(r[7])*n;a||(a=[c,s]),"M"===r[1]?(o=[c,s],e.moveTo(c,s)):"L"===r[1]?(o=[c,s],e.lineTo(c,s)):"Q"===r[1]?(o=[u,l],e.quadraticCurveTo(c,s,u,l)):"C"===r[1]?(o=[f,h],e.bezierCurveTo(c,s,u,l,f,h)):"Z"===r[1]?(o=a,e.lineTo.apply(e,p(o))):"V"===r[1]?(o=[o[0],c],e.lineTo.apply(e,p(o))):"H"===r[1]?(o=[c,o[1]],e.lineTo.apply(e,p(o))):"m"===r[1]?(o=[o[0]+c,o[1]+s],e.moveTo.apply(e,p(o))):"l"===r[1]?(o=[o[0]+c,o[1]+s],e.lineTo.apply(e,p(o))):"q"===r[1]?(e.quadraticCurveTo(o[0]+c,o[1]+s,o[0]+u,o[1]+l),o=[o[0]+u,o[1]+l]):"c"===r[1]?(o=[f,h],e.bezierCurveTo(o[0]+c,o[1]+s,o[0]+u,o[1]+l,o[0]+f,o[1]+h),o=[o[0]+f,o[1]+h]):"z"===r[1]?(o=a,e.lineTo.apply(e,p(a))):"v"===r[1]?(o=[o[0],o[1]+c],e.lineTo.apply(e,p(o))):"h"===r[1]&&(o=[o[0]+c,o[1]],e.lineTo.apply(e,p(o)))}}(e,t.declarations.path,s),t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke());var y=/url\(([^)]+)\)(?:\s+([^\s]+)(?:\s+([^\s]+))?)?/;if(y.test(t.declarations.icon)){var g=y.exec(t.declarations.icon),m=g[1],b=new Image;b.src=m;var w=parseFloat(g[2]),x=parseFloat(g[3]);b.addEventListener("load",(function(){if(e.save(),e.translate(i,c),w){var t=isNaN(x)?b.height*(w/b.width):x;e.drawImage(b,0,0,w*s,t*s)}else e.drawImage(b,0,0);e.restore()}))}t.declarations.content&&function(e,t,n){var r=d(n,2),a=r[0],o=r[1],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;G(e,t,i,c);var s=B(t,i,c);V(e,t,c.scale);var u,l=v(s.split("\n"));try{for(l.s();!(u=l.n()).done;){o+=q(e,t,u.value,a,o,c)}}catch(f){l.e(f)}finally{l.f()}}(e,t,[0,0],r,a),e.restore()}var Q=function(){function t(){e(this,t),this.sets={}}return r(t,[{key:"clear",value:function(){this.sets={}}},{key:"add",value:function(e,t){this.sets[e]||(this.sets[e]=[]);var n,r=v(this.sets[e]);try{for(r.s();!(n=r.n()).done;){if(J(t,n.value))return!1}}catch(a){r.e(a)}finally{r.f()}return this.sets[e].push(t),!0}}],[{key:"getCollisionSystem",value:function(){return this.singleton||(this.singleton=new t),this.singleton}}]),t}();function J(e,t){var n=e[0],r=e[1],a=e[0]+e[2],o=e[1]+e[3],i=t[0],c=t[1],s=t[0]+t[2],u=t[1]+t[3];return n<s&&a>i&&r<u&&o>c}function W(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5?arguments[5]:void 0;if(0!==n.length){if(t.declarations["collision-set"]){var i=x(n);if(t.declarations["collision-size"]){var c=/(\d+\.?\d*)%/.exec(t.declarations["collision-size"]),s=+c[1]/100,u=i[2],l=i[3];i[0]+=(1-s)*u/2,i[1]+=(1-s)*l/2,i[2]=u*s,i[3]=l*s}var f=Q.getCollisionSystem();if(!f.add(t.declarations["collision-set"],i)){var h=t.declarations["collision-policy"]||"hide";if("hide"===h)return}}e.save(),G(e,t,a,o);var d=0,p=0,v=o.scale;if(t.declarations.transform){var y=r(n);d=y[0],p=y[1],e.translate(d,p),Y(e,t,v)}e.beginPath();for(var g=0;g<n.length;g++){var m=n[g][0]-d,b=n[g][1]-p;e.lineTo(m*v,b*v)}t.declarations.fill&&e.fill(),t.declarations.stroke&&e.stroke(),e.restore(),(t.declarations.content||t.declarations.size||t.declarations.path||t.declarations.icon)&&(e.save(),K(e,t,r(n),a,o),e.restore())}}var H=function(t){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(o,t);var n=l(o);function o(t){var r;return e(this,o),(r=n.call(this)).canvas=t,r}return r(o,[{key:"clear",value:function(e){var t=e.width,n=e.height,r=e.scale;this.canvas.width=t*r,this.canvas.height=n*r,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(n,"px")}},{key:"renderRule",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=this.canvas.getContext("2d");r&&(r.save(),i(a(o.prototype),"renderRule",this).call(this,e,t,n),r.restore())}},{key:"globalSetup",value:function(e,t){var n=e.scale,r=this.canvas.getContext("2d");if(r&&(t.declarations.opacity&&(r.globalAlpha=+t.declarations.opacity),"relative"===t.declarations.position)){var a=(parseFloat(t.declarations.top)||0)*n,o=(parseFloat(t.declarations.left)||0)*n;r.translate(o,a)}}},{key:"renderPoint",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this.canvas.getContext("2d");a&&K(a,t,n,r,e)}},{key:"renderAreaLine",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=this.canvas.getContext("2d");o&&W(o,t,n,r,a,e)}},{key:"measureText",value:function(e,t,n){var r=this.canvas.getContext("2d");if(!r)throw Error("Can't get canvas context");V(r,t,e.scale);var a=r.measureText(n),o=a.width,i=a.actualBoundingBoxDescent,c=a.actualBoundingBoxAscent;return{width:o,ascending:c,descending:i,height:c+i}}}]),o}(R);function U(){U=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(M){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),i=new P(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return O()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var c=x(i,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=l(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,i),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}e.wrap=u;var f={};function h(){}function d(){}function p(){}var v={};c(v,a,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(j([])));g&&g!==t&&n.call(g,a)&&(v=g);var m=p.prototype=h.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function r(a,o,i,c){var u=l(e[a],e,o);if("throw"!==u.type){var f=u.arg,h=f.value;return h&&"object"==s(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(h).then((function(e){f.value=e,i(f)}),(function(e){return r("throw",e,i,c)}))}c(u.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function j(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},b(w.prototype),c(w.prototype,o,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,a,o){void 0===o&&(o=Promise);var i=new w(u(t,n,r,a),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(m),c(m,i,"Generator"),c(m,a,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;E(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function Z(e,t,n,r,a,o,i){try{var c=e[o](i),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,a)}function $(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Z(o,r,a,i,c,"next",e)}function c(e){Z(o,r,a,i,c,"throw",e)}i(void 0)}))}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){X(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OverpassElements";e(this,t);var r=indexedDB.open(n);r.addEventListener("upgradeneeded",(function(e){var t=e.target.result;t.createObjectStore("nodes",{keyPath:"id"}),t.createObjectStore("elements").createIndex("selectorIndex",["selector","area","bbox"],{unique:!1})})),this.db=new Promise((function(e,t){r.addEventListener("success",(function(t){var n=t.target;e(n.result)})),r.addEventListener("error",t)}))}return r(t,[{key:"saveNodes",value:function(){var e=$(U().mark((function e(t){var n,r,a,o,i;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:n=e.sent,r=n.transaction("nodes","readwrite").objectStore("nodes"),a=v(t);try{for(a.s();!(o=a.n()).done;)i=o.value,r.put(i)}catch(c){a.e(c)}finally{a.f()}case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNode",value:function(){var e=$(U().mark((function e(t){var n;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("nodes","readonly").objectStore("nodes").get(t);a.addEventListener("success",(function(t){return e(a.result)})),a.addEventListener("error",(function(e){return r(e)}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNodes",value:function(e){var t=this;return Promise.all(e.map((function(e){return t.getNode(e)})))}},{key:"getElements",value:function(e,t){var n=re(e,t);return this.getElementsByKey(n)}},{key:"getElementsByKey",value:function(){var e=$(U().mark((function e(t){var n;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.abrupt("return",new Promise((function(e,r){var a=n.transaction("elements","readonly").objectStore("elements").get(t);a.addEventListener("success",(function(){return e(a.result)})),a.addEventListener("error",r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchElements",value:function(){var e=$(U().mark((function e(t,n){var r;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return r=e.sent,e.abrupt("return",new Promise((function(e,a){var o=r.transaction("elements","readonly").objectStore("elements").index("selectorIndex"),i=IDBKeyRange.bound([n,0,"0"],[n,Number.MAX_VALUE,"999999999999999999"]),c=o.openKeyCursor(i),s=0,u=9*D(t);c.addEventListener("success",(function(){var r=c.result;if(r){var a=r.key,o=r.primaryKey,i=a[2],l=a[1];if(s++,console.debug("Checking index #".concat(s," for ").concat(n)),z(i,t)&&l<u)return console.debug("".concat(n," found after checking ").concat(s," records")),void e(o.toString());r.continue()}else console.debug("".concat(n," not found after checking ").concat(s," records")),e(null)})),c.addEventListener("error",a)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveElements",value:function(){var e=$(U().mark((function e(t,n,r){var a,o,i;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return a=e.sent,o=re(t,n),i=D(t),e.abrupt("return",new Promise((function(e,c){var s=a.transaction("elements","readwrite").objectStore("elements").put(te({selector:n,bbox:t,area:i},r),o);s.addEventListener("success",(function(){console.debug("Saved ".concat(n,"/").concat(t," to database with ").concat(r.elements.length," elements")),e()})),s.addEventListener("error",c)})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=$(U().mark((function e(){var t;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return t=e.sent,e.abrupt("return",new Promise((function(e,n){var r=t.transaction("elements","readwrite").objectStore("elements").clear();r.onsuccess=e,r.onerror=n})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}();function re(e,t){var n=e.split(",").map((function(e){return(+e).toFixed(3)})).join(",");return"".concat(t,"/").concat(n)}function ae(e){var t=/^(way|rel(?:ation)?|area)/.test(e.type)?">;":"";return"".concat(oe(e),";").concat(t)}function oe(e){var t="area"===e.type?"way":e.type,n=Object.entries(e.tags).map((function(e){var t=d(e,2),n=t[0],r=t[1];return n.includes(":")&&(n='"'.concat(n,'"')),/^[<=>]+/.test(r)||"*"===r?"[".concat(n,"]"):"[".concat(n,"=").concat(r,"]")}));return"".concat(t).concat(n.join(""))}function ie(e,t,n){return Math.max(t,Math.min(e,n))}function ce(e,t,n,r){if(!e)return[];var a=t.filter((function(t){return I(e,t,!1)}));if("relation"===e.type){var o,i=[],c=v(a.slice());try{for(c.s();!(o=c.n()).done;){var s=o.value.members.map((function(e){return e.ref}));i.push.apply(i,p(s.map((function(e){return r[e]}))))}}catch(g){c.e(g)}finally{c.f()}a.push.apply(a,i);for(var u=0,l=i;u<l.length;u++){var f=l[u];a.push.apply(a,p(f.nodes.map((function(e){return n[e]}))))}}else if("way"===e.type||"area"===e.type){var h,d=v(a.slice());try{for(d.s();!(h=d.n()).done;){var y=h.value;a.push.apply(a,p(y.nodes.map((function(e){return n[e]}))))}}catch(g){d.e(g)}finally{d.f()}}return a}var se,ue,le=n(227).O,fe=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e(this,t),this.elements=new Map,this.bbox=n,this.database=new ne,this.fetchMap={},this.currentJob=Promise.resolve()}return r(t,[{key:"setBBox",value:function(e){this.bbox&&!z(this.bbox,e)&&this.elements.clear(),this.bbox=e}},{key:"preLoadElements",value:function(){var e=$(U().mark((function e(t){var n=this;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.jobs($(U().mark((function e(){var r,a,o,i,c,s,u,l;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.bbox,n.bbox){e.next=3;break}throw Error("No bounding box specified");case 3:for(a=n.getSelectors(t),console.debug("Preloading Elements: ".concat(Object.keys(a).length," are Overpass Elements")),o=0,i=Object.keys(a);o<i.length;o++)c=i[o],n.haveElements(c)&&delete a[c];return console.debug("Preloading Elements: ".concat(Object.keys(a).length," not in HashMap")),e.next=9,Promise.all(Object.keys(a).map((function(e){return n.database.searchElements(r,e).then((function(t){t&&delete a[e]}))})));case 9:if(console.debug("Preloading Elements: ".concat(Object.keys(a).length," not in Database")),0!==Object.keys(a).length){e.next=12;break}return e.abrupt("return",0);case 12:return e.next=14,n.tryQuery(Object.values(a));case 14:return s=e.sent,console.log("Preloading Elements: Fetched ".concat(s.length," elements from Server")),u={},s.forEach((function(e){return"node"===e.type&&(u[e.id]=e)})),l={},s.forEach((function(e){return"way"===e.type&&(l[e.id]=e)})),e.next=22,Promise.all(Object.values(a).map((function(e){var t=ce(e,s,u,l);return n.elements.set(oe(e),Promise.resolve(t)),n.database.saveElements(r,oe(e),{elements:t,cached:Date.now()})})));case 22:return e.abrupt("return",s.length);case 23:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"haveElements",value:function(e){return this.elements.has(e)}},{key:"query",value:function(e){var t=this;if(this.bbox.split(",").map((function(e){return+e})).some(isNaN))throw Error("Invalid BBox");var n=e.map(ae),r="[out:json][bbox];\n(".concat(n.join(""),"\n);\nout;"),a="".concat(le,"?data=").concat(r.replace(/\s/,""),"&bbox=").concat(function(e){var t=d(e.split(",").map((function(e){return+e})),4),n=t[0],r=t[1],a=t[2],o=t[3];if(n>a){var i=[a,n];n=i[0],a=i[1]}if(r>o){var c=[o,r];r=c[0],o=c[1]}return"".concat(ie(n,-180,180),",").concat(ie(r,-90,90),",").concat(ie(a,-180,180),",").concat(ie(o,-90,90))}(this.bbox));return this.fetchMap[a]||(this.fetchMap[a]=fetch(a.toString()).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){return e.elements})),this.fetchMap[a].finally((function(){return delete t.fetchMap[a]}))),this.fetchMap[a]}},{key:"tryQuery",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.query(e).catch((function(r){if(429!==r)throw Error("Bad Response");if(n>0)return y(1e4).then((function(){return t.tryQuery(e,n-1)}));throw Error("Too many retries fetching data")}))}},{key:"getElements",value:function(){var e=$(U().mark((function e(t){var n,r,a,o,i,c,s=this;return U().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.bbox){e.next=2;break}return e.abrupt("return");case 2:if(n=oe(t),!this.elements.has(n)){e.next=5;break}return e.abrupt("return",this.elements.get(n));case 5:return e.next=7,this.database.getElements(this.bbox,n);case 7:if(!(r=e.sent)){e.next=12;break}return a=r.elements,this.elements.set(n,Promise.resolve(a)),e.abrupt("return",a);case 12:return e.next=14,this.database.searchElements(this.bbox,n);case 14:if(!(o=e.sent)){e.next=19;break}return i=this.database.getElementsByKey(o).then((function(e){return e.elements})),this.elements.set(n,i),e.abrupt("return",i);case 19:return c=this.tryQuery([t]),this.elements.set(n,c),c.catch((function(){return s.elements.delete(n)})),c.then((function(e){s.database.saveElements(s.bbox,n,{elements:e,cached:Date.now()})})),e.abrupt("return",c);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"jobs",value:function(e){return this.currentJob=this.currentJob.then((function(){return e()})),this.currentJob}},{key:"clearCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.elements.clear(),e)return this.database.clear()}}]),t}(),he=new fe,de=Promise.resolve();onmessage=function(e){if(e.data.canvas&&(se=e.data.canvas,ue=new H(se)),"clear"===e.data.method){var t=e.data.context,n=t.width,r=t.height,a=t.bbox;se.width=n,se.height=r,he.setBBox(a),de=Promise.resolve()}if("renderRule"===e.data.method){var o=e.data,i=o.context,c=o.rule;he.setBBox(i.bbox);var s=he.getElements(c.selector);de=de.then((function(){return s.then((function(e){return ue.renderRule(i,c,e)}))}))}}}()}();
//# sourceMappingURL=render-worker.9b56c034.worker.js.map