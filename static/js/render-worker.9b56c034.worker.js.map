{"version":3,"file":"static/js/render-worker.9b56c034.worker.js","mappings":"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","sources":["conf.js","../webpack/bootstrap","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/superPropBase.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","util/util.js","util/geometry.js","Classes/Style.js","util/matchPseudoClasses.js","util/evaluate.js","util/getContent.js","util/bbox.js","render/MapRenderer.js","render/CanvasRender/setStrokeFill.js","util/parseStrokeFill.js","render/CanvasRender/renderText.js","render/CanvasRender/transform.js","render/CanvasRender/renderPoint.js","Classes/CollisionSystem.js","render/CanvasRender/renderAreaLine.js","render/CanvasRender/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","data/database.idb.js","util/overpass.js","Classes/Overpass.js","render/render-worker.js"],"sourcesContent":["\nexport const API_ROOT = \"https://overpass-api.de/api/interpreter\";","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nexport default function _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}","import superPropBase from \"./superPropBase.js\";\nexport default function _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get.bind();\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn.js\";\nexport default function _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","/**\n * Promise based timeout\n * @param {number} duration\n */\nexport function timeout (duration) {\n    return new Promise(resolve => setTimeout(resolve, duration));\n}\n\n/**\n * @returns {(lon: number, lat: number) => [number, number]}\n * @param {number} minLon\n * @param {number} minLat\n * @param {number} maxLon\n * @param {number} maxLat\n * @param {number} width\n * @param {number} height\n */\nexport function flatProjection(minLon, minLat, maxLon, maxLat, width, height) {\n    const xScale = width / (maxLon - minLon);\n    const yScale = height / (maxLat - minLat);\n    const scale = Math.max(xScale, yScale);\n    return ((lon, lat) => [(lon - minLon) * scale, height - (lat - minLat) * scale]);\n}\n\n/**\n * @param {[number, number]} centre\n * @param {number} scale\n * @param {number} width\n * @param {number} height\n * @returns {(lon: number, lat: number) => [number, number]}\n */\nexport function mercatorProjection(centre, scale, width, height) {\n    const baseTileSize = 256;\n\n    const [cLon, cLat] = centre;\n\n    const tileCount = Math.pow(2, scale);\n    const degPerTileH = 180 / tileCount;\n    const degPerTileV = 180 / tileCount;\n\n    const hPixelsPerDeg = baseTileSize / degPerTileH;\n    const vPixelsPerDeg = baseTileSize / degPerTileV;\n\n    const QUARTER_PI = Math.PI / 4;\n\n    const cX = width / 2;\n    const cY = height / 2;\n\n    const cLatPrime = Math.log(Math.tan(QUARTER_PI + (cLat / 180 * Math.PI) / 2)) * 180 / Math.PI;\n\n    return (lon, lat) => {\n        const E = lon;\n        const N = Math.log(Math.tan(QUARTER_PI + (lat / 180 * Math.PI) / 2)) * 180 / Math.PI;\n\n        const dLon = E - cLon;\n        const dLat = N - cLatPrime;\n\n        const dX = dLon * hPixelsPerDeg;\n        const dY = dLat * vPixelsPerDeg;\n\n        return [cX + dX, cY - dY];\n    };\n}\n\n/**\n *\n * @param {[number, number][]} points\n */\nexport function getAveragePoint(points) {\n    const sum = points.reduce((sum, p) => [sum[0] + p[0], sum[1] + p[1]], [0, 0]);\n    const avg = /** @type {[number, number]} */(sum.map(x => x / points.length));\n    return avg;\n}\n\n/**\n *\n * @param {[number, number][]} points\n * @returns {[number, number]}\n */\nexport function getCentrePoint(points) {\n    const boundingBox = getBoundingBox(points);\n\n    return [\n        boundingBox[0] + boundingBox[2] / 2,\n        boundingBox[1] + boundingBox[3] / 2,\n    ];\n}\n\n/**\n *\n * @param {[number, number][]} points\n * @returns {[number, number]}\n */\nexport function getMidPoint(points) {\n    return points[Math.floor((points.length - 1) / 2)];\n}\n\n/**\n * @param {[number, number][]} points\n * @returns {[number, number, number, number]} (x, y, width, height)\n */\nexport function getBoundingBox(points) {\n    const minMax = points.reduce((minMax, point) => {\n        return [\n            Math.min(minMax[0], point[0]),\n            Math.min(minMax[1], point[1]),\n            Math.max(minMax[2], point[0]),\n            Math.max(minMax[3], point[1]),\n        ];\n    }, [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY]);\n\n    return [\n        minMax[0],\n        minMax[1],\n        minMax[2] - minMax[0],\n        minMax[3] - minMax[1],\n    ];\n}\n","\n/**\n * \n * @param {number} x \n * @param {number} y \n * @param {number} width \n * @param {number} height \n * @returns {[number, number][]}\n */\nexport function rectToPoints(x, y, width, height) {\n    /** @type {[number, number][]} */\n    return [\n        [x, y],\n        [x, y + height],\n        [x + width, y + height],\n        [x + width, y],\n    ];\n}\n\n\n/**\n * @see http://paulbourke.net/geometry/polygonmesh/#clockwise\n * @param {[number, number][]} points \n */\nexport function getCrossProductArea (points) {\n    let sum = 0;\n    for (let i = 0; i < points.length - 1; i++) {\n        sum += points[i][0] * points[i+1][1] - points[i+1][0] * points[i][1];\n    }\n    return sum / 2;\n}\n\n/**\n * @param {[number, number][]} points\n */\nexport function getArea (points) {\n    return Math.abs(getCrossProductArea(points));\n}\n\n/**\n * @param {[number, number][]} points\n */\nexport function isAntiClockwise (points) {\n    return getCrossProductArea(points) > 0;\n}\n\n/**\n * @see http://paulbourke.net/geometry/polygonmesh/#clockwise\n * @param {[number, number][]} points\n */\nexport function isConvex (points) {\n    const l = points.length;\n    if (l < 3) return;\n\n    let sign = 0;\n    for (let i = 1; i < l; i++) {\n        const a = points[i-1];\n        const b = points[i];\n        const c = points[(i+1) % l];\n        \n        const next = Math.sign((b[0] - a[0]) * (c[1] - b[1]) - (b[1] - a[1]) * (c[0] - b[0]));\n\n        if (sign === 0) sign = next;\n        else if (next !== 0 && sign !== next) return false;\n    }\n\n    return true;\n}\n\n\n/**\n * @param {[number, number][]} points\n */\nexport function isSelfClosing (points) {\n    const f = points[0];\n    const l = points[points.length - 1]; \n    return f[0] === l[0] && f[1] === l[1];\n}\n\n/**\n * @param {[number, number][]} points\n */\nexport function getLength (points) {\n    let sum = 0;\n\n    for (let i = 1; i < points.length; i++) {\n        const dx = points[i][0] - points[i-1][0];\n        const dy = points[i][1] - points[i-1][1];\n        sum += Math.sqrt(dx * dx + dy * dy);\n    }\n\n    return sum;\n}","export class StyleSelector {\r\n    /**\r\n     * @param {string} type\r\n     * @param {{ [key: string]: string }} tags\r\n     * @param {{ name: string, params: (string|Predicate)[] }[]} pseudoClasses\r\n     * @param {string} [pseudoElement]\r\n     */\r\n    constructor (type, tags, pseudoClasses=[], pseudoElement) {\r\n      this.type = type;\r\n      this.tags = tags;\r\n      this.pseudoClasses = pseudoClasses;\r\n      this.pseudoElement = pseudoElement;\r\n    }\r\n\r\n    toString () {\r\n      return `${this.type}${Object.entries(this.tags).map(([k,v]) => {\r\n        const op = /^[<=>]/.test(v) ? \"\" : \"=\";\r\n        return `[${k}${op}${v}]`;\r\n      }).join(\"\")}`;\r\n    }\r\n}\r\n\r\nStyleSelector.parse = /**\r\n * @param {string} text\r\n */\r\nfunction (text) {\r\n    const re = /^\\s*([a-z]+)/;\r\n    const m = re.exec(text);\r\n\r\n    if (!m) return null;\r\n\r\n    let type = m[1];\r\n\r\n    if (type === \"rel\") {\r\n      type = \"relation\";\r\n    }\r\n\r\n    /** @type {{ [key: string]: string }} */\r\n    const tags = {};\r\n\r\n    let tagText = text.substring(m[0].length).trim();\r\n\r\n    const re2 = /^\\[\"?([a-z0-9:_-]+)\"?(?:(=|<=|>=|<|>)([^[\\]]+))?\\]/i;\r\n\r\n    while (true) {\r\n      const m2 = re2.exec(tagText);\r\n\r\n      if (!m2) break;\r\n\r\n      const op = m2[2] === \"=\" ? \"\" : m2[2];\r\n\r\n      tags[m2[1]] = m2[3] ? op + m2[3] : \"*\";\r\n\r\n      tagText = tagText.substring(m2[0].length);\r\n    }\r\n\r\n    /** @type {{ name: string, params: (string|Predicate)[] }[]} */\r\n    const pseudoClasses = [];\r\n\r\n    const re3 = /^:([a-z-]+)(?:\\(([^)]+)\\))?/;\r\n\r\n    while (true) {\r\n      const m3 = re3.exec(tagText);\r\n\r\n      if (!m3) break;\r\n\r\n      const re = /^\\s*([^\\s)]+)\\s*(:|=|<=|>=|<|>|and|or)\\s*([^\\s)]+)(?:\\s*(=|<=|>=|<|>)\\s*([^\\s)]+))?/;\r\n      const params = m3[2] ? m3[2].split(\",\").map(s => re.test(s) ? makePredicate(re.exec(s)) : s) : [];\r\n      pseudoClasses.push({ name: m3[1], params });\r\n\r\n      tagText = tagText.substring(m3[0].length);\r\n    }\r\n\r\n    let pseudoElement;\r\n\r\n    const re4 = /^::([a-z-]+)?/;\r\n\r\n    const m4 = re4.exec(tagText);\r\n    if (m4) {\r\n      pseudoElement = m4[1];\r\n\r\n      tagText = tagText.substring(m4[0].length);\r\n    }\r\n\r\n    if (tagText.length) {\r\n      console.log(`Invalid selector: ${text} unexpected part: '${tagText}'`);\r\n      return null;\r\n    }\r\n\r\n    return new StyleSelector(type, tags, pseudoClasses, pseudoElement);\r\n};\r\n\r\n/**\r\n *\r\n * @param {string} text\r\n * @returns {StyleSelector[]}\r\n */\r\nStyleSelector.parseMultiple = function (text) {\r\n    // @ts-ignore\r\n    return text.split(\",\").map(StyleSelector.parse).filter(x => x);\r\n}\r\n\r\nStyleSelector.clone = function (/** @type {StyleSelector} */ other) {\r\n  return new StyleSelector(other.type, other.tags, other.pseudoClasses, other.pseudoElement);\r\n}\r\n\r\n/**\r\n *\r\n * @param {{ rules: StyleRule[] }} style\r\n * @param {OverpassElement} element\r\n * @returns {StyleRule?}\r\n */\r\nexport function matchRule (style, element) {\r\n    for (const rule of style.rules) {\r\n      if (matchSelector(rule.selector, element))\r\n        return rule;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * @param {StyleSelector} selector\r\n * @param {OverpassElement} element\r\n */\r\nexport function matchSelector (selector, element, inequalities=true) {\r\n  if (element.type !== selector.type && !(selector.type === \"area\" && element.type === \"way\")) return false;\r\n\r\n  const entries = Object.entries(selector.tags);\r\n  if (entries.length && typeof element.tags === \"undefined\") return false;\r\n\r\n  for (const [key, value] of entries) {\r\n    if (typeof element.tags[key] === \"undefined\") return false;\r\n\r\n    const m = /^[<=>]+/.exec(value);\r\n    if (m) {\r\n      // Only test if inequalities are enabled\r\n      if (inequalities) {\r\n        const op = m[0];\r\n        const cmp = COMPARE[op];\r\n        // Skip if invalid operator\r\n        if (!cmp) continue;\r\n        const v = value.substr(m[0].length);\r\n        // String compare or numeric compare\r\n        const res = isNaN(+v) ? cmp(element.tags[key].localeCompare(v), 0) : cmp(+element.tags[key], +v);\r\n\r\n        if (!res) return false;\r\n      }\r\n      // If inequalities are disabled then this tag gets a pass\r\n    }\r\n    else if (value !== \"*\" && element.tags[key] !== value) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * @param {string} styleText\r\n */\r\nexport function parseStyle (styleText) {\r\n  /** @type {{ rules: (StyleRule|MediaQuery)[] }} */\r\n  const out = { rules: [] };\r\n\r\n  let length = styleText.length;\r\n\r\n  while (length > 0) {\r\n\r\n    // Try parsing rule list\r\n    const rulesResult = parseRules(styleText);\r\n    out.rules.push(...rulesResult.rules);\r\n    styleText = styleText.substring(rulesResult.index).trim();\r\n\r\n    // Try parsing media query\r\n    const mediaResult = parseMedia(styleText);\r\n    out.rules.push(...mediaResult.mediaQueries);\r\n    styleText = styleText.substring(mediaResult.index).trim();\r\n\r\n    if (styleText.length === length) {\r\n      console.log(\"Got stuck parsing style at: \" + styleText);\r\n      break;\r\n    }\r\n\r\n    length = styleText.length;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * @param {string} mediaText\r\n */\r\nfunction parseMedia (mediaText) {\r\n  const re = /^\\s*@match\\s*\\(([^\\s)]+)\\s*(:|=|<=|>=|<|>|and|or)\\s*([^\\s)]+)(?:\\s*(=|<=|>=|<|>)\\s*([^\\s)]+))?\\)\\s*{/;\r\n  /** @type {{ mediaQueries: MediaQuery[], index: number }} */\r\n  const out = { mediaQueries: [], index: 0 };\r\n  let match;\r\n\r\n  const re2 = /^\\s*}/;\r\n  let match2;\r\n\r\n  while (match = re.exec(mediaText)) {\r\n    const predicate = makePredicate(match);\r\n\r\n    out.index += match[0].length;\r\n\r\n    mediaText = mediaText.substring(match[0].length);\r\n\r\n    const { rules, index } = parseRules(mediaText);\r\n\r\n    out.index += index;\r\n\r\n    mediaText = mediaText.substring(index);\r\n\r\n    match2 = re2.exec(mediaText);\r\n\r\n    if (match2) {\r\n      out.mediaQueries.push({\r\n        type: \"query\",\r\n        predicate,\r\n        rules,\r\n      });\r\n\r\n      out.index += match2[0].length;\r\n\r\n    } else {\r\n      console.log(\"Unterminated media query\");\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nfunction parseRules (ruleText) {\r\n  const re = /^\\s*([^{}]+)\\s*{([^{}]*)}/;\r\n  let match;\r\n  /** @type {{ rules: StyleRule[], index: number }} */\r\n  const out = { rules: [], index: 0 };\r\n\r\n  while(match = re.exec(ruleText)) {\r\n    /** @type {{ [key: string]: string }} */\r\n    const declarations = {};\r\n\r\n    match[2].split(\";\").map(s => s.trim()).filter(s => s).forEach(s => {\r\n      // s.split(\":\", 2) is not the same as PHP\r\n      const i = s.indexOf(\":\");\r\n      const property = s.substring(0,i).trim();\r\n      const value = s.substring(i+1).trim();\r\n      declarations[property] = value;\r\n    });\r\n\r\n    const selectors = StyleSelector.parseMultiple(match[1]);\r\n\r\n    // Duplicate rules for all selectors\r\n    for (const selector of selectors) {\r\n      out.rules.push({\r\n        type: \"rule\",\r\n        selector,\r\n        declarations,\r\n      });\r\n    }\r\n\r\n    out.index += match[0].length;\r\n\r\n    ruleText = ruleText.substring(match[0].length);\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n *\r\n * @param {(StyleRule|MediaQuery)[]} rules\r\n * @param {MapContext} context\r\n * @returns {StyleRule[]}\r\n */\r\nexport function filterRules (rules, context) {\r\n  /** @type {StyleRule[]} */\r\n  const out = [];\r\n  for (const rule of rules) {\r\n    if (rule.type === \"rule\") {\r\n      out.push(rule);\r\n    } else {\r\n      if (testPredicate(rule.predicate, context)) {\r\n        out.push(...filterRules(rule.rules, context));\r\n      }\r\n    }\r\n  }\r\n  return out;\r\n}\r\n\r\nfunction makePredicate(match) {\r\n  let predicate;\r\n\r\n  if (match[4]) {\r\n    // MediaQueries4 syntax:\r\n    //  @match (10 < zoom <= 14)\r\n    predicate = {\r\n      left: { left: match[1], operator: match[2], right: match[3] },\r\n      operator: \"and\",\r\n      right: { left: match[3], operator: match[4], right: match[5] },\r\n    };\r\n  }\r\n  else {\r\n    // MediaQueries4 syntax:\r\n    //  @match (zoom <= 14)\r\n    // MediaQueries3 syntax:\r\n    //  @match (max-zoom: 14) [TODO - it's parsed just not handled correctly]\r\n    predicate = {\r\n      left: match[1],\r\n      operator: match[2],\r\n      right: match[3],\r\n    };\r\n  }\r\n  return predicate;\r\n}\r\n\r\n/**\r\n *\r\n * @param {Predicate} predicate\r\n * @param {MapContext|ElementContext} [context]\r\n * @returns {boolean}\r\n */\r\nexport function testPredicate (predicate, context) {\r\n  let left = typeof predicate.left === \"string\" || typeof predicate.left === \"number\" ?\r\n    predicate.left : testPredicate(predicate.left, context);\r\n  let right = typeof predicate.right === \"string\" || typeof predicate.right === \"number\"  ?\r\n    predicate.right : testPredicate(predicate.right, context);\r\n\r\n  if (context && typeof left === \"string\" && left in context) {\r\n    // Lazily evaluate and replace context value\r\n    if (context[left] instanceof Function)\r\n      context[left] = context[left]();\r\n\r\n    left = context[left];\r\n  }\r\n\r\n  if (context && typeof right === \"string\" && right in context) {\r\n    // Lazily evaluate and replace context value\r\n    if (context[right] instanceof Function)\r\n      context[right] = context[right]();\r\n\r\n    right = context[right];\r\n  }\r\n\r\n  const op = COMPARE[predicate.operator];\r\n\r\n  if (!op) return false;\r\n\r\n  return op(left, right);\r\n}\r\n\r\nconst COMPARE = {\r\n  \":\": (a,b) => a == b,\r\n  \"=\": (a,b) => a == b,\r\n  \">\": (a,b) => a > b,\r\n  \"<\": (a,b) => a < b,\r\n  \">=\": (a,b) => a >= b,\r\n  \"<=\": (a,b) => a <= b,\r\n  \"and\": (a,b) => a && b,\r\n  \"or\": (a,b) => a || b,\r\n}","import { getArea, isConvex, isAntiClockwise, getLength } from \"./geometry\";\nimport { testPredicate } from \"../Classes/Style\";\nimport { getBoundingBox } from \"./util\";\n\n/**\n * @param {StyleRule} rule\n * @param {[number, number][]} points\n * @param {OverpassElement} [element]\n * @param {OverpassElement[]} [nodes]\n */\nexport function matchPseudoClasses(rule, points, element, nodes) {\n    const { selector } = rule;\n\n    if (includesPseudoClass(selector, \"is\", \"convex\")) {\n        if (!isConvex(points))\n            return false;\n    }\n\n    if (includesPseudoClass(selector, \"is\", \"concave\")) {\n        if (isConvex(points))\n            return false;\n    }\n\n    if (includesPseudoClass(selector, \"is\", \"clockwise\")) {\n        if (isAntiClockwise(points))\n            return false;\n    }\n\n    if (includesPseudoClass(selector, \"is\", \"anti-clockwise\")) {\n        if (!isAntiClockwise(points))\n            return false;\n    }\n\n    if (includesPseudoClass(selector, \"is\", \"self-closing\")) {\n        if (nodes && nodes[0] !== nodes[points.length - 1])\n            return false;\n    }\n\n    const hasPseudoClasses = selector.pseudoClasses.filter(c => c.name === \"has\");\n\n    for (const pc of hasPseudoClasses) {\n        if (typeof pc.params[0] === \"string\")\n            return false;\n\n        const predicate = pc.params[0];\n\n        // Functions for lazy evaluation\n        const elementContext = {\n            area: () => getArea(points),\n            length: () => getLength(points),\n            width: () => getBoundingBox(points)[2],\n            height: () => getBoundingBox(points)[3],\n        };\n\n        const match = testPredicate(predicate, elementContext);\n\n        if (!match) return false;\n    }\n\n    return true;\n}\n\n/**\n * @todo Add support for more than one paramater\n * @param {StyleSelector} selector\n * @param {string} name\n * @param  {...string} params\n */\nfunction includesPseudoClass (selector, name, ...params) {\n    return selector.pseudoClasses.some(c => c.name === name && c.params[0] === params[0]);\n}","/**\r\n * Evaluate right-hand-side in following usage examples:\r\n *\r\n *  content: \"hello\";\r\n *  content: tag(name);\r\n *  content: \"hello \" tag(name);\r\n *  fill: tag(color);\r\n *  size: tag(count);\r\n *\r\n * Constants should just pass straight through:\r\n *  size: 2;\r\n *  fill: red;\r\n *  fill: #000;\r\n *  fill: rgb(255,0,0);\r\n *\r\n * @param {string} value\r\n * @param {OverpassElement?} element\r\n * @param {MapContext} context\r\n * @returns\r\n */\r\nexport function evaluateValue (value, element, context) {\r\n\r\n    if (!value) {\r\n        return \"\";\r\n    }\r\n\r\n    let index = 0;\r\n    /** @type {string[]} */\r\n    const out = [];\r\n\r\n    while (index < value.length) {\r\n        const c = value.substring(index);\r\n\r\n        let m = /^\\s+/.exec(c);\r\n        if (m) {\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        m = /^\"(.*?[^\\\\])\"/.exec(c);\r\n        if (m) {\r\n            out.push(m[1].replace(/\\\\\"/g, `\"`).replace(/\\\\n/g, `\\n`));\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        // Following values require an element\r\n        if (!element) {\r\n            return c;\r\n        }\r\n\r\n        // Handle tag() function.\r\n        // Evaluates to the value of a tag, or optionally a default constant.\r\n        // e.g.\r\n        //  tag(name, \"UNKNOWN\");\r\n        //  tag(size, 3);\r\n        m = /^tag\\(([^),]+)(?:,\\s*([^),]+))?\\s*\\)/.exec(c);\r\n        if (m) {\r\n            out.push(element.tags[m[1]] || m[2]?.replace(/^\"|\"$/g, \"\") || \"\");\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        // Handle debug() function\r\n        m = /^debug\\(([^)]+)\\)/.exec(c);\r\n        if (m) {\r\n            if (m[1] === \"type\") out.push(element.type);\r\n            else if (m[1] === \"tags\") out.push(Object.entries(element.tags).map(([key, value]) => `[${key}=${value}]`).join(\"\\n\"));\r\n            else if (m[1] === \"location\" && element.type === \"node\") out.push(`(${element.lon},${element.lat})`);\r\n            else if (m[1] === \"node_count\" && (element.type === \"way\" || element.type === \"area\")) out.push(element.nodes.length.toString());\r\n            // else if (m[1] === \"length\" && (element.type === \"way\" || element.type === \"area\")) out.push(getLength(element.).toString())\r\n            // else if (m[1] === \"area\" && (element.type === \"way\" || element.type === \"area\")) out.push(getArea(element.).toString())\r\n            else if (m[1] === \"scale\") out.push(context.scale.toString());\r\n            index += m[0].length;\r\n            continue;\r\n        }\r\n\r\n        // Pass constants though\r\n        return c;\r\n    }\r\n\r\n    return out.join(\"\");\r\n}","import { evaluateValue } from \"./evaluate\";\n\n/**\n * @param {StyleRule} rule\n * @param {OverpassElement?} element\n * @param {MapContext} context\n */\nexport function getContent(rule, element, context) {\n    let content = rule.declarations[\"content\"];\n\n    if (!content)\n        return \"\";\n\n    return evaluateValue(content, element, context);\n}\n","\n/**\n * Can the string be considered a valid bbox?\n * - Are there four parts?\n * - Are they all numberic?\n * - Are they in the correct order?\n * @param {string} bbox\n */\nexport function isValid (bbox) {\n    const parts = bbox.split(\",\");\n\n    if (parts.length !== 4) return false;\n\n    if (parts.some(p => isNaN(+p))) return false;\n\n    return +parts[0] < +parts[2] && +parts[1] < +parts[3];\n}\n\n/**\n * Determines whether or not areaB is entirely contained\n * within areaA\n * @param {string} areaA\n * @param {string} areaB\n * @returns {boolean}\n */\nexport function contains (areaA, areaB) {\n    const [Ax1,Ay1,Ax2,Ay2] = areaA.split(\",\");\n    const [Bx1,By1,Bx2,By2] = areaB.split(\",\");\n\n    return (Bx1 >= Ax1 && By1 >= Ay1 && Bx2 <= Ax2 && By2 <= Ay2);\n}\n\n/**\n * Compute simple area\n * @param {string} bbox\n */\nexport function getArea (bbox) {\n    const parts = bbox.split(\",\");\n    return (+parts[2] - +parts[0]) * (+parts[3] - +parts[1]);\n}\n\n/**\n *\n * @param {[number, number]} centre\n * @param {number} zoom\n * @param {[number, number]} size\n */\nexport function makeBBox (centre, zoom, size) {\n    const baseTileSize = 256;\n\n    const [ lon, lat ] = centre;\n    const [ width, height ] = size;\n\n    const tileCount = Math.pow(2, zoom)\n    const xSpan = 180 / tileCount;\n    const ySpan = 180 / tileCount;\n\n    const hTileCount = width / baseTileSize;\n    const vTileCount = height / baseTileSize;\n\n    const dLon = xSpan * hTileCount;\n    const dLat = ySpan * vTileCount;\n\n    return [ lon - dLon, lat - dLat, lon + dLon, lat + dLat ].map(p => p.toFixed(3)).join(\",\");\n}","import { mercatorProjection, getCentrePoint, getMidPoint, getAveragePoint, getBoundingBox } from \"../util/util\";\r\nimport { rectToPoints, isSelfClosing } from \"../util/geometry\";\r\nimport { matchPseudoClasses } from \"../util/matchPseudoClasses\";\r\nimport { getContent } from \"../util/getContent\";\r\nimport { makeBBox } from \"../util/bbox\";\r\nimport { matchSelector } from \"../Classes/Style\";\r\n\r\nexport default class MapRenderer {\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {OverpassElement[]} elements\r\n     */\r\n    renderRule (context, rule, elements=[]) {\r\n        // Prepare node map\r\n        /** @type {{ [id: number]: OverpassNodeElement }} */\r\n        const nodeMap = {};\r\n        elements.forEach(n => n.type === \"node\" && (nodeMap[n.id] = n));\r\n        // Prepare way map\r\n        /** @type {{ [id: number]: OverpassWayElement }} */\r\n        const wayMap = {};\r\n        elements.forEach(n => n.type === \"way\" && (wayMap[n.id] = n));\r\n\r\n        const { centre, zoom, width, height } = context;\r\n\r\n        /** @type {(lon: number, lat: number) => [number, number]} */\r\n        const projection = mercatorProjection(centre, zoom, width, height);\r\n\r\n        // Set up global context options\r\n        this.globalSetup(context, rule);\r\n\r\n        const { type } = rule.selector;\r\n\r\n        // Non-Overpass Types first\r\n        switch (type) {\r\n            case \"map\": {\r\n                const points = rectToPoints(0, 0, width, height);\r\n                if (rule.selector.pseudoElement)\r\n                    this.renderPseudoElement(context, rule, points, null);\r\n                else\r\n                    this.renderArea(context, rule, points, null);\r\n                break;\r\n            }\r\n            case \"centre\": {\r\n                /** @type {OverpassNodeElement} */\r\n                const dummyElement = { id: -1, type: \"node\", lon: context.centre[0], lat: context.centre[1], tags: {} };\r\n                this.renderPoint(context, rule, projection(dummyElement.lon, dummyElement.lat), dummyElement);\r\n                break;\r\n            }\r\n            case \"current\": {\r\n                if (context.current) {\r\n                    const coords = context.current;\r\n                    this.renderPoint(context, rule, projection(coords.longitude, coords.latitude));\r\n                }\r\n                break;\r\n            }\r\n            case \"gridlines\": {\r\n                this.renderGridlines(context, rule, projection);\r\n                break;\r\n            }\r\n            case \"dummy\": {\r\n                this.renderPoint(context, rule, [0, 0]);\r\n                break;\r\n            }\r\n            default:\r\n                // Then iterate all elements\r\n                for (const el of elements) {\r\n                    if (!matchSelector(rule.selector, el)) continue;\r\n\r\n                    switch (type) {\r\n                        case \"node\": {\r\n                            if (el.type !== \"node\") continue;\r\n\r\n                            const point = projection(el.lon, el.lat);\r\n\r\n                            if (rule.selector.pseudoElement) {\r\n                                this.renderPseudoElement(context, rule, [point], el, [el]);\r\n                            }\r\n                            else {\r\n                                this.renderPoint(context, rule, point, el);\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"way\":\r\n                        case \"area\": {\r\n                            if (el.type !== \"way\") continue;\r\n\r\n                            /** @type {OverpassNodeElement[]} */\r\n                            const nodes = el.nodes.map(id => nodeMap[id]);\r\n                            const points = nodes.map(n => projection(n.lon, n.lat));\r\n\r\n                            if (!matchPseudoClasses(rule, points, el, nodes)) continue;\r\n\r\n                            if (rule.selector.pseudoElement) {\r\n                                this.renderPseudoElement(context, rule, points, el, nodes);\r\n                            }\r\n                            else {\r\n                                // Render actual way/area\r\n                                if (type === \"area\") {\r\n                                    this.renderArea(context, rule, points, el);\r\n                                } else {\r\n                                    this.renderLine(context, rule, points, el);\r\n                                }\r\n                            }\r\n                            break;\r\n                        }\r\n                        case \"relation\": {\r\n                            if (el.type !== \"relation\") continue;\r\n\r\n                            // this.renderRelation(rule, el, wayMap, nodeMap, projection, context);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {[number, number]} point\r\n     * @param {OverpassElement?} element\r\n     */\r\n    renderPoint (context, rule, point, element=null) {}\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {[number, number][]} points\r\n     * @param {OverpassElement?} element\r\n     */\r\n    renderLine (context, rule, points, element=null) {\r\n        this.renderAreaLine(context, rule, points, getMidPoint, element);\r\n    }\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {[number, number][]} points\r\n     * @param {OverpassElement?} element\r\n     */\r\n    renderArea (context, rule, points, element=null) {\r\n        if (points.length === 0)\r\n            return;\r\n\r\n        if (!isSelfClosing(points)) {\r\n            points = [ ...points, points[0] ];\r\n        }\r\n\r\n        this.renderAreaLine(context, rule, points, getCentrePoint, element);\r\n    }\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {[number, number][]} points\r\n     * @param {(points: [number,number][]) => [number,number]} getPoint\r\n     * @param {OverpassElement?} element\r\n     */\r\n    renderAreaLine (context, rule, points, getPoint, element=null) {}\r\n\r\n    /**\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {[number, number][]} points\r\n     * @param {OverpassElement?} element\r\n     * @param {OverpassNodeElement[]} [nodes]\r\n     */\r\n    renderPseudoElement(context, rule, points, element, nodes=[]) {\r\n        switch (rule.selector.pseudoElement) {\r\n            case \"centre\":\r\n            case \"center\": {\r\n                // Centre of bounding box\r\n                const centrePoint = getCentrePoint(points);\r\n                this.renderPoint(context, rule, centrePoint, element);\r\n                break;\r\n            }\r\n            case \"mid-point\": {\r\n                // N/2th point (median point)\r\n                const midPoint = getMidPoint(points);\r\n                this.renderPoint(context, rule, midPoint, element);\r\n                break;\r\n            }\r\n            case \"average-point\": {\r\n                // Average of all points\r\n                const avgPoint = getAveragePoint(points);\r\n                this.renderPoint(context, rule, avgPoint, element);\r\n                break;\r\n            }\r\n            case \"start\": {\r\n                // First point\r\n                this.renderPoint(context, rule, points[0], element);\r\n                break;\r\n            }\r\n            case \"end\": {\r\n                // Last point\r\n                this.renderPoint(context, rule, points[points.length - 1], element);\r\n                break;\r\n            }\r\n            case \"centre-of-mass\": {\r\n                // TODO: calculate centre-of-mass\r\n                // const avgPoint = getCOMPoint(points);\r\n                // renderPoint(ctx, rule, avgPoint, element);\r\n                break;\r\n            }\r\n            case \"bounding-box\": {\r\n                const bounding = getBoundingBox(points);\r\n\r\n                const boundingPoints = rectToPoints(...bounding);\r\n\r\n                this.renderArea(context, rule, boundingPoints, element);\r\n                break;\r\n            }\r\n            case \"content-box\": {\r\n                const { scale } = context;\r\n                let point = points[0];\r\n\r\n                if (rule.selector.type === \"way\")\r\n                    point = getMidPoint(points);\r\n                else if (rule.selector.type === \"area\")\r\n                    point = getCentrePoint(points);\r\n\r\n                if (!element) return;\r\n\r\n                const content = getContent(rule, element, context);\r\n\r\n                if (!content) return;\r\n\r\n                let [ x, y ] = point;\r\n\r\n                let width = Number.NEGATIVE_INFINITY;;\r\n                let top = Number.NaN;\r\n                let bottom = 0;\r\n                let baseline = y;\r\n                for (const line of content.split(\"\\n\")) {\r\n                    const size = this.measureText(context, rule, line);\r\n\r\n                    width = Math.max(width, size.width);\r\n\r\n                    if (isNaN(top)) top = y - size.ascending;\r\n\r\n                    bottom = baseline + size.descending;\r\n\r\n                    baseline += size.height;\r\n                }\r\n\r\n                const padding = rule.declarations[\"padding\"] ? parseFloat(rule.declarations[\"padding\"]) * scale : 0;\r\n\r\n                if (rule.declarations[\"text-align\"] === \"center\" || rule.declarations[\"text-align\"] === \"centre\") {\r\n                    x -= width / 2;\r\n                }\r\n                else if (rule.declarations[\"text-align\"] === \"right\") {\r\n                    x -= width;\r\n                }\r\n\r\n                /** @type {[number, number][]} */\r\n                const boundPoints = [\r\n                    [ x - padding,           top - padding ],     // Top Left\r\n                    [ x - padding,           bottom + padding ],    // Bottom left\r\n                    [ x + width + padding,   bottom + padding ],    // Bottom right\r\n                    [ x + width + padding,   top - padding ],     // Top Right\r\n                ];\r\n\r\n                // Close self\r\n                boundPoints.push(boundPoints[0]);\r\n\r\n                this.renderAreaLine(context, rule, boundPoints, () => point, element);\r\n                break;\r\n            }\r\n            case \"decimate\": {\r\n                if (rule.selector.type === \"way\") {\r\n                    const l = points.length - 1;\r\n                    const decimatedPoints = points.filter((p, i) => i % 10 === 0 || i === l);\r\n                    this.renderLine(context, rule, decimatedPoints, element);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    renderGridlines (context, rule, projection) {\r\n        const vertical = rule.selector.pseudoClasses.find(p => p.name === \"vertical\");\r\n        const horizontal = rule.selector.pseudoClasses.find(p => p.name === \"horizontal\");\r\n\r\n        const { width, height, centre, zoom } = context;\r\n\r\n        const bbox = makeBBox(centre, zoom, [width, height]);\r\n        const parts = bbox.split(\",\");\r\n\r\n        if (vertical) {\r\n            const step = parseFloat(vertical.params[0]);\r\n\r\n            const round = 1 / step;\r\n\r\n            const sigFigs = Math.ceil(Math.log10(round));\r\n\r\n            const xmin = Math.floor(+parts[0] * round) / round;\r\n            const xmax = Math.ceil(+parts[2] * round) / round;\r\n            const ymin = Math.floor(+parts[1] * round) / round;\r\n            const ymax = Math.ceil(+parts[3] * round) / round;\r\n\r\n            for (let i = xmin; i <= xmax; i += step) {\r\n                const points = [ projection(i, ymin),  projection(i, (ymin + ymax) / 2), projection(i, ymax) ];\r\n                this.renderLine(context, rule, points, { type: \"way\", id: 0, nodes: [], tags: { name: i.toFixed(sigFigs) }});\r\n            }\r\n        }\r\n\r\n        if (horizontal) {\r\n            const step = parseFloat(horizontal.params[0]);\r\n\r\n            const round = 1 / step;\r\n\r\n            const sigFigs = Math.ceil(Math.log10(round));\r\n\r\n            const xmin = Math.floor(+parts[0] * round) / round;\r\n            const xmax = Math.ceil(+parts[2] * round) / round;\r\n            const ymin = Math.floor(+parts[1] * round) / round;\r\n            const ymax = Math.ceil(+parts[3] * round) / round;\r\n\r\n            for (let j = ymin; j <= ymax; j += step) {\r\n                const points = [ projection(xmin, j), projection((xmin + xmax) / 2, j), projection(xmax, j) ];\r\n                this.renderLine(context, rule, points, { type: \"way\", id: 0, nodes: [], tags: { name: j.toFixed(sigFigs) }});\r\n            }\r\n        }\r\n    }\r\n\r\n    clear (context) {}\r\n\r\n    globalSetup (context, rule) { }\r\n\r\n    /**\r\n     *\r\n     * @param {MapContext} context\r\n     * @param {StyleRule} rule\r\n     * @param {string} text\r\n     * @return {{ width: number, ascending: number, descending: number, height: number }}\r\n     */\r\n    measureText (context, rule, text) {\r\n        return { width: 0, ascending: 0, descending: 0, height: 0 };\r\n    }\r\n}","import { parseStrokeFill } from '../../util/parseStrokeFill';\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {OverpassElement?} element\r\n * @param {MapContext} context\r\n */\r\nexport function setStrokeFill (ctx, rule, element, context) {\r\n    const { fillStyle, strokeStyle, lineWidth, lineDash } = parseStrokeFill(rule, element, context);\r\n\r\n    ctx.fillStyle = fillStyle;\r\n    ctx.strokeStyle = strokeStyle;\r\n    ctx.lineWidth = lineWidth;\r\n    if (lineDash) {\r\n        ctx.setLineDash(lineDash);\r\n    }\r\n}","import { evaluateValue } from \"./evaluate\";\r\n\r\n/**\r\n * @param {StyleRule} rule\r\n * @param {OverpassElement?} element\r\n * @param {MapContext} context\r\n */\r\nexport function parseStrokeFill(rule, element, context) {\r\n    const fillStyle = evaluateValue(rule.declarations[\"fill\"], element, context);\r\n    let lineWidth;\r\n    let strokeStyle = evaluateValue(rule.declarations[\"stroke\"], element, context);\r\n    /** @type {number[]} */\r\n    let lineDash;\r\n\r\n    const { scale } = context;\r\n\r\n    if (strokeStyle) {\r\n        // Numbers in e.g. rgba(128,64,0,0.2) confuse it\r\n        let mutedStyle = strokeStyle.replace(/\\([^)]*\\)/g, ss => \" \".repeat(ss.length));\r\n\r\n        // So would hex colour strings\r\n        mutedStyle = mutedStyle.replace(/#[0-9a-f]{3}/i, \"    \");\r\n        mutedStyle = mutedStyle.replace(/#[0-9a-f]{6}/i, \"       \");\r\n\r\n        /**\r\n         * @todo A better parser would probably be nice\r\n         */\r\n        const swRe = /(\\d+(?:\\.\\d+)?)\\s*(?:px)?/;\r\n        const sm = swRe.exec(mutedStyle);\r\n        if (sm) {\r\n            lineWidth = +sm[1] * scale;\r\n            strokeStyle = strokeStyle.replace(sm[0], \"\");\r\n        }\r\n    }\r\n\r\n    if (rule.declarations[\"stroke-width\"]) {\r\n        lineWidth = +rule.declarations[\"stroke-width\"] * scale;\r\n    }\r\n    else {\r\n        lineWidth = scale;\r\n    }\r\n\r\n    if (rule.declarations[\"stroke-dash\"]) {\r\n        lineDash = rule.declarations[\"stroke-dash\"].split(\" \").map(s => +s * scale);\r\n    }\r\n    else {\r\n        lineDash = [];\r\n    }\r\n\r\n    return {\r\n        fillStyle,\r\n        strokeStyle,\r\n        lineWidth,\r\n        lineDash,\r\n    };\r\n}","import { setStrokeFill } from \"./setStrokeFill\";\r\nimport { getContent } from \"../../util/getContent\";\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {[number, number]} param2\r\n * @param {OverpassElement?} element\r\n * @param {MapContext} context\r\n */\r\nexport function renderText(ctx, rule, [x, y], element = null, context) {\r\n    setStrokeFill(ctx, rule, element, context);\r\n\r\n    let content = getContent(rule, element, context);\r\n\r\n    setFont(ctx, rule, context.scale);\r\n\r\n    for (const line of content.split(\"\\n\")) {\r\n        y += renderLine(ctx, rule, line, x, y, context);\r\n    }\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {string} content\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {MapContext} context\r\n */\r\nfunction renderLine(ctx, rule, content, x, y, context) {\r\n    const size = ctx.measureText(content);\r\n\r\n    if (rule.declarations[\"text-align\"]) {\r\n        const textWidth = size.width;\r\n\r\n        if (rule.declarations[\"text-align\"] === \"center\" || rule.declarations[\"text-align\"] === \"centre\") {\r\n            x -= textWidth / 2;\r\n        }\r\n        else if (rule.declarations[\"text-align\"] === \"right\") {\r\n            x -= textWidth;\r\n        }\r\n    }\r\n\r\n    if (rule.declarations[\"stroke-width\"]) {\r\n        ctx.lineWidth = parseFloat(rule.declarations[\"stroke-width\"]) * context.scale;\r\n    }\r\n\r\n    if (rule.declarations[\"text-stroke\"]) {\r\n        // Todo: parse `2px red`\r\n        ctx.strokeStyle = rule.declarations[\"text-stroke\"];\r\n        ctx.strokeText(content, x, y);\r\n    }\r\n\r\n    if (rule.declarations[\"text-color\"] || !rule.declarations[\"text-stroke\"]) {\r\n        ctx.fillStyle = rule.declarations[\"text-color\"];\r\n        ctx.fillText(content, x, y);\r\n    }\r\n\r\n    const height = size.actualBoundingBoxAscent + size.actualBoundingBoxDescent;\r\n    return height;\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D|OffscreenCanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {number} scale\r\n */\r\nexport function setFont(ctx, rule, scale) {\r\n    let fontSize = `${10 * scale}px`;\r\n    let fontWeight = \"normal\";\r\n    let fontFamily = \"sans-serif\";\r\n\r\n    if (rule.declarations[\"font\"]) {\r\n        // It would be nice for the specific properties to override the\r\n        // shorthand, but it would complicate things a bit.\r\n        ctx.font = rule.declarations[\"font\"].replace(/\\d+(?:\\.\\d+)?/, s => `${+s * scale}`);\r\n    }\r\n    else {\r\n        if (rule.declarations[\"font-size\"]) {\r\n            fontSize = rule.declarations[\"font-size\"].replace(/^\\d[\\d.]*/, m => `${+m * scale}`);\r\n        }\r\n\r\n        if (rule.declarations[\"font-weight\"]) {\r\n            fontWeight = rule.declarations[\"font-weight\"];\r\n        }\r\n\r\n        if (rule.declarations[\"font-family\"]) {\r\n            fontFamily = rule.declarations[\"font-family\"];\r\n        }\r\n\r\n        ctx.font = `${fontWeight} ${fontSize} ${fontFamily}`;\r\n    }\r\n}\r\n","/**\n * @param {CanvasRenderingContext2D} ctx\n * @param {StyleRule} rule\n * @param {number} scale\n */\nexport function applyTransform(ctx, rule, scale) {\n\n    if (rule.declarations[\"transform\"]) {\n        const r = /\\s*([a-z]+)\\(([^)]*)\\)\\s*/g;\n        const t = rule.declarations[\"transform\"];\n        let m;\n        while (m = r.exec(t)) {\n            const trans = m[1];\n            const params = m[2].split(\",\").map(s => ({ value: parseFloat(s), unit: s.replace(/[-\\d.\\s]/g, \"\") }));\n            switch (trans) {\n                case \"matrix\":\n                    // @ts-ignore\n                    ctx.transform(...params.map(p => p.value));\n                    break;\n                case \"rotate\": {\n                    // rotate(10 deg)\n                    // rotate(0.5 turn)\n                    // rotate(1.55 rad)\n                    let { value, unit } = params[0];\n\n                    if (unit === \"deg\") {\n                        value *= Math.PI / 180;\n                    } else if (unit === \"turn\") {\n                        value *= Math.PI * 2;\n                    }\n\n                    ctx.rotate(value);\n                    break;\n                }\n                case \"scale\":\n                    // scale(2)\n                    // scale(2, 1)\n                    const x = params[0].value;\n                    const y = params[1] ? params[1].value : x;\n                    ctx.scale(x, y);\n                    break;\n                case \"translate\":\n                    // translate(10, 20)\n                    // @ts-ignore\n                    ctx.translate(...params.map(p => p.value * scale));\n                    break;\n                case \"skew\":\n                    // skew(10)\n                    // skew(30deg)\n                    // skew(1.5rad)\n                    // skew(10, 10)\n                    // skew(30 deg, 10 deg)\n                    // skew(1.5 rad, 2 rad)\n                    let { value, unit } = params[0];\n\n                    if (unit === \"rad\")\n                        value = Math.tan(value);\n                    else if (unit === \"deg\")\n                        value = Math.tan(value * Math.PI / 180);\n                    else\n                        value *= scale;\n\n                    let valueY = 0;\n\n                    if (params[1]) {\n                        let { value, unit } = params[1];\n\n                        if (unit === \"rad\")\n                            value = Math.tan(value);\n                        else if (unit === \"deg\")\n                            value = Math.tan(value * Math.PI / 180);\n\n                        valueY = value;\n                    }\n\n                    ctx.transform(1, valueY, value, 1, 0, 0);\n                    break;\n            }\n        }\n    }\n}\n","import { evaluateValue } from \"../../util/evaluate\";\r\nimport { renderText } from \"./renderText\";\r\nimport { setStrokeFill } from \"./setStrokeFill\";\r\nimport { applyTransform } from \"./transform\";\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D} ctx\r\n * @param {StyleRule} rule\r\n * @param {[number, number]} position\r\n * @param {OverpassElement?} element\r\n * @param {MapContext} context\r\n */\r\nexport function renderPoint(ctx, rule, [x, y], element, context) {\r\n    ctx.save();\r\n\r\n    const { scale } = context;\r\n\r\n    setStrokeFill(ctx, rule, element, context);\r\n\r\n    if (rule.declarations[\"position\"] === \"absolute\") {\r\n        x = parseFloat(rule.declarations[\"left\"]) || 0;\r\n        y = parseFloat(rule.declarations[\"top\"]) || 0;\r\n    }\r\n\r\n    ctx.translate(x * scale, y * scale);\r\n\r\n    applyTransform(ctx, rule, scale);\r\n\r\n    if (rule.declarations[\"size\"]) {\r\n        const shape = rule.declarations[\"shape\"] ?? \"circle\";\r\n\r\n        ctx.beginPath();\r\n\r\n        const r = +evaluateValue(rule.declarations[\"size\"], element, context) * scale;\r\n\r\n        if (shape === \"square\") {\r\n            ctx.moveTo(-r, -r);\r\n            ctx.lineTo(r, -r);\r\n            ctx.lineTo(r, r);\r\n            ctx.lineTo(-r, r);\r\n            ctx.closePath();\r\n        }\r\n        else if (shape === \"triangle\") {\r\n            const t = Math.cos(30/180*Math.PI);\r\n            ctx.moveTo(-r, r*t*0.5);\r\n            ctx.lineTo(0, -r/t);\r\n            ctx.lineTo(r, r*t*0.5);\r\n            ctx.closePath();\r\n        }\r\n        else if (shape === \"ellipse\") {\r\n            ctx.ellipse(0, 0, 2 * r, r, 0, 0, Math.PI * 2);\r\n        }\r\n        else {\r\n            ctx.ellipse(0, 0, r, r, 0, 0, Math.PI * 2);\r\n        }\r\n\r\n        rule.declarations[\"fill\"] && ctx.fill();\r\n        rule.declarations[\"stroke\"] && ctx.stroke();\r\n    }\r\n\r\n    if (rule.declarations[\"path\"]) {\r\n        ctx.beginPath();\r\n\r\n        drawPath(ctx, rule.declarations[\"path\"], scale);\r\n\r\n        rule.declarations[\"fill\"] && ctx.fill();\r\n        rule.declarations[\"stroke\"] && ctx.stroke();\r\n    }\r\n\r\n    // Syntax:\r\n    //  url(<URL>) [<width> [<height>]]\r\n    //  url(https://ijmacd.github.io/map-maker/logo192.png) 90px 120px;\r\n    const urlRe = /url\\(([^)]+)\\)(?:\\s+([^\\s]+)(?:\\s+([^\\s]+))?)?/;\r\n    if (urlRe.test(rule.declarations[\"icon\"])) {\r\n        const m = urlRe.exec(rule.declarations[\"icon\"]);\r\n        const url = m[1];\r\n        const img = new Image();\r\n        img.src = url;\r\n        const w = parseFloat(m[2]);\r\n        const h = parseFloat(m[3]);\r\n\r\n\r\n        img.addEventListener(\"load\", () => {\r\n            // The image is drawn in a callback so the render context state is lost\r\n            ctx.save();\r\n            // globalSetup(ctx, rule);\r\n\r\n            ctx.translate(x, y);\r\n\r\n            // applyTransform(ctx, rule);\r\n\r\n            if (w) {\r\n                const height = !isNaN(h) ? h : img.height * (w / img.width);\r\n                ctx.drawImage(img, 0, 0, w * scale, height * scale);\r\n            }\r\n            else {\r\n                ctx.drawImage(img, 0, 0);\r\n            }\r\n\r\n            ctx.restore();\r\n        });\r\n    }\r\n\r\n    if (rule.declarations[\"content\"]) {\r\n        renderText(ctx, rule, [0, 0], element, context);\r\n    }\r\n\r\n    ctx.restore();\r\n}\r\n\r\n/**\r\n * @param {CanvasRenderingContext2D} ctx\r\n * @param {string} pathSpec\r\n */\r\nfunction drawPath (ctx, pathSpec, scale) {\r\n    const segs = /([MLQCVHZ])\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?\\s*(-?\\d+(?:\\.\\d+)?)?/ig;\r\n    let match;\r\n    /** @type {[number, number]} */\r\n    let first;\r\n    /** @type {[number, number]} */\r\n    let prev;\r\n\r\n    while (match = segs.exec(pathSpec)) {\r\n        const x = parseFloat(match[2]) * scale;\r\n        const y = parseFloat(match[3]) * scale;\r\n        const x2 = parseFloat(match[4]) * scale;\r\n        const y2 = parseFloat(match[5]) * scale;\r\n        const x3 = parseFloat(match[6]) * scale;\r\n        const y3 = parseFloat(match[7]) * scale;\r\n\r\n        if (!first) first = [x,y];\r\n\r\n        if (match[1] === \"M\") {\r\n            prev = [x,y];\r\n            ctx.moveTo(x, y);\r\n        }\r\n        else if (match[1] === \"L\") {\r\n            prev = [x,y];\r\n            ctx.lineTo(x, y);\r\n        }\r\n        else if (match[1] === \"Q\") {\r\n            prev = [x2,y2];\r\n            ctx.quadraticCurveTo(x, y, x2, y2);\r\n        }\r\n        else if (match[1] === \"C\") {\r\n            prev = [x3,y3];\r\n            ctx.bezierCurveTo(x, y, x2, y2, x3, y3);\r\n        }\r\n        else if (match[1] === \"Z\") {\r\n            prev = first;\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"V\") {\r\n            prev = [prev[0], x];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"H\") {\r\n            prev = [x, prev[1]];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"m\") {\r\n            prev = [prev[0] + x, prev[1] + y];\r\n            ctx.moveTo(...prev);\r\n        }\r\n        else if (match[1] === \"l\") {\r\n            prev = [prev[0] + x, prev[1] + y];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"q\") {\r\n            ctx.quadraticCurveTo(prev[0] + x, prev[1] + y, prev[0] + x2, prev[1] + y2);\r\n            prev = [prev[0] + x2, prev[1] + y2];\r\n        }\r\n        else if (match[1] === \"c\") {\r\n            prev = [x3,y3];\r\n            ctx.bezierCurveTo(prev[0] + x, prev[1] + y, prev[0] + x2, prev[1] + y2, prev[0] + x3, prev[1] + y3);\r\n            prev = [prev[0] + x3, prev[1] + y3];\r\n        }\r\n        else if (match[1] === \"z\") {\r\n            prev = first;\r\n            ctx.lineTo(...first);\r\n        }\r\n        else if (match[1] === \"v\") {\r\n            prev = [prev[0], prev[1] + x];\r\n            ctx.lineTo(...prev);\r\n        }\r\n        else if (match[1] === \"h\") {\r\n            prev = [prev[0] + x, prev[1]];\r\n            ctx.lineTo(...prev);\r\n        }\r\n    }\r\n}","export default class CollisionSystem {\n    /** @type {CollisionSystem} */\n    static singleton;\n\n    constructor () {\n        /** @type {{ [name: string]: [number, number, number, number][] }} */\n        this.sets = {}\n    }\n\n    clear () {\n        this.sets = {};\n    }\n\n    /**\n     *\n     * @param {string} set\n     * @param {[number, number, number, number]} box\n     */\n    add (set, box) {\n        if (!this.sets[set]) this.sets[set] = [];\n\n        for (const other of this.sets[set]) {\n            if (intersects(box, other)) return false;\n        }\n\n        this.sets[set].push(box);\n\n        return true;\n    }\n\n    static getCollisionSystem () {\n        if (!this.singleton) {\n            this.singleton = new CollisionSystem();\n        }\n\n        return this.singleton;\n    }\n}\n\n\n/**\n * Checks whether two bounding boxes intersect\n * @param {[number, number, number, number]} boxA [x , y, width, height]\n * @param {[number, number, number, number]} boxB [x , y, width, height]\n */\nfunction intersects (boxA, boxB) {\n    const ax1 = boxA[0];\n    const ay1 = boxA[1];\n    const ax2 = boxA[0] + boxA[2];\n    const ay2 = boxA[1] + boxA[3];\n    const bx1 = boxB[0];\n    const by1 = boxB[1];\n    const bx2 = boxB[0] + boxB[2];\n    const by2 = boxB[1] + boxB[3];\n    return ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;\n}","import { renderPoint } from \"./renderPoint\";\nimport { applyTransform } from \"./transform\";\nimport { setStrokeFill } from \"./setStrokeFill\";\nimport { getBoundingBox } from \"../../util/util\";\nimport CollisionSystem from \"../../Classes/CollisionSystem\";\n\n/**\n * @param {CanvasRenderingContext2D} ctx\n * @param {StyleRule} rule\n * @param {[number, number][]} points\n * @param {(points: [number, number][]) => [number, number]} getPoint\n * @param {OverpassElement?} element\n * @param {MapContext} context\n */\nexport function renderAreaLine(ctx, rule, points, getPoint, element = null, context) {\n    if (points.length === 0)\n        return;\n\n\n    if (rule.declarations[\"collision-set\"]) {\n        const box = getBoundingBox(points);\n\n        if (rule.declarations[\"collision-size\"]) {\n            const s = /(\\d+\\.?\\d*)%/.exec(rule.declarations[\"collision-size\"]);\n\n            const scaleFactor = +s[1] / 100;\n            const w = box[2];\n            const h = box[3];\n\n            box[0] += (1 - scaleFactor) * w / 2;\n            box[1] += (1 - scaleFactor) * h / 2;\n            box[2] = w * scaleFactor;\n            box[3] = h * scaleFactor;\n        }\n\n        const collisionSystem = CollisionSystem.getCollisionSystem();\n\n        if (!collisionSystem.add(rule.declarations[\"collision-set\"], box)) {\n            const policy = rule.declarations[\"collision-policy\"] || \"hide\";\n\n            if (policy === \"hide\") {\n                return;\n            }\n        }\n    }\n\n    ctx.save();\n\n    setStrokeFill(ctx, rule, element, context);\n\n    let offsetX = 0;\n    let offsetY = 0;\n\n    const { scale } = context;\n\n    if (rule.declarations[\"transform\"]) {\n        // Extra work required if we're transforming\n\n        // First get transform origin;\n        const cp = getPoint(points);\n\n        // Set offset to adjust all points later\n        offsetX = cp[0];\n        offsetY = cp[1];\n\n        // Translate the canvas\n        ctx.translate(offsetX, offsetY);\n\n        // Apply the transformation\n        applyTransform(ctx, rule, scale);\n    }\n\n    ctx.beginPath();\n    for (let i = 0; i < points.length; i++) {\n        let x = points[i][0] - offsetX;\n        let y = points[i][1] - offsetY;\n        ctx.lineTo(x * scale, y * scale);\n    }\n\n    rule.declarations[\"fill\"] && ctx.fill();\n    rule.declarations[\"stroke\"] && ctx.stroke();\n\n    ctx.restore();\n\n    // Text Handling, Icons etc.\n    if (rule.declarations[\"content\"] || rule.declarations[\"size\"] || rule.declarations[\"path\"] || rule.declarations[\"icon\"]) {\n        ctx.save();\n        renderPoint(ctx, rule, getPoint(points), element, context);\n        ctx.restore();\n    }\n}\n\n\n","import MapRenderer from \"../MapRenderer\";\nimport { renderPoint } from \"./renderPoint\";\nimport { setFont } from \"./renderText\";\nimport { renderAreaLine } from \"./renderAreaLine\";\n\nexport default class CanvasRender extends MapRenderer {\n\n    /**\n     * @param {HTMLCanvasElement} canvas\n     */\n    constructor (canvas) {\n        super();\n        this.canvas = canvas;\n    }\n\n    clear (context) {\n        const { width, height, scale } = context;\n\n        this.canvas.width = width * scale;\n        this.canvas.height = height * scale;\n\n        this.canvas.style.width = `${width}px`;\n        this.canvas.style.height = `${height}px`;\n    }\n\n    /**\n     * @param {MapContext} context\n     * @param {StyleRule} rule\n     * @param {OverpassElement[]} elements\n     */\n    renderRule (context, rule, elements=[]) {\n        const ctx = this.canvas.getContext(\"2d\");\n        if (ctx) {\n            ctx.save();\n            super.renderRule(context, rule, elements);\n            ctx.restore();\n        }\n    }\n\n    globalSetup({ scale }, rule) {\n        const ctx = this.canvas.getContext(\"2d\");\n        if (ctx) {\n            if (rule.declarations[\"opacity\"])\n                ctx.globalAlpha = +rule.declarations[\"opacity\"];\n\n            if (rule.declarations[\"position\"] === \"relative\") {\n                const top = (parseFloat(rule.declarations[\"top\"]) || 0) * scale;\n                const left = (parseFloat(rule.declarations[\"left\"]) || 0) * scale;\n\n                ctx.translate(left, top);\n            }\n        }\n    }\n\n    renderPoint (context, rule, point, element=null) {\n        const ctx = this.canvas.getContext(\"2d\");\n        if (ctx) {\n            renderPoint(ctx, rule, point, element, context);\n        }\n    }\n\n    renderAreaLine (context, rule, points, getPoint, element=null) {\n        const ctx = this.canvas.getContext(\"2d\");\n        if (ctx) {\n            renderAreaLine(ctx, rule, points, getPoint, element, context);\n        }\n    }\n\n    measureText (context, rule, text) {\n        const ctx = this.canvas.getContext(\"2d\");\n\n        if (!ctx) {\n            throw Error(\"Can't get canvas context\");\n        }\n\n        const { scale } = context;\n        setFont(ctx, rule, scale);\n        const size = ctx.measureText(text);\n        const { width, actualBoundingBoxDescent: descending, actualBoundingBoxAscent: ascending } = size;\n\n        return {\n            width,\n            ascending,\n            descending,\n            height: ascending + descending,\n        };\n    }\n}\n\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","import _typeof from \"./typeof.js\";\nexport default function _regeneratorRuntime() {\n  \"use strict\";\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */\n\n  _regeneratorRuntime = function _regeneratorRuntime() {\n    return exports;\n  };\n\n  var exports = {},\n      Op = Object.prototype,\n      hasOwn = Op.hasOwnProperty,\n      $Symbol = \"function\" == typeof Symbol ? Symbol : {},\n      iteratorSymbol = $Symbol.iterator || \"@@iterator\",\n      asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\",\n      toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    return Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), obj[key];\n  }\n\n  try {\n    define({}, \"\");\n  } catch (err) {\n    define = function define(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,\n        generator = Object.create(protoGenerator.prototype),\n        context = new Context(tryLocsList || []);\n    return generator._invoke = function (innerFn, self, context) {\n      var state = \"suspendedStart\";\n      return function (method, arg) {\n        if (\"executing\" === state) throw new Error(\"Generator is already running\");\n\n        if (\"completed\" === state) {\n          if (\"throw\" === method) throw arg;\n          return doneResult();\n        }\n\n        for (context.method = method, context.arg = arg;;) {\n          var delegate = context.delegate;\n\n          if (delegate) {\n            var delegateResult = maybeInvokeDelegate(delegate, context);\n\n            if (delegateResult) {\n              if (delegateResult === ContinueSentinel) continue;\n              return delegateResult;\n            }\n          }\n\n          if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) {\n            if (\"suspendedStart\" === state) throw state = \"completed\", context.arg;\n            context.dispatchException(context.arg);\n          } else \"return\" === context.method && context.abrupt(\"return\", context.arg);\n          state = \"executing\";\n          var record = tryCatch(innerFn, self, context);\n\n          if (\"normal\" === record.type) {\n            if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue;\n            return {\n              value: record.arg,\n              done: context.done\n            };\n          }\n\n          \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg);\n        }\n      };\n    }(innerFn, self, context), generator;\n  }\n\n  function tryCatch(fn, obj, arg) {\n    try {\n      return {\n        type: \"normal\",\n        arg: fn.call(obj, arg)\n      };\n    } catch (err) {\n      return {\n        type: \"throw\",\n        arg: err\n      };\n    }\n  }\n\n  exports.wrap = wrap;\n  var ContinueSentinel = {};\n\n  function Generator() {}\n\n  function GeneratorFunction() {}\n\n  function GeneratorFunctionPrototype() {}\n\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n  var getProto = Object.getPrototypeOf,\n      NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      define(prototype, method, function (arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n\n      if (\"throw\" !== record.type) {\n        var result = record.arg,\n            value = result.value;\n        return value && \"object\" == _typeof(value) && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) {\n          invoke(\"next\", value, resolve, reject);\n        }, function (err) {\n          invoke(\"throw\", err, resolve, reject);\n        }) : PromiseImpl.resolve(value).then(function (unwrapped) {\n          result.value = unwrapped, resolve(result);\n        }, function (error) {\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n\n      reject(record.arg);\n    }\n\n    var previousPromise;\n\n    this._invoke = function (method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function (resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n    };\n  }\n\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n\n    if (undefined === method) {\n      if (context.delegate = null, \"throw\" === context.method) {\n        if (delegate.iterator[\"return\"] && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method)) return ContinueSentinel;\n        context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n    if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel;\n    var info = record.arg;\n    return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel);\n  }\n\n  function pushTryEntry(locs) {\n    var entry = {\n      tryLoc: locs[0]\n    };\n    1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\", delete record.arg, entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);\n  }\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) return iteratorMethod.call(iterable);\n      if (\"function\" == typeof iterable.next) return iterable;\n\n      if (!isNaN(iterable.length)) {\n        var i = -1,\n            next = function next() {\n          for (; ++i < iterable.length;) {\n            if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;\n          }\n\n          return next.value = undefined, next.done = !0, next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    return {\n      next: doneResult\n    };\n  }\n\n  function doneResult() {\n    return {\n      value: undefined,\n      done: !0\n    };\n  }\n\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, \"constructor\", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) {\n    var ctor = \"function\" == typeof genFun && genFun.constructor;\n    return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name));\n  }, exports.mark = function (genFun) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun;\n  }, exports.awrap = function (arg) {\n    return {\n      __await: arg\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    void 0 === PromiseImpl && (PromiseImpl = Promise);\n    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);\n    return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () {\n    return this;\n  }), define(Gp, \"toString\", function () {\n    return \"[object Generator]\";\n  }), exports.keys = function (object) {\n    var keys = [];\n\n    for (var key in object) {\n      keys.push(key);\n    }\n\n    return keys.reverse(), function next() {\n      for (; keys.length;) {\n        var key = keys.pop();\n        if (key in object) return next.value = key, next.done = !1, next;\n      }\n\n      return next.done = !0, next;\n    };\n  }, exports.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function reset(skipTempReset) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) {\n        \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);\n      }\n    },\n    stop: function stop() {\n      this.done = !0;\n      var rootRecord = this.tryEntries[0].completion;\n      if (\"throw\" === rootRecord.type) throw rootRecord.arg;\n      return this.rval;\n    },\n    dispatchException: function dispatchException(exception) {\n      if (this.done) throw exception;\n      var context = this;\n\n      function handle(loc, caught) {\n        return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i],\n            record = entry.completion;\n        if (\"root\" === entry.tryLoc) return handle(\"end\");\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\"),\n              hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n          } else {\n            if (!hasFinally) throw new Error(\"try statement without catch or finally\");\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);\n      var record = finallyEntry ? finallyEntry.completion : {};\n      return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);\n    },\n    complete: function complete(record, afterLoc) {\n      if (\"throw\" === record.type) throw record.arg;\n      return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;\n    },\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;\n      }\n    },\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n\n          if (\"throw\" === record.type) {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n\n          return thrown;\n        }\n      }\n\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      return this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel;\n    }\n  }, exports;\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}","import { contains, getArea } from \"../util/bbox\";\r\n\r\nexport default class IDBElementDatabase {\r\n    constructor (name=\"OverpassElements\") {\r\n        const request = indexedDB.open(name);\r\n\r\n        request.addEventListener(\"upgradeneeded\", ev => {\r\n            /** @type {IDBOpenDBRequest} */\r\n            const request = (ev.target);\r\n            const db = request.result;\r\n            db.createObjectStore(\"nodes\", { keyPath: \"id\" });\r\n\r\n            const store = db.createObjectStore(\"elements\");\r\n            store.createIndex(\"selectorIndex\", [\"selector\", \"area\", \"bbox\"], { unique: false });\r\n        });\r\n\r\n        /** @type {Promise<IDBDatabase>} */\r\n        this.db = new Promise((resolve, reject) => {\r\n            request.addEventListener(\"success\", ev => {\r\n                /** @type {IDBOpenDBRequest} */\r\n                const request = (ev.target);\r\n                resolve(request.result);\r\n            });\r\n\r\n            request.addEventListener(\"error\", reject);\r\n        })\r\n\r\n    }\r\n\r\n    async saveNodes (nodes) {\r\n        const db = await this.db;\r\n        const store = db.transaction(\"nodes\", \"readwrite\").objectStore(\"nodes\");\r\n        for (const n of nodes) {\r\n            store.put(n);\r\n        }\r\n    }\r\n\r\n    async getNode (id) {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const store = db.transaction(\"nodes\", \"readonly\").objectStore(\"nodes\");\r\n            const request = store.get(id);\r\n            request.addEventListener(\"success\", e => resolve(request.result));\r\n            request.addEventListener(\"error\", e => reject(e));\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {number[]} ids\r\n     */\r\n    getNodes (ids) {\r\n        return Promise.all(ids.map(id => this.getNode(id)));\r\n    }\r\n\r\n    /**\r\n     * If there is an *exact* match for selector/bbox then this method returns\r\n     * those elements.\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @returns {Promise<{ elements: OverpassElement[] }|undefined>}\r\n     */\r\n    getElements (bbox, selector) {\r\n        const key = makeKey(bbox, selector);\r\n        return this.getElementsByKey(key);\r\n    }\r\n\r\n    /**\r\n     * Get the elements for a given database key\r\n     * @param {string} key\r\n     * @returns {Promise<{ elements: OverpassElement[] }|undefined>}\r\n     */\r\n    async getElementsByKey (key) {\r\n        const db = await this.db;\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readonly\").objectStore(\"elements\");\r\n            const request = objectStore.get(key);\r\n            request.addEventListener(\"success\", () => resolve(request.result));\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns the key for a query which will cover the selector/bbox\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @returns {Promise<string?>}\r\n     */\r\n    async searchElements (bbox, selector) {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readonly\").objectStore(\"elements\");\r\n            const index = objectStore.index(\"selectorIndex\");\r\n            const range = IDBKeyRange.bound([selector,0,\"0\"], [selector,Number.MAX_VALUE,\"999999999999999999\"]);\r\n            const request = index.openKeyCursor(range);\r\n            let count = 0;\r\n\r\n            // Area can be larger than reequested but we don't want the area\r\n            // to be *too* big. This sets the upper limit.\r\n            const bboxOversizeArea = getArea(bbox) * 9;\r\n\r\n            request.addEventListener(\"success\", () => {\r\n                const cursor = request.result;\r\n\r\n                if (cursor) {\r\n                    const { key, primaryKey } = cursor;\r\n                    const keyBBox = key[2];\r\n                    const keyArea = key[1];\r\n                    count++;\r\n                    console.debug(`Checking index #${count} for ${selector}`);\r\n                    if (contains(keyBBox, bbox) && keyArea < bboxOversizeArea) {\r\n                        console.debug(`${selector} found after checking ${count} records`);\r\n                        resolve(primaryKey.toString());\r\n                        return;\r\n                    }\r\n                    cursor.continue();\r\n                }\r\n                else {\r\n                    console.debug(`${selector} not found after checking ${count} records`);\r\n                    resolve(null);\r\n                }\r\n            });\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {string} bbox\r\n     * @param {string} selector\r\n     * @param {{ elements: OverpassElement[], cached: number }} record\r\n     */\r\n    async saveElements (bbox, selector, record) {\r\n        const db = await this.db;\r\n        const key = makeKey(bbox, selector);\r\n        const area = getArea(bbox);\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const objectStore = db.transaction(\"elements\", \"readwrite\").objectStore(\"elements\");\r\n            const request = objectStore.put({ selector, bbox, area, ...record }, key);\r\n            request.addEventListener(\"success\", () => {\r\n                console.debug(`Saved ${selector}/${bbox} to database with ${record.elements.length} elements`);\r\n                resolve();\r\n            });\r\n            request.addEventListener(\"error\", reject);\r\n        });\r\n    }\r\n\r\n    // Delete all saved nodes\r\n    async clear () {\r\n        const db = await this.db;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const req = db.transaction(\"elements\", \"readwrite\").objectStore(\"elements\").clear();\r\n            req.onsuccess = resolve;\r\n            req.onerror = reject;\r\n        });\r\n    }\r\n}\r\n\r\nfunction makeKey (bbox, selector) {\r\n    const bkey = bbox.split(\",\").map(p => (+p).toFixed(3)).join(\",\");\r\n    return `${selector}/${bkey}`;\r\n}\r\n","import { matchSelector, StyleSelector } from \"../Classes/Style\";\r\n\r\n/**\r\n * @param {StyleSelector[]} selectors\r\n */\r\nexport function getSelectors (selectors) {\r\n    /** @type {{ [key: string]: StyleSelector }} */\r\n    const set = {};\r\n\r\n    selectors.forEach(s => set[mapSelector(s)] = s);\r\n\r\n    console.debug(`getSelectors: ${selectors.length} requested (${Object.keys(set).length} unique)`);\r\n\r\n    // Remove non-overpass selectors\r\n    for (const [key, selector] of Object.entries(set)) {\r\n        if (!isOverpassType(selector))\r\n            delete set[key];\r\n    }\r\n\r\n    return set;\r\n}\r\n\r\n/** @param {StyleSelector} selector */\r\nexport function mapSelectorForQuery (selector) {\r\n    const recur = /^(way|rel(?:ation)?|area)/.test(selector.type) ? \">;\" : \"\";\r\n    return `${mapSelector(selector)};${recur}`;\r\n}\r\n\r\n/** @param {StyleSelector} selector */\r\nexport function mapSelector (selector) {\r\n    const type = selector.type === \"area\" ? \"way\" : selector.type;\r\n    const tags = Object.entries(selector.tags).map(([k,v]) => {\r\n        if (k.includes(\":\")) k = `\"${k}\"`;\r\n        return (/^[<=>]+/.test(v) || v === \"*\") ? `[${k}]` : `[${k}=${v}]`;\r\n    });\r\n    return `${type}${tags.join(\"\")}`;\r\n}\r\n\r\nexport function clampBBox (bbox) {\r\n    let [ lon1, lat1, lon2, lat2 ] = bbox.split(\",\").map(p => +p);\r\n\r\n    if (lon1 > lon2) {\r\n        [ lon1, lon2 ] = [ lon2, lon1 ];\r\n    }\r\n\r\n    if (lat1 > lat2) {\r\n        [ lat1, lat2 ] = [ lat2, lat1 ];\r\n    }\r\n\r\n    return `${clamp(lon1, -180, 180)},${clamp(lat1, -90, 90)},${clamp(lon2, -180, 180)},${clamp(lat2, -90, 90)}`;\r\n}\r\n\r\nexport function clamp (v, min, max) {\r\n    return Math.max(min, Math.min(v, max));\r\n}\r\n\r\n/**\r\n * @param {StyleSelector[]} selectors\r\n * @param {OverpassElement[]} elements\r\n */\r\nexport function extractElements (selectors, elements) {\r\n    // Prepare node map\r\n    /** @type {{ [id: number]: OverpassNodeElement }} */\r\n    const nodeMap = {};\r\n\r\n    // Only need node map if way have any rels or ways\r\n    if (selectors.some(s => s?.type === \"relation\" || s?.type === \"way\" || s?.type === \"area\")) {\r\n        elements.forEach(n => n.type === \"node\" && (nodeMap[n.id] = n));\r\n    }\r\n\r\n    // Prepare way map\r\n    /** @type {{ [id: number]: OverpassWayElement }} */\r\n    const wayMap = {};\r\n\r\n    // Only need way map if way have any rels\r\n    if (selectors.some(s => s?.type === \"relation\")) {\r\n        elements.forEach(n => n.type === \"way\" && (wayMap[n.id] = n));\r\n    }\r\n\r\n    return selectors.map(selector => extractElementsBySelector(selector, elements, nodeMap, wayMap));\r\n}\r\n\r\n/**\r\n * @param {import(\"../Classes/Style\").StyleSelector?} selector\r\n * @param {OverpassElement[]} elements\r\n * @param {{ [id: number]: OverpassNodeElement}} nodeMap\r\n * @param {{ [id: number]: OverpassWayElement}} wayMap\r\n */\r\nexport function extractElementsBySelector(selector, elements, nodeMap, wayMap) {\r\n    if (!selector) {\r\n        return [];\r\n    }\r\n\r\n    const out = elements.filter(el => matchSelector(selector, el, false));\r\n\r\n    if (selector.type === \"relation\") {\r\n        const rels = /** @type {OverpassRelElement[]} */(out.slice());\r\n\r\n        /** @type {OverpassWayElement[]} */\r\n        const ways = [];\r\n\r\n        for (const rel of rels) {\r\n            const refs = rel.members.map(m => m.ref);\r\n            ways.push(...refs.map(id => wayMap[id]));\r\n        }\r\n\r\n        out.push(...ways);\r\n\r\n        for (const way of ways) {\r\n            out.push(...way.nodes.map(id => nodeMap[id]));\r\n        }\r\n\r\n    } else if (selector.type === \"way\" || selector.type === \"area\") {\r\n        const ways = /** @type {OverpassWayElement[]} */(out.slice());\r\n\r\n        for (const way of ways) {\r\n            out.push(...way.nodes.map(id => nodeMap[id]));\r\n        }\r\n    }\r\n    return out;\r\n}\r\n\r\n/**\r\n * @param {StyleSelector[]} selectors\r\n */\r\nexport function optimiseDuplicates (selectors) {\r\n    const map = {};\r\n\r\n    for (const selector of selectors) {\r\n        map[selector.toString()] = selector;\r\n    }\r\n\r\n    return Object.values(map);\r\n}\r\n\r\n/**\r\n * @param {StyleSelector[]} selectors\r\n */\r\nexport function optimiseWildcardTags (selectors) {\r\n    /** @type {StyleSelector[]} */\r\n    const out = [];\r\n\r\n    for (const selector of selectors) {\r\n        const keys = Object.keys(selector.tags);\r\n\r\n        // Only consider selectors with exactly one tag\r\n        if (keys.length !== 1) {\r\n            out.push(selector);\r\n        }\r\n\r\n        // Include the one with the wildcard\r\n        if (selector.tags[keys[0]] === \"*\") {\r\n            out.push(selector);\r\n        }\r\n\r\n        if (!selectors.some(s => isWildcardMatch(s, selector)))\r\n        {\r\n            out.push(selector);\r\n        }\r\n    }\r\n\r\n    return out;\r\n}\r\n\r\nfunction isWildcardMatch(selector, testSelector) {\r\n    const keys = Object.keys(selector.tags);\r\n\r\n    if (keys.length !== 1)\r\n        return false;\r\n\r\n    const key = keys[0];\r\n\r\n    if (!(key in testSelector.tags))\r\n        return false;\r\n\r\n    return selector.tags[key] === \"*\";\r\n}\r\n\r\n/**\r\n * Checks if selector is for real Overpass element (e.g. node, way, relation,\r\n * or area [which is still OK]); or another type of selector (e.g. map,\r\n * current, gridlines, dummy, etc.)\r\n * Returns `true` for Overpass elements\r\n * @note Can be used in `.filter()` so don't add other parameters\r\n * @param {StyleSelector} selector\r\n */\r\nexport function isOverpassType(selector) {\r\n    return /^(node|way|rel(?:ation)?|area)/.test(selector.type);\r\n}","import IDBElementDatabase from \"../data/database.idb\";\r\nimport { contains } from \"../util/bbox\";\r\nimport { matchSelector } from \"./Style\";\r\nimport { timeout } from '../util/util';\r\nimport { clampBBox, extractElementsBySelector, mapSelector, mapSelectorForQuery } from \"../util/overpass\";\r\n\r\n\r\nconst API_ROOT = require(\"../conf\").API_ROOT;\r\n\r\nexport class Overpass {\r\n    /** @param {string?} bbox */\r\n    constructor (bbox = null) {\r\n        /** @type {Map<string, Promise<OverpassElement[]>>} */\r\n        this.elements = new Map();\r\n        this.bbox = bbox;\r\n        this.database = new IDBElementDatabase();\r\n        /** @type {{ [url: string]: Promise<OverpassElement[]> }} */\r\n        this.fetchMap = {};\r\n        /** @type {Promise<any>} */\r\n        this.currentJob = Promise.resolve();\r\n    }\r\n\r\n    setBBox (bbox) {\r\n        // If the new bbox is completely contained within the\r\n        // old one then we don't need to clear our cache\r\n        if (this.bbox && !contains(this.bbox, bbox)) {\r\n            this.elements.clear();\r\n        }\r\n        this.bbox = bbox;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     */\r\n    async preLoadElements (selectors) {\r\n        return this.jobs(async () => {\r\n            const { bbox } = this;\r\n\r\n            if (!this.bbox) {\r\n                throw Error(\"No bounding box specified\");\r\n            }\r\n\r\n            // Create set of selectors\r\n            const set = this.getSelectors(selectors);\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} are Overpass Elements`);\r\n\r\n            // Remove selectors found in local hash map cache\r\n            for (const key of Object.keys(set)) {\r\n                if (this.haveElements(key))\r\n                    delete set[key];\r\n            }\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} not in HashMap`);\r\n\r\n            // Remove selectors which were found in database\r\n            await Promise.all(Object.keys(set).map(s => {\r\n                return this.database.searchElements(bbox, s)\r\n                    .then(els => {\r\n                        if (els) delete set[s];\r\n                    });\r\n            }));\r\n            console.debug(`Preloading Elements: ${Object.keys(set).length} not in Database`);\r\n\r\n            if (Object.keys(set).length === 0) return 0;\r\n\r\n            const elements = await this.tryQuery(Object.values(set));\r\n\r\n            console.log(`Preloading Elements: Fetched ${elements.length} elements from Server`);\r\n\r\n            // Prepare node map\r\n            /** @type {{ [id: number]: OverpassNodeElement }} */\r\n            const nodeMap = {};\r\n            elements.forEach(n => n.type === \"node\" && (nodeMap[n.id] = n));\r\n            // Prepare way map\r\n            /** @type {{ [id: number]: OverpassWayElement }} */\r\n            const wayMap = {};\r\n            elements.forEach(n => n.type === \"way\" && (wayMap[n.id] = n));\r\n\r\n            await Promise.all(Object.values(set).map(selector => {\r\n                const out = extractElementsBySelector(selector, elements, nodeMap, wayMap);\r\n\r\n                this.elements.set(mapSelector(selector), Promise.resolve(out));\r\n                return this.database.saveElements(bbox, mapSelector(selector), { elements: out, cached: Date.now() });\r\n            }));\r\n\r\n            return elements.length;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @param {string} key\r\n     */\r\n    haveElements (key) {\r\n        return this.elements.has(key);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    query (selectors) {\r\n        if (this.bbox.split(\",\").map(p => +p).some(isNaN)) throw Error(\"Invalid BBox\");\r\n\r\n        const sMap = selectors.map(mapSelectorForQuery);\r\n        const query = `[out:json][bbox];\\n(${sMap.join(\"\")}\\n);\\nout;`\r\n        const url = `${API_ROOT}?data=${query.replace(/\\s/,\"\")}&bbox=${clampBBox(this.bbox)}`;\r\n\r\n        if (!this.fetchMap[url]) {;\r\n            this.fetchMap[url] = fetch(url.toString()).then(r => r.ok ? r.json() : Promise.reject(r.status)).then(r => r.elements);\r\n\r\n            this.fetchMap[url].finally(() => delete this.fetchMap[url]);\r\n        }\r\n\r\n        return this.fetchMap[url];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param {StyleSelector[]} selectors\r\n     * @param {number} tries\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    tryQuery (selectors, tries=10) {\r\n        return this.query(selectors).catch(e => {\r\n            if (e !== 429) throw Error(\"Bad Response\");\r\n\r\n            if (tries > 0) {\r\n                return timeout(10000).then(() => this.tryQuery(selectors, tries - 1))\r\n            }\r\n\r\n            throw Error(\"Too many retries fetching data\");\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @param {StyleSelector} selector\r\n     * @returns {Promise<OverpassElement[]>}\r\n     */\r\n    async getElements (selector) {\r\n        // if (!overpassRe.test(selector.type)) return;\r\n\r\n        if (!this.bbox) return;\r\n\r\n        const s = mapSelector(selector);\r\n        if (this.elements.has(s)) return this.elements.get(s);\r\n\r\n        const dbResult = await this.database.getElements(this.bbox, s);\r\n\r\n        if (dbResult) {\r\n            const { elements } = dbResult;\r\n            this.elements.set(s, Promise.resolve(elements));\r\n            return elements;\r\n        }\r\n\r\n        const dbSearchResult = await this.database.searchElements(this.bbox, s);\r\n\r\n        if (dbSearchResult) {\r\n            const elements = this.database.getElementsByKey(dbSearchResult).then(r => r.elements);\r\n            this.elements.set(s, elements);\r\n            return elements;\r\n        }\r\n\r\n        const p = this.tryQuery([selector]);\r\n\r\n        this.elements.set(s, p);\r\n\r\n        p.catch(() => this.elements.delete(s));\r\n\r\n        p.then(elements => {\r\n            this.database.saveElements(this.bbox, s, { elements, cached: Date.now() });\r\n        });\r\n\r\n        return p;\r\n    }\r\n\r\n    jobs (fn) {\r\n        this.currentJob = this.currentJob.then(() => fn());\r\n\r\n        return this.currentJob;\r\n    }\r\n\r\n    // Delete everything from cache\r\n    clearCache (database = false) {\r\n        this.elements.clear();\r\n        if (database)\r\n            return this.database.clear();\r\n    }\r\n}\r\n","import CanvasRender from './CanvasRender';\r\nimport { Overpass } from '../Classes/Overpass';\r\n\r\n/** @type {OffscreenCanvas} */\r\nlet canvas;\r\n/** @type {MapRenderer} */\r\nlet renderer;\r\n/** @type {Overpass} */\r\nlet overpass = new Overpass();\r\n\r\nlet chain = Promise.resolve();\r\n\r\nonmessage = (msg) => {\r\n    if (msg.data.canvas) {\r\n        canvas = msg.data.canvas;\r\n        renderer = new CanvasRender(canvas);\r\n    }\r\n\r\n    if (msg.data.method === \"clear\") {\r\n        const { context: { width, height, bbox } } = msg.data;\r\n\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n\r\n        overpass.setBBox(bbox);\r\n\r\n        chain = Promise.resolve();\r\n    }\r\n\r\n    if (msg.data.method === \"renderRule\") {\r\n        /** @type {{ context: MapContext, rule: StyleRule }} */\r\n        const { context, rule } = msg.data;\r\n\r\n        overpass.setBBox(context.bbox);\r\n        const pElements = overpass.getElements(rule.selector);\r\n\r\n        chain = chain.then(() => pElements.then(elements => renderer.renderRule(context, rule, elements)));\r\n    }\r\n};"],"names":["API_ROOT","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","configurable","writable","_createClass","protoProps","staticProps","_getPrototypeOf","setPrototypeOf","getPrototypeOf","bind","__proto__","_superPropBase","object","property","_get","Reflect","receiver","base","desc","getOwnPropertyDescriptor","arguments","value","apply","this","_setPrototypeOf","p","_typeof","Symbol","iterator","constructor","_possibleConstructorReturn","self","ReferenceError","_createSuper","Derived","hasNativeReflectConstruct","construct","sham","Proxy","Boolean","valueOf","e","result","Super","NewTarget","_arrayLikeToArray","arr","len","arr2","Array","_unsupportedIterableToArray","minLen","n","toString","slice","name","from","test","isArray","_i","_s","_e","_arr","_n","_d","next","done","push","err","iter","allowArrayLike","it","F","s","f","normalCompletion","didErr","step","_e2","timeout","duration","Promise","resolve","setTimeout","mercatorProjection","centre","scale","width","height","cLon","cLat","tileCount","Math","pow","hPixelsPerDeg","vPixelsPerDeg","QUARTER_PI","PI","cX","cY","cLatPrime","log","tan","lon","lat","E","N","getAveragePoint","points","reduce","sum","map","x","getCentrePoint","boundingBox","getBoundingBox","getMidPoint","floor","minMax","point","min","max","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","rectToPoints","y","getCrossProductArea","getArea","abs","isAntiClockwise","isConvex","l","sign","a","b","c","isSelfClosing","getLength","dx","dy","sqrt","StyleSelector","type","tags","pseudoClasses","pseudoElement","entries","k","v","op","join","matchSelector","selector","element","inequalities","m","exec","cmp","COMPARE","substr","res","isNaN","localeCompare","makePredicate","match","left","operator","right","testPredicate","predicate","context","Function","parse","text","tagText","substring","trim","re2","m2","re3","m3","re","params","split","m4","console","parseMultiple","filter","clone","other","matchPseudoClasses","rule","nodes","includesPseudoClass","pc","area","some","evaluateValue","index","out","replace","getContent","content","declarations","contains","areaA","areaB","Ax1","Ay1","Ax2","Ay2","Bx1","By1","Bx2","By2","bbox","parts","MapRenderer","elements","nodeMap","forEach","id","wayMap","zoom","projection","globalSetup","renderPseudoElement","renderArea","dummyElement","renderPoint","current","coords","longitude","latitude","renderGridlines","el","renderLine","renderAreaLine","getPoint","centrePoint","midPoint","avgPoint","bounding","boundingPoints","top","NaN","bottom","baseline","line","size","measureText","ascending","descending","padding","parseFloat","boundPoints","decimatedPoints","vertical","find","horizontal","dLon","dLat","toFixed","makeBBox","round","sigFigs","ceil","log10","xmin","xmax","ymin","ymax","j","setStrokeFill","ctx","fillStyle","strokeStyle","mutedStyle","ss","repeat","sm","lineWidth","lineDash","parseStrokeFill","setLineDash","textWidth","strokeText","fillText","actualBoundingBoxAscent","actualBoundingBoxDescent","setFont","fontSize","fontWeight","fontFamily","font","applyTransform","r","t","trans","unit","transform","rotate","translate","valueY","save","shape","beginPath","moveTo","lineTo","closePath","cos","ellipse","fill","stroke","pathSpec","first","prev","segs","x2","y2","x3","y3","quadraticCurveTo","bezierCurveTo","drawPath","urlRe","url","img","Image","src","w","h","addEventListener","drawImage","restore","renderText","CollisionSystem","sets","set","box","intersects","singleton","boxA","boxB","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","scaleFactor","collisionSystem","getCollisionSystem","add","policy","offsetX","offsetY","cp","CanvasRender","subClass","superClass","create","canvas","style","getContext","globalAlpha","Error","_regeneratorRuntime","Op","hasOwn","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","Context","_invoke","state","method","arg","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","fn","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","values","Gp","defineIteratorMethods","AsyncIterator","PromiseImpl","invoke","reject","__await","then","unwrapped","error","previousPromise","callInvokeWithMethodAndArg","info","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","mark","awrap","async","keys","reverse","pop","skipTempReset","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","args","_defineProperty","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","_objectSpread2","source","getOwnPropertyDescriptors","defineProperties","IDBElementDatabase","request","indexedDB","open","ev","db","createObjectStore","keyPath","createIndex","unique","store","transaction","objectStore","put","ids","all","getNode","makeKey","getElementsByKey","range","IDBKeyRange","bound","MAX_VALUE","openKeyCursor","count","bboxOversizeArea","cursor","primaryKey","keyBBox","keyArea","debug","continue","req","clear","onsuccess","onerror","bkey","mapSelectorForQuery","recur","mapSelector","includes","clamp","extractElementsBySelector","ways","refs","members","ref","way","renderer","require","Overpass","Map","database","fetchMap","currentJob","selectors","jobs","getSelectors","haveElements","searchElements","els","tryQuery","saveElements","cached","Date","now","has","sMap","query","lon1","lat1","lon2","lat2","clampBBox","fetch","ok","json","status","finally","tries","catch","getElements","dbResult","dbSearchResult","delete","overpass","chain","onmessage","msg","data","setBBox","pElements","renderRule"],"sourceRoot":""}